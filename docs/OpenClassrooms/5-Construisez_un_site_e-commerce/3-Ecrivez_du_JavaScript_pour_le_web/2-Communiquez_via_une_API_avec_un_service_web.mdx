---
id: 2-Communiquez_via_une_API_avec_un_service_web
title: Communiquez via une API avec un service web
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import { Vimeo, CodePen } from 'mdx-embed';

# Communiquez via une API avec un service web

## Comprenez ce que sont des API et un service web

[Comprenez ce que sont des API et un service web - Ã‰crivez du JavaScript pour le web - OpenClassrooms](https://openclassrooms.com/fr/courses/5543061-ecrivez-du-javascript-pour-le-web/5577576-comprenez-ce-que-sont-des-api-et-un-service-web)

<Vimeo vimeoId="539127771" />

<br />

Les services web et les API sont des Ã©lÃ©ments essentiels aux applications web. Nâ€™importe quel site sur lequel vous naviguez est un service web,
et il fournit une API pour communiquer avec.

:::note ?
Mais quâ€™est-ce que câ€™est exactement ?
:::

#### Qu'est-ce qu'un service web ?

Un service web est un programme s'exÃ©cutant sur un serveur accessible depuis Internet et fournissant un service.

Par exemple, Google est un service web qui vous permet de rechercher des sites web. Une application mÃ©tÃ©o communique avec un service web qui
fournit la mÃ©tÃ©o. Un rÃ©seau social est un service web qui permet de retrouver ses amis et de communiquer avec.

Le but dâ€™un service web est donc de fournir un service Ã  celui qui le demande. Et pour ce faire, il met Ã  disposition une **API**.

#### Quâ€™est-ce quâ€™une API ?

Une API, ou _Application Programming Interface_, est une interface de communication. Il en existe diffÃ©rents types, mais celle qui nous
intÃ©resse est celle qui permet de communiquer avec les services web.

Lâ€™API correspond Ã  lâ€™ensemble des demandes que lâ€™on peut faire Ã  un service web. Ces demandes sont appelÃ©es des **requÃªtes**.

Par exemple, demander la mÃ©tÃ©o actuelle est une requÃªte. Faire une demande dâ€™ami sur un rÃ©seau social est une requÃªte. Ou encore, envoyer un
message via une application de messagerie est une requÃªte.

:::note ?
Mais Ã  quoi ressemble une requÃªte ?
:::

C'est une question intÃ©ressante, mais aussi complexe. En effet, il a bien fallu se mettre d'accord sur le **langage** Ã  utiliser pour
communiquer via les API. Mais voilÃ , un service d'envoi de mails ne fait pas du tout le mÃªme travail qu'un service nous renvoyant les pages
d'un site Internet. Il semble donc Ã©vident que la maniÃ¨re de communiquer ne sera pas la mÃªme pour ces deux services. Des **protocoles de
communication** ont donc Ã©tÃ© mis en place afin de standardiser la communication entre services faisant la mÃªme chose.

Les **requÃªtes** sont des donnÃ©es qui respectent le protocole de communication et qui sont envoyÃ©es au serveur.

Nous avons donc un protocole pour l'envoi de mail (_SMTP_), la rÃ©ception de mail (_IMAP_), les requÃªtes liÃ©es Ã  des ressources web (_HTTP),_
aux transferts de fichiers (_FTP_), etc.

Le protocole qui va nous intÃ©resser est le protocole nous permettant de communiquer avec lâ€™API dâ€™un site Internet : le protocole **HTTP**.
GrÃ¢ce Ã  lui, nous allons pouvoir rÃ©cupÃ©rer et sauvegarder des donnÃ©es sur un service web, ce qui nous permettra de dynamiser le contenu de nos
pages web.

#### Qu'est-ce que le protocole HTTP ?

**_HTTP_** signifie _HyperText Transfer Protocol._ C'est un protocole qui permet de **communiquer** avec un site Internet. Il va permettre de
charger des **pages HTML**, des **styles CSS**, des **polices de caractÃ¨res**, des **images**, etc. Mais ce n'est pas tout, le protocole HTTP
nous permet aussi d'envoyer des formulaires et de rÃ©cupÃ©rer et d'envoyer toutes sortes de donnÃ©es depuis ou vers un serveur implÃ©mentant ce
protocole grÃ¢ce Ã  son API !

Nous n'allons pas entrer dans le dÃ©tail du format des requÃªtes HTTP_,_ car [de nombreuses rÃ©fÃ©rences](https://www.google.fr/search?q=http) le
font dÃ©jÃ  trÃ¨s bien. Tout ce que vous avez besoin de savoir câ€™est que plusieurs informations se trouvent dans une requÃªte HTTP :
- **La mÃ©thode**. Il sâ€™agit de lâ€™action que lâ€™on souhaite faire : rÃ©cupÃ©rer une ressource, la supprimer, etc. Voici les mÃ©thodes HTTP les plus
courantes :
   - **GET** : permet de **rÃ©cupÃ©rer** des ressources, comme par exemple le temps actuel sur un service de mÃ©tÃ©o ;
   - **POST** : permet de **crÃ©er** ou **modifier** une ressource, comme la crÃ©ation d'un nouvel utilisateur sur votre application ;
   - **PUT** : permet de **modifier** une ressource, comme le nom de l'utilisateur que vous venez de crÃ©er avec _POST_ ;
   - **DELETE** : Permet de **supprimer** une ressource, comme un commentaire dans un fil de discussion.
- **Lâ€™URL**. Câ€™est lâ€™adresse sur le service web que vous souhaitez atteindre. Un peu comme un identifiant unique afin que le web service
comprenne ce que vous voulez.
- **Les donnÃ©es**. Lorsquâ€™on fait une requÃªte pour enregistrer des donnÃ©es (par exemple un formulaire) il faut pouvoir envoyer ces donnÃ©es au
service web.

Une fois votre requÃªte envoyÃ©e et traitÃ©e par le service web, celui-ci va vous rÃ©pondre avec, entre autres, les informations suivantes :
- **Les donnÃ©es**. Les donnÃ©es que vous avez demandÃ©es : une page HTML, etc.
- **Le code HTTP**. Il sâ€™agit dâ€™un code numÃ©rique qui vous indique comment sâ€™est dÃ©roulÃ©e la requÃªte. Voici les plus courants :
    - **200** : indique que tout sâ€™est bien passÃ©
    - **400** : indique que votre requÃªte nâ€™est pas conforme Ã  ce qui est attendu
    - **401** : indique que vous devez Ãªtre authentifiÃ© pour faire cette requÃªte
    - **403** : indique que vous Ãªtes bien authentifiÃ© mais que vous nâ€™Ãªtes pas autorisÃ© Ã  faire cette requÃªte
    - **404** : indique que la ressource demandÃ©e nâ€™existe pas
    - **500** : indique une erreur avec le service web
    - [Voici une liste exhaustive des codes HTTPs](https://fr.wikipedia.org/wiki/Liste_des_codes_HTTP)

:::info
Il s'agit surtout d'une convention. Rien n'oblige un service web Ã  crÃ©er une ressource lors d'une requÃªte _POST_Â  par exemple, mais c'est
gÃ©nÃ©ralement le cas.
:::

### En rÃ©sumÃ©

Dans ce chapitre, vous avez appris :
- Quâ€™un service web est une application sur internet qui rÃ©pond Ã  un besoin : Google qui permet de faire des recherches, Facebook qui permet de
garder contact avec ses amis, etc. ;
- Quâ€™une API est une interface de communication entre un service web et le navigateur;
- Quâ€™un protocole de communication permet de dÃ©finir comment communiquer avec un service. Comme la dÃ©finition des normes, que tout le monde
peut utiliser.
- Que le protocole HTTP est le protocole de communication utilisÃ© par les services web.

_Avec ce que vous venez d'apprendre, vous Ãªtes maintenant en mesure de communiquer avec un service web. Il ne vous reste plus qu'Ã  savoir
comment on fait Ã§a en JavaScript, et c'est justement ce que nous allons voir dans le chapitre suivant !_

-----

## RÃ©cupÃ©rez des donnÃ©es d'un service web

[RÃ©cupÃ©rez des donnÃ©es d'un service web - Ã‰crivez du JavaScript pour le web - OpenClassrooms](https://openclassrooms.com/fr/courses/5543061-ecrivez-du-javascript-pour-le-web/5577591-recuperez-des-donnees-dun-service-web)

<Vimeo vimeoId="539127809" />

<br />

Maintenant que nous savons ce qu'est une **requÃªte HTTP**, il ne nous reste plus qu'Ã  apprendre Ã  en crÃ©er une en JavaScript pour rÃ©cupÃ©rer des
donnÃ©es, comme la mÃ©tÃ©o. C'est lÃ  que lâ€™API **Fetch** entre en jeu !

### Qu'est-ce que Fetch ?

Fetch est unÂ **ensemble d'objets et de fonctions** mis Ã  disposition par le langage JavaScript, afin d'exÃ©cuter des requÃªtes HTTP de maniÃ¨re
asynchrone.

:::info
Nous verrons en dÃ©tail ce qu'_asynchrone_ signifie dans la prochaine partie, retenez simplement pour lâ€™instant que cela permet d'exÃ©cuter du
code (une requÃªte ici), sans bloquer l'exÃ©cution de la page, en attendant la rÃ©ponse du service web.
:::

Lâ€™API FetchÂ  va nous permettre d'exÃ©cuter des requÃªtes HTTP sans avoir besoin de recharger la page du navigateur. Cela a plusieurs avantages :
- **Avoir un site plus rÃ©actif** car on n'a pas besoin de recharger toute la page dÃ¨s qu'on a besoin de mettre Ã  jour une partie du contenu ;
- **AmÃ©liorer l'expÃ©rience utilisateur** avec du nouveau contenu qui se charge au fur et Ã  mesure qu'on le dÃ©couvre, par exemple.

### Envoyez une premiÃ¨re requÃªte

Voyons maintenant comment on peut construire et envoyer une requÃªte HTTP.

Si vous vous souvenez du chapitre prÃ©cÃ©dent, vous devez avoir devinÃ© que nous allons crÃ©er une requÃªte HTTP avec la mÃ©thode GET, afin de
rÃ©cupÃ©rer des donnÃ©es. C'est parti !

```javascript
fetch("http://url-service-web.com/api/users");
```

Ce code nous permet d'envoyer une requÃªte HTTP de typeÂ _GET_ au service web se trouvant Ã  l'adresse `http://url-service-web.com/api/users`.

### RÃ©cupÃ©rez les donnÃ©es au format JSON

Maintenant que nous savons comment construire et envoyer une requÃªte HTTP, il faut rÃ©cupÃ©rer et interprÃ©ter son rÃ©sultat.

Un service web peut choisir le format qu'il veut pour nous renvoyer des donnÃ©es, mais le plus courant et le plus simple est le **formatÂ _JSON_**.

#### Qu'est-ce que le format JSON ?

_JSON_ signifieÂ _JavaScript Object Notation_. Il s'agit d'un **format textuel** (contrairement Ã  un format binaire plus lÃ©ger mais impossible Ã 
lire Ã  l'Å“il humain), se rapprochant en termes de syntaxe de celui des objets dans le langage JavaScript.

Ainsi, l'objet JavaScript suivant :

```javascript
const obj = {
    name: "Mon contenu",
    id: 1234,
    message: "Voici mon contenu",
    author: {
        name: "John"
    },
    comments: [
        {
            id: 45,
            message: "Commentaire 1"
        },
        {
            id: 46,
            message: "Commentaire 2"
        }
    ]
};
```

sera retranscritÂ ainsi en JSON :

```json
{
    "name": "Mon contenu",
    "id": 1234,
    "message": "Voici mon contenu",
    "author": {
        "name": "John"
    },
    "comments": [
        {
            "id": 45,
            "message": "Commentaire 1"
        },
        {
            "id": 46,
            "message": "Commentaire 2"
        }
    ]
}
```

Vous pouvez voir comme la syntaxe est similaire entre les 2. Alors qu'en JavaScript il n'est pas nÃ©cessaire de mettre les propriÃ©tÃ©s (comme
`name`, `id`, `message`, etc.), entre guillemets,Â cela l'est en JSON. En JavaScript, votre objet est assignÃ© Ã  une variable, alors qu'en JSON
on ne fait que dÃ©crire une structure.

Le gros avantage de ce format lorsqu'il est utilisÃ© avec le langage JavaScript est qu'il n'y a pas besoin de leÂ _**parser**_ comme on le ferait
avec duÂ _XML_ par exemple. En effet, lorsque l'on manipule un format de donnÃ©es comme leÂ _XML_, (que vous pouvez comparer Ã  du HTML dans sa
forme) il est nÃ©cessaire de leÂ _parser_. C'est-Ã -dire que notre application doit le **lire** et le **comprendre** afin d'en faire ce qu'on veut.
C'est une opÃ©ration gÃ©nÃ©ralement complexe que l'on laisse Ã  du code externe dÃ©veloppÃ© et Ã©prouvÃ© par d'autres personnes, afin de gagner du
temps et d'Ã©viter les erreurs. Mais pour le JSON c'est diffÃ©rent, car c'est une syntaxe qui vient des **objets en JavaScript**. Ainsi, votre
navigateur sait directement le lire et le transformer en objets JavaScript. Si l'on reprend l'exemple de JSONÂ prÃ©cÃ©dent, il nous fournira donc
un objet JavaScript comme celui du premier Ã©chantillon de code ci-dessus.

Le deuxiÃ¨me avantage de ce format est sa **lÃ©gÃ¨retÃ©** par rapport Ã  un format comme leÂ _XML,_ qui reste bien plus verbeux, c'est-Ã -dire avec
plus de texte. C'est un gros avantage lorsqu'on communique avec un service web, car cela permet d'optimiser les temps de rÃ©ponse. En effet, un
nombre plus faible d'octets a besoin de transiter dans le rÃ©seau.

#### RÃ©cupÃ©rez le rÃ©sultat de la requÃªte

Avec tout ce que l'on vient d'apprendre, il n'est plus trÃ¨s difficile d'utiliser le rÃ©sultat de la requÃªte pour en faire ce que l'on veut. Pour
cela Fetch va nous renvoyer une **Promise**.

:::info
Pour faire simple : la _Promise_ est un objet qui fournit une fonction _then_ qui sera exÃ©cutÃ©e quand le rÃ©sultat aura Ã©tÃ© obtenu, et une
fonction _catch_ qui sera appelÃ©e sâ€™il y a une erreur qui est survenue lors de la requÃªte (Nous verrons tout cela plus en dÃ©tail dans la partie
3).
:::

Voici comment procÃ©der avec un service qui fait un simple echo :

```javascript
fetch("https://mockbin.com/request")
    .then(function(res) {
        if (res.ok) {
            return res.json();
        }
    })
    .then(function(value) {
        console.log(value);
    })
    .catch(function(err) {
        // Une erreur est survenue
    });
```

Vous pouvez voir dans l'exemple ci-dessus que l'URL passÃ©e Ã  la fonction `fetch()`Â a changÃ© et correspond Ã  lâ€™URL de notre service web. Le type
de requÃªte est GET (ce qui est le cas par dÃ©faut avec _Fetch_) car nous voulons rÃ©cupÃ©rer les donnÃ©es.

Ensuite nous appelons la fonction `then()` pour rÃ©cupÃ©rer le rÃ©sultat de la requÃªte au format _json_ en ayant vÃ©rifiÃ© au prÃ©alable que la
requÃªte sâ€™Ã©tait bien passÃ©e avec `res.ok`. Ce rÃ©sultat _json_ Ã©tant lui aussi une _Promise_, nous le retournons et rÃ©cupÃ©rons sa vraie valeur
dans la fonction `then()` suivante.

Voici ce que nous obtenons de lâ€™API Ã  lâ€™heure oÃ¹ jâ€™Ã©cris ces lignes :

<figure>
    <img src="https://user.oc-static.com/upload/2021/04/04/16175573146865_image8.png"
         alt="Un extrait JSON de la rÃ©ponse Ã  la requÃªte" />
    <figcaption>Extrait JSON</figcaption>
</figure>

### Ã€ vous de jouer !

![16189267631776_A-vous-de-jouer%20%282%29.png](https://user.oc-static.com/upload/2021/04/20/16189267631776_A-vous-de-jouer%20%282%29.png)

Exercez-vous maintenant avec ce que nous venons d'apprendre.

Rendez-vous dans [cet Ã©diteur CodePen](https://codepen.io/fabienhenon/pen/vYxYjpJ) pour rÃ©aliser l'exercice suivant :
Dans cet exercice nous voulons rÃ©cupÃ©rer les salutations et les afficher dÃ¨s que nous cliquons sur le bouton _"Bien le bonjour"_
- **Etape 1** : Nous allons commencer par la crÃ©ation d'une fonction `askHello`Â qui va crÃ©er une requÃªte avec fetch de type `GET`Â vers le
service web avec l'URL `https://mockbin.com/request?greetings=salut.`
- **Etape 2** : Maintenant, nous voudrions rÃ©cupÃ©rer la rÃ©ponse du service web et l'afficher dans l'Ã©lÃ©ment ayant pour ID `hello-result`.
Modifiez donc notre fonction `askHello`Â afin de rÃ©cupÃ©rer la rÃ©ponse du service web dÃ¨s que tout s'est bien passÃ©. Le service web vous
retournera une rÃ©ponse au format JSON, et vous aurez besoin d'afficher la propriÃ©tÃ© greetings se trouvant dans l'objet `queryString`.

Voici Ã  quoi ressemble la rÃ©ponse JSON :

```json
{
    "queryString": {
        "greetings": "Salut",
        ...
    },
    ...
}
```

- **Etape 3** : Enfin, nous voulons afficher la salutation (et donc appeler notre fonction `askHello`) dÃ¨s que nous cliquons sur le bouton
ayant pour ID `ask-hello`.

<CodePen codePenId="vYxYjpJ" />

```javascript
function askHello() {
  fetch("https://mockbin.com/request?greetings=salut")
  .then(function(res) {
    if (res.ok) {
      return res.json();
    }
  })
  .then(function(value) {
    document
        .getElementById("hello-result")
        .innerText = value.queryString.greetings;
  })
  .catch(function(err) {
    // Une erreur est survenue
  });
}

document
  .getElementById("ask-hello")
  .addEventListener("click", askHello);
```

:::info
Vous avez essayÃ© ? Voici la [correction CodePen](https://codepen.io/fabienhenon/pen/RwovXJd).
:::

<CodePen codePenId="RwovXJd" />

### En rÃ©sumÃ©

Dans ce chapitre, vous avez appris :
- Que lâ€™API Fetch permet de faire des requÃªtes HTTP vers un service web ;
- Comment l'utiliser pour faire une requÃªte simple Ã  un service web ;
- Que le format JSON est trÃ¨s utilisÃ© dans la communication avec les API des services web car il est trÃ¨s proche des objets JavaScript ;
- Comment rÃ©cupÃ©rer les donnÃ©es envoyÃ©es par un service web.

_Maintenant que nous savons faire une requÃªte de type GET pour rÃ©cupÃ©rer des donnÃ©es du service web, nous allons voir comment faire une requÃªte
POST pour envoyer des donnÃ©es au service web. Mais avant Ã§a, voyons comment prÃ©parer nos donnÃ©es Ã  Ãªtre envoyÃ©es au service web._

-----

## Validez les donnÃ©es saisies par vos utilisateurs

[Validez les donnÃ©es saisies par vos utilisateurs - Ã‰crivez du JavaScript pour le web - OpenClassrooms](https://openclassrooms.com/fr/courses/5543061-ecrivez-du-javascript-pour-le-web/5577611-validez-les-donnees-saisies-par-vos-utilisateurs)

<Vimeo vimeoId="539127837" />

<br />

Avant d'envoyer nos donnÃ©es Ã  un service web, il est nÃ©cessaire de les **valider**. C'est-Ã -dire que nous allons vÃ©rifier leur **cohÃ©rence**
par rapport Ã  ce que le service web attend.

Les donnÃ©es que l'on souhaite envoyer Ã  un service web viennent gÃ©nÃ©ralement de ce que l'utilisateur saisit dans un formulaire ; or, ce n'est
pas parce que vous lui avez explicitement demandÃ© d'entrer un numÃ©ro de tÃ©lÃ©phone qu'il va le faire...

### Never trust user input!

Ce qui se traduit littÃ©ralement par :Â **Ne faites jamais confiance aux donnÃ©es saisies par vos utilisateurs !**

Il est bon de le rappeler :

:::caution
Ne faites jamais confiance Ã  vos utilisateurs !
:::

Bon, maintenant je pense qu'il est temps d'expliquer pourquoi il faut Ãªtre si mÃ©fiant envers vos utilisateurs, et pourquoi c'est si important.

Certains de vos utilisateurs peuvent Ãªtre **malveillants** ou ils peuvent **ne pas bien comprendre** ce que vous souhaitez qu'ils fassent. Bref,
ils ne vont pas toujours entrer les donnÃ©es que vous attendez d'eux. Or, cela peut se rÃ©vÃ©ler dÃ©sastreux pour votre site web, et ce, de
plusieurs faÃ§ons :
- Si l'utilisateur ne comprend pas ce que vous attendez de lui, il peut entrer quelque chose qui ne vous convient pas. Votre service web ne
fera pas ce qu'il faut et l'utilisateur ne comprendra pas pourquoi Ã§a ne marche pas. Vous risquez de **perdre** cet utilisateur parce que vous
n'avez pas validÃ© les donnÃ©es saisies et affichÃ© un message d'erreur indiquant que les donnÃ©es ne sont pas celles attendues ;
- Pire encore, l'utilisateur pourrait **attaquer** votre service web en entrant des **donnÃ©esÂ malveillantes** dans un champ alors que vous
attendiez simplement un nom, par exemple. Dans ce cas, il pourrait prendre le contrÃ´le de votre service web, collecter des donnÃ©es utilisateurs,
se faire passer pour un administrateur, et j'en passe... (il existe des tonnes de ressources sur Internet donnant des exemples de ces types
d'attaques. Si cela vous intÃ©resse, je vous encourage Ã  faire quelques recherches) ;
- De la mÃªme maniÃ¨re, l'utilisateur pourrait **faire planter** votre application s'il entrait du texte dans un champ oÃ¹ vous attendiez un nombre.

Nous allons apprendre ici Ã  valider les donnÃ©es utilisateur sur votre site web avant de les envoyer Ã  votre service web. CelaÂ constitue un
premier rempart face aux problÃ¨mes citÃ©s plus haut, mÃªme si ce n'est pas suffisant,Â **il faudra toujours avoir une validation poussÃ©e des
donnÃ©es utilisateurs sur le service web**.

:::caution
C'est important, car rien n'empÃªchera un utilisateur malveillant d'utiliser un logiciel pour envoyer directement les requÃªtes HTTP malveillantes
Ã  votre service web. De cette maniÃ¨re, elles ne passeront pas par la case validation cÃ´tÃ© site web...
:::

### Validez les donnÃ©es suite Ã  des Ã©vÃ©nements

Afin de valider les donnÃ©es utilisateurs, vous pouvez vous aider des Ã©vÃ©nements duÂ _DOM_. Ainsi, vous pouvez Ã©couter l'Ã©vÃ©nementÂ `onChange` pour
vÃ©rifier la donnÃ©e, dÃ¨s que l'utilisateur a fini de l'Ã©diter. Ou bien vous pouvez Ã©couter l'Ã©vÃ©nement `onInput`Â pour vÃ©rifier la donnÃ©e Ã  chaque
nouveau caractÃ¨re.

Par exemple, vous pouvez vÃ©rifier que ce qui est saisi commence par `Hello` avec le code suivant :

```javascript
myInput.addEventListener('input', function(e) {
    var value = e.target.value;
    if (value.startsWith('Hello ')) {
        isValid = true;
    } else {
        isValid = false;
    }
});
```

### Faites une validation plus complexe avec les Regex

Si vous n'avez jamais entendu parlÃ© des _**Regex**,_ sachez qu'il s'agit d'un format spÃ©cial qui permet deÂ _matcher_ du texte, c'est-Ã -dire de
vÃ©rifier qu'un texte corresponde Ã  une _description_ que l'on a dÃ©finie. Ainsi, si l'on veut savoir si notre texte commence par la lettre `e` et
est suivi d'au moins 3 chiffres, on Ã©crira laÂ _regex_ suivante :

```javascript
function isValid(value) {
    return /^e[0-9]{3,}$/.test(value);
}
```

Cela peut paraÃ®tre barbare comme notation, mais c'est trÃ¨s puissant et trÃ¨s pratique !

:::info
Pour en savoir plus, [un peu de documentation](https://regexr.com/) ne fait pas de mal. ğŸ˜‰
:::

### DÃ©couvrez les contraintes HTML5

DepuisÂ _HTML_ version 5, il est possible d'ajouter de la validation **directement** dans le codeÂ HTML, sans avoir besoin d'Ã©crire la moindre
ligne deÂ JavaScript.

Pour cela, diffÃ©rents **attributs** sont ajoutÃ©s et permettent d'**empÃªcher la soumission d'un formulaire** si toutes les validations ne sont
pas respectÃ©es.

#### L'attribut type pour les inputs

Pour valider les informations saisies dans une balise `input`, il est possible d'utiliser l'attribut `type`.

L'attribut `type`Â de la balise `input`Â ne prend pas seulement comme valeurs `text`Â et `password`. Cela peut aussi Ãªtre `email`, `tel`, `URL`,
`date`Â et bien d'autres.

Lorsque vous ajoutez un Ã©lÃ©ment `input`Â avec un attributÂ `type="email"`, le navigateur empÃªchera la soumission du formulaire si ce n'est pas
une adresse email correcte.

#### Les attributs de validation simples

En fonction du `type`Â de l'`input`, vous pouvez utiliser diffÃ©rents attributs pour **perfectionner** votre validation :
- `min` / `max`Â : fonctionne avec des champs de type _**nombre**_ ou _**date**_. Cela permet de dÃ©finir une valeur minimum et une valeur
maximum autorisÃ©es ;
- `required`Â : fonctionne avec Ã  peu prÃ¨s **tous les types de champs**. Cela rend obligatoire le remplissage de ce champ ;
- `step`Â : fonctionne avec les **dates** ou les **nombres**. Cela permet de dÃ©finir une valeur d'incrÃ©ment lorsque vous changez la valeur du
champ via les flÃ¨ches ;
- `minlength`Â / `maxlength`Â : fonctionne avec les **champs textuels** (`text`, `url`, `tel`, `email`...). Cela permet de dÃ©finir un nombre de
caractÃ¨res minimum et maximum autorisÃ©.

#### Les patterns

Nous avons vu qu'il Ã©tait possible d'avoir une validation complexe grÃ¢ce auxÂ Regex enÂ JavaScript. Eh bien c'est aussi possible directement en
HTML5 avec l'attribut `pattern`. Il suffit de dÃ©finir uneÂ Regex dans cet attribut, et vous obligez la valeur du champ correspondant Ã  la
respecter.

Par exemple, si on prend le code suivant :

```html
<input type="text" pattern="[0-9]{,3}" />
```

il empÃªchera un utilisateur d'entrer autre chose que des chiffres, et limitera leur nombre Ã  3 chiffres.

:::info
Pour en savoir plus, vous pouvez aller faire un tour sur [MDN](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5/Constraint_validation)
(documentation en anglais).
:::

### Ã€ vous de jouerÂ !

![16189267631776_A-vous-de-jouer%20%282%29.png](https://user.oc-static.com/upload/2021/04/20/16189267631776_A-vous-de-jouer%20%282%29.png)

Voici quelques exercices pour vous faire les dentsÂ sur la validation ğŸ˜. Rendez-vous sur [cet Ã©diteur CodePen](https://codepen.io/nicolaspatschkowski/pen/GRJQvGY)
et rÃ©alisez les Ã©tapes suivantes:
1. Nous souhaitons dans un premier temps valider le champÂ `Code`Â du formulaire. A chaque lettre saisie dans le champ ayant pour IDÂ `code`Â nous
voulons vÃ©rifier que la valeur du champ commence bien parÂ `CODE-`Â grÃ¢ce Ã  uneÂ _Regex_Â que voici :Â `/^CODE-/`. Si la valeur commence bien par
`CODE-`Â alors nous affichons dans l'Ã©lÃ©ment ayant pour IDÂ `code-validation`Â :Â `Code valide`, sinon nous affichons dans cet Ã©lÃ©ment
`Code invalide`.
2. Maintenant que nous savons si notre code est valide ou non, nous voudrions griser (grÃ¢ce Ã  l'attributÂ `disabled`) le bouton de soumission
(L'input de typeÂ `submit`Â ayant pour IDÂ `submit-btn`) quand le code est invalide, et le dÃ©griser quand le code est valide.<br />
Cela signifie que nous allons devoir ajouter un attributÂ `disabled="true"`Â au bouton de soumission quand le code est invalide. Et supprimer cet
attributÂ `disabled`Â quand le code est valide (Rappelez-vous du cours sur la modification du DOM pour dÃ©finir et supprimer des attributs).
3. Finalement, nous avons un champÂ `Email`Â et nous voudrions le rendre obligatoire et obliger l'utilisateur Ã  entrer une adresse email valide.
Il faudra aussi empÃªcher le formulaire de se soumettre s'il n'est pas valide.<br />
Mais nous voudrions faire tout Ã§a uniquement avec le HTML5, sans utiliser de code JavaScript.<br />
Vous pouvez changer leÂ `type`Â du champ email plutÃ´t que d'utiliser une Regex viaÂ `pattern`Â ![;)](https://openclassrooms.com/bundles/common/images/smiley/clin.png)

<CodePen codePenId="GRJQvGY" />

```javascript
document
  .getElementById("code")
  .addEventListener("input", function(e) {
    if (/^CODE-/.test(e.target.value)) {
      document.getElementById("code-validation").innerText = "Code valide";
      document.getElementById("submit-btn").removeAttribute("disabled");
    } else {
      document.getElementById("code-validation").innerText = "Code invalide";
      document.getElementById("submit-btn").setAttribute("disabled", true);
    }
});
```

```html
<label>Email : <input type="email" name="email" required /></label>
```

Vous avez terminÃ© ? Voici la [solution CodePen](https://codepen.io/fabienhenon/pen/JjbxgaZ) !

<CodePen codePenId="JjbxgaZ" />

### En rÃ©sumÃ©

Dans ce chapitre, vous avez appris :
- Qu'il ne faut jamais faire confiance Ã  l'utilisateur ;
- Ã€ valider des donnÃ©es lors d'Ã©vÃ©nements ;
- Ã€ utiliser les Regex pour valider les donnÃ©es ;
- Ã€ utiliser les attributs fournis par HTML pour valider les donnÃ©es.

_Maintenant qu'on peut protÃ©ger notre site web de nos utilisateurs, et leur afficher de beaux messages d'erreur quand les donnÃ©es saisies ne
sont pas celles attendues, nous allons pouvoir sauvegarder nos donnÃ©es sur notre service web !_

-----

## Sauvegardez des donnÃ©es sur le service web

[Sauvegardez des donnÃ©es sur le service web - Ã‰crivez du JavaScript pour le web - OpenClassrooms](https://openclassrooms.com/fr/courses/5543061-ecrivez-du-javascript-pour-le-web/5577626-sauvegardez-des-donnees-sur-le-service-web)

<Vimeo vimeoId="539127891" />

<br />

### Envoyez des donnÃ©es, comment Ã§a marche ?

Nous avons vu prÃ©cÃ©demment que grÃ¢ce au protocoleÂ HTTP,Â nous pouvions demander Ã  rÃ©cupÃ©rer des donnÃ©es de notre service web.

Eh bien, c'est aussi possible d'en envoyer au service web en les ajoutant Ã  notre requÃªte !

Cependant, cela ne se fait pas avec toutes lesÂ mÃ©thodes (qu'on appelle aussi desÂ _verbs_)Â HTTP.Â En effet, la mÃ©thodeÂ **GET** estÂ seulement
faite pour rÃ©cupÃ©rer des donnÃ©es, alors que des mÃ©thodes commeÂ **POST** etÂ **PUT** sont faites pour en envoyer et en recevoir.

Le fonctionnement d'un verb Ã  l'autre est trÃ¨s similaire. Avec les verbsÂ **POST** etÂ **PUT**, nous allons simplement ajouter des donnÃ©es dans
le corps de notre requÃªte.

### Envoyez des donnÃ©es avec une requÃªte POST

Afin d'envoyer des donnÃ©es Ã  un service web avec la mÃ©thode **POST** via AJAX, nous allons devoir passer par la mÃ©thodeÂ `send()` en lui passant
en paramÃ¨tres les donnÃ©es Ã  envoyer.

```javascript
fetch("http://url-service-web.com/api/users", {
    method: "POST",
    headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
    },
    body: JSON.stringify(jsonBody)
});
```

Comme vous pouvez le voir, nous avons passÃ© le contenu Ã  envoyer au service web Ã  notre fonction `fetch()`. Ã‰tant donnÃ© que l'on souhaite
**envoyer du JSON** Ã  notre service web, nous avons d'abord besoin de transformer notre objet JavaScript en JSON (qui, rappelons-le, est un
format textuel, c'est-Ã -dire que c'est simplement du texte, contrairement Ã  un objet JavaScript qui est une structure complexe du langage).

Pour faire cette transformation, nous utilisons la fonction `JSON.stringify(json)`. Toujours parce que l'on souhaite envoyer du JSON Ã  notre
service web, il faut alors le prÃ©venir qu'il va **recevoir du JSON**. Cela se fait grÃ¢ce Ã  des **headers**, qui sont des en-tÃªtes envoyÃ©s en
mÃªme temps que la requÃªte pour donner plus d'informations sur celle-ci. Les headers en question sontÂ  :
- `Content-Type`, avec la valeurÂ  application/json,
- `Accept`, avec la valeur application/json .

Ces options sont envoyÃ©es avec la requÃªte grÃ¢ce au second paramÃ¨tre de la fonction _fetch()_. Ce paramÃ¨tre est un objet qui permet de dÃ©finir :Â 
- la **mÃ©thode HTTP**, le **body**, câ€™est Ã  dire les donnÃ©es quâ€™on souhaite envoyer,
- les **headers** qui donnent un peu plus dâ€™information sur notre requÃªte.

:::info
_PUT_ fonctionne exactement de la mÃªme maniÃ¨re que _POST_.
:::

### Ã€ vous de jouer !

![16189267631776_A-vous-de-jouer%20%282%29.png](https://user.oc-static.com/upload/2021/04/20/16189267631776_A-vous-de-jouer%20%282%29.png)

Voici un petit exercice, Ã  rÃ©aliser sur [cet Ã©diteur CodePen](https://codepen.io/nicolaspatschkowski/pen/OJVQjBq).

Dans cet exercice nous voulons pouvoir entrer du texte dans le formulaire et l'envoyer vers un service web. Ce service web va simplement nous
renvoyer notre contenu en plus d'autres informations et nous allons afficher le contenu renvoyÃ© par le serveur.
1. Nous allons commencer par crÃ©er une fonction appelÃ©eÂ `send`Â et qui va crÃ©er notreÂ requÃªte.<br />
Nous souhaitons crÃ©er une requÃªte de typeÂ `POST`Â vers l'adresse suivante :Â `https://mockbin.com/request`, et y envoyer un contenu JSON ayant
une propriÃ©tÃ©Â `value`Â qui contiendra la valeur du champ de saisie de la page (avec l'IDÂ `value`). Par exemple :
`{value: document.getElementById("value").value}`.<br />
Nous souhaitons aussi, lorsque la requÃªte s'est bien envoyÃ©e, afficher le rÃ©sulat renvoyÃ© par le service web. Pour ce faire, nous allons
afficher ce qui se trouve dansÂ `postData.text`Â de la rÃ©ponse dans le contenu HTML de l'Ã©lÃ©ment ayant pour IDÂ `result`.
2. Maintenant nous voulons envoyer notre requÃªte, et donc appeler notre fonctionÂ `send`Â dÃ¨s que nous soumettons le formulaire ayant pour ID
`form`.

N'oubliez pas d'annuler le comportement par dÃ©faut de la soumission du formulaire, sinon votre page va se recharger.

<CodePen codePenId="OJVQjBq" />

```javascript
function send(e) {
  e.preventDefault();
  fetch("https://mockbin.com/request", {
    method: "POST",
    headers: {
      'Accept': 'application/json', 
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({value: document.getElementById("value").value})
  })
  .then(function(res) {
    if (res.ok) {
      return res.json();
    }
  })
  .then(function(value) {
      document
        .getElementById("result")
        .innerText = value.postData.text;
  });
}

document
  .getElementById("form")
  .addEventListener("submit", send);
```

Voici le [CodePen avec la solution](https://codepen.io/fabienhenon/pen/GRNepeG)Â pour vous corriger. ğŸ˜‰

<CodePen codePenId="GRNepeG" />

### En rÃ©sumÃ©

Dans ce chapitre, vous avez appris :
- Que l'envoi de donnÃ©es en HTTP seÂ fait via certains verbs : `POST`Â ou `PUT`.
- Ã€ envoyer des donnÃ©es en HTTP.

_Vous savez comment envoyer des requÃªtes Ã  un service web pour lui demander des ressources ou en crÃ©er de nouvelles. Dans la partie suivante,
nous aborderons l'asynchronisme enÂ JavaScript afin d'exÃ©cuter du code en "parallÃ¨le"._

-----

## Quiz : Communiquez avec un service web

[Communiquez avec un service web - OpenClassrooms](https://openclassrooms.com/fr/courses/5543061-ecrivez-du-javascript-pour-le-web/exercises/3182)

#### CompÃ©tences Ã©valuÃ©es

<i class="bi bi-check2-circle"></i> Communiquer avec un service web

-----

#### Question 1 : Qu'est-ce que le HTTP ?

<i class="bi bi-circle"></i> Un protocole permettant de communiquer avec tout ce qu'on veut<br />
<i class="bi bi-record-circle"></i> Un protocole permettant de communiquer avec un service web<br />
<i class="bi bi-circle"></i> Un objet JavaScript permettant de communiquer avec tout ce qu'on veut<br />
<i class="bi bi-circle"></i> Un objet JavaScript permettant de communiquer avec un service web<br />
<br />

_HTTP est un protocole permettant de communiquer avec des services web. Il signifieÂ **HyperText Transfer Protocol**._

-----

#### Question 2 : Quel objet permet de crÃ©er des requÃªtes HTTP en JavaScript ?

<i class="bi bi-circle"></i><code>HttpRequest</code><br />
<i class="bi bi-circle"></i><code>FetchRequest</code><br />
<i class="bi bi-circle"></i><code>HttpFetch</code><br />
<i class="bi bi-record-circle"></i><code>Fetch</code><br />
<br />

_C'est `Fetch` qui permet de faire des requÃªtes HTTP vers un service web en JavaScript._

_Elle prend en paramÃ¨tre lâ€™URL de destination ainsi que des options liÃ©es au paramÃ©trage de la requÃªte HTTP, et elle nous renverra une
`Promise` contenant la rÃ©ponse du service web. Pour plus dâ€™informations, je vous invite Ã  lire la [documentation de Fetch](https://developer.mozilla.org/fr/docs/Web/API/Fetch_API/Using_Fetch)._

-----

#### Question 3 : Qu'est-ce que le JSON ?

<i class="bi bi-circle"></i> Un format de donnÃ©es binaire, illisible et difficile Ã  parser<br />
<i class="bi bi-record-circle"></i> Un format textuel, peu verbeux et trÃ¨s proche de la syntaxe des objets JavaScript<br />
<i class="bi bi-circle"></i> Un format textuel, trÃ¨s verbeux, mais que l'on peut tout de mÃªme utiliser en JavaScript<br />
<br />

_JSON signifie : **JavaScript Object Notation**. Il s'agit d'un format textuel trÃ¨s simple et peu verbeux, que JavaScript comprend trÃ¨s
facilement car il est proche de sa syntaxe objet (d'oÃ¹ son nom)._

-----

#### Question 4 : Que fait cet extrait ?

```javascript
JSON.parse(value)
```

<i class="bi bi-record-circle"></i> Il transforme un contenu JSON en objet JavaScript<br />
<i class="bi bi-circle"></i> Il transforme un objet JavaScript en contenu JSON<br />
<i class="bi bi-circle"></i> La fonction Â `parse`Â  nâ€™existe pas<br />
<br />

_`JSON.parse(value)` permet bien de transformer du texte JSON en un objet JavaScript._

-----

#### Question 5 : Que fait cet extrait ?

```javascript
JSON.stringify(value)
```

<i class="bi bi-circle"></i> Il transforme un contenu JSON en objet JavaScript<br />
<i class="bi bi-record-circle"></i> Il transforme un objet JavaScript en contenu JSON<br />
<i class="bi bi-circle"></i> La fonction stringify nâ€™existe pas<br />
<br />

_`JSON.stringify(value)` va transformer un objet JavaScript passÃ© en paramÃ¨tre en un texte au format JSON._

-----

#### Question 6 : Que va afficher cet extrait dans la console ?

```javascript
fetch("http://url-de-mon-service")
    .then(function(res) {
        console.log(res.json());
    });
```

<i class="bi bi-circle"></i> Une Promise qui sera rÃ©solue avec le contenu au format JSON de la rÃ©ponse Ã  la requÃªte GET<br />
<i class="bi bi-record-circle"></i> Une Promise qui sera rÃ©solue avec lâ€™objet JavaScript qui correspond Ã  la rÃ©ponse Ã  la requÃªte GET (parsÃ©e
depuis du JSON)<br />
<i class="bi bi-circle"></i> Le contenu de la rÃ©ponse Ã  la requÃªte GET au format JSON<br />
<i class="bi bi-circle"></i> Le contenu de la rÃ©ponse Ã  la requÃªte GET directement en objet JavaScript<br />
<br />

_Il s'agit de la 2e rÃ©ponse. En effet, la fonction `json()`Â permet de transformer du contenu JSON en objet JavaScript. Mais elle ne retourne
pas directement lâ€™objet, elle retourne une Promise, qui devra Ãªtre rÃ©solue._

-----

#### Question 7 : Comment sera traitÃ© ce champ ?

```html
<input type=â€emailâ€ required />
```

<i class="bi bi-record-circle"></i> Il sera obligatoire et devra Ãªtre au format dâ€™un e-mail<br />
<i class="bi bi-circle"></i> Il sera obligatoire mais pourra contenir nâ€™importe quoi, dont une adresse e-mail<br />
<i class="bi bi-circle"></i> Il nâ€™est pas obligatoire mais doit contenir une adresse e-mail<br />
<i class="bi bi-circle"></i> Il nâ€™est obligatoire que sâ€™il contient une adresse e-mail<br />
<br />

_Pour forcer le champ Ã  Ãªtre une adresse e-mail, il faut que son `type` soit `email`. Pour obliger l'utilisateur Ã  entrer une valeur dans ce
champ, il faut lui ajouter l'attribut `required`._

-----

#### Question 8 : Que fait cet extrait ?

```javascript
fetch("http://url-service-web", {
    method: â€œPOSTâ€,
    headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({foo: â€œbarâ€})
});
```

<i class="bi bi-circle"></i> Il fait une requÃªte de type GET avec le contenu JSON <code>"&#123;"foo": "bar"}"</code><br />
<i class="bi bi-record-circle"></i> Il fait une requÃªte de type POST avec le contenu JSON <code>"&#123;"foo": "bar"}"</code><br />
<i class="bi bi-circle"></i> Il fait une requÃªte de type GET avec le contenu JSON <code>&#123;foo: "bar"}</code><br />
<i class="bi bi-circle"></i> Il fait une requÃªte de type POST avec le contenu JSON <code>&#123;foo: "bar"}</code><br />
<br />

_Faites bien attention au fait que la fonction JSON.stringify transforme notre objet JavaScript en JSON, et que le JSON nâ€™est rien dâ€™autre que
du texte. Dans notre exemple, la rÃ©ponse 4 nâ€™est pas valide car `{foo: "barâ€}` est du JavaScript et non du JSON._

