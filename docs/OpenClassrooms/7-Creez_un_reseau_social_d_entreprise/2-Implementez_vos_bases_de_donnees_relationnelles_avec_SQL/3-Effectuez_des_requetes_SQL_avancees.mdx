---
sidebar_position: 4
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import { Vimeo } from 'mdx-embed';

# Effectuez des requ√™tes SQL avanc√©es

## Extrayez des informations sp√©cifiques de votre BDD

[Extrayez des informations sp√©cifiques de votre BDD - Impl√©mentez vos bases de donn√©es relationnelles avec SQL - OpenClassrooms](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142269-extrayez-des-informations-specifiques-de-votre-bdd)

<Vimeo vimeoId="497953053" />

<br />

Maintenant que votre base de donn√©es est remplie, il serait temps d‚Äôen extraire des informations pertinentes. En effet, il serait peu utile
d‚Äôavoir une BDD si cette derni√®re ne pouvait que stocker de l‚Äôinformation et la ressortir ‚Äúb√™tement‚Äù.

Vous allez apprendre dans cette partie comment extraire uniquement l‚Äôinformation qui vous int√©resse, et en tirer quelques enseignements !

Avant tout, t√©l√©chargez la [base de donn√©es Foodly](https://github.com/OpenClassrooms-Student-Center/Course-implementez-BDD-SQL/blob/master/partie_3/foodly.sql)
pour cette partie.

Vous √™tes pr√™t ? Allons-y !

### Isolez un objet unique

Dans la partie pr√©c√©dente, √† chaque fois que vous lisiez de la donn√©e, c‚Äô√©tait celle d‚Äôune table toute enti√®re.

:::info
Pour rappel, une commande telle que `SELECT * FROM aliment;` va vous afficher **tous les aliments** de votre BDD.
:::

Or, c‚Äôest rarement ce que l‚Äôon souhaite.

Imaginons un utilisateur dans votre application Foodly. Il est en train de scanner un aliment lors de ses courses. L‚Äôapplication demandera √† la
BDD de lui **restituer l‚Äôaliment en question**.

Pour ce faire, il existe une commande en SQL que l‚Äôapplication pourra utiliser pour r√©cup√©rer **uniquement** cet aliment.

:::info
Il s‚Äôagit de la commande **`WHERE`**.
:::

Si vous vous souvenez bien, vous aviez utilis√© cette commande dans la partie pr√©c√©dente afin de restreindre une commande √† un seul aliment ou
utilisateur, gr√¢ce √† son id.

Par exemple, la commande :

```sql
SELECT * FROM aliment WHERE id = 4;
```

va nous restituer uniquement l‚Äôaliment dont l‚Äôid est le num√©ro 4 !

**`WHERE` ne se limite pas uniquement aux id**. Comment √©cririez-vous la commande pour r√©cup√©rer l‚Äôaliment poire uniquement ? R√©fl√©chissez bien,
je suis s√ªr que vous pouvez trouver !

Vous donnez votre langue au chat ? üê±

La voici :

```sql
SELECT * FROM aliment WHERE nom = ‚Äúpoire‚Äù;
```

Eh oui, c‚Äôest aussi simple que √ßa !

Vous pouvez appliquer `WHERE` √† n‚Äôimporte quelle colonne en utilisant le nom de cette colonne.

:::info
√Ä noter que `WHERE` peut s'ex√©cuter avec `SELECT`, mais aussi avec n‚Äôimporte quelle autre commande : vous pouvez l‚Äôutiliser avec `UPDATE` ou
`DELETE` pour ne mettre √† jour ou supprimer qu‚Äôun objet sp√©cifique, et non tous les objets de votre table !
:::

### Isolez plusieurs objets r√©pondant √† un crit√®re de comparaison

OK, c‚Äôest utile de ne pouvoir s√©lectionner qu‚Äôun seul objet. Mais admettons que votre utilisateur souhaite voir tous les aliments bio de son
hypermarch√©, ou bien ceux qui ne sont pas trop caloriques.

:::note ?
Comment traduire cela en SQL ?
:::

`WHERE` fonctionne avec un principe de comparaison. Dans vos pr√©c√©dentes commandes, vous utilisiez l‚Äôop√©rateur √©gal (=) pour indiquer que vous
ne vouliez **que** l‚Äôobjet dont le nom √©tait √©gal √† une valeur.

Or, vous pouvez utiliser tous les op√©rateurs classiques, tels que :
- sup√©rieur √† ( > );
- inf√©rieur √† ( < );
- sup√©rieur ou √©gal √† (>=) ;
- et inf√©rieur ou √©gal √† (<=).

> Par exemple, comment afficher tous les aliments dont la teneur en calories n‚Äôexc√®de pas (strictement) 90 kcal ?
> 
> Je vous laisse un peu de temps pour tester la commande de votre c√¥t√©‚Ä¶
> 
> Voici la r√©ponse :

```sql
SELECT * FROM aliment WHERE calories < 90;
```

:::info
Et voil√†, vous voici d√©sormais pr√™t √† filtrer vos commandes comme bon vous semble avec le mot cl√© `WHERE` !
:::

### Isolez des objets √† partir d‚Äôune comparaison sur du texte

:::caution
La limite de `WHERE` est que la comparaison ne peut s‚Äôeffectuer que sur des **donn√©es chiffr√©es**.
:::

D√®s que vous souhaitez filtrer une donn√©e sur du texte, en dehors de l‚Äôop√©rateur √©gal, √ßa devient impossible.

:::note ?
Vraiment impossible ?
:::

:::info
Non ! Il existe un autre mot cl√© pour effectuer des comparaisons sur du texte : il s‚Äôagit du mot cl√© **`LIKE`**.
:::

Ce dernier permet de s√©lectionner les objets dont le texte d‚Äôune colonne r√©pond √† un mod√®le sp√©cifique. C‚Äôest en fait lui-m√™me un op√©rateur,
car il s‚Äôajoute au sein d‚Äôune commande `WHERE`.

> Prenons par exemple cette commande :
> ```sql
> SELECT * FROM utilisateur WHERE email LIKE ‚Äú%gmail.com‚Äù;
> ```
> 
> √Ä votre avis, que donne cette commande ?
> 
> Tapez-la dans votre terminal et regardez. üòâ

Eh oui, elle vous affiche tous les utilisateurs dont l‚Äôe-mail se termine par ‚Äúgmail.com‚Äù.

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109613837168_P3_email%20LIKE_static.png"
         alt="R√©capitulatif visuel du paragraphe r√©dig√© ci-dessous" />
    <figcaption>L‚Äôutilisation du pourcentage (%)</figcaption>
</figure>

:::info
Ce ‚Äú%gmail.com‚Äù signifie que vous souhaitez r√©cup√©rer tout texte finissant par ‚Äúgmail.com‚Äù. Le pourcentage (%) indique √† SQL :
- ‚Äúil peut y avoir autant de texte que tu veux, et aussi long que tu veux **avant** le ‚Äúgmail.com‚Äù ;
- ‚Äúne pr√™te pas attention au contenu qu‚Äôil y a avant _gmail.com_.‚Äù

Si vous souhaitiez r√©cup√©rer le texte qui commence par ‚Äúgmail.com‚Äù vous √©cririez : ‚Äúgmail.com%‚Äù.

Enfin, si vous cherchiez tout texte qui contient ‚Äúgmail‚Äù, peu importe qu‚Äôil soit au d√©but ou √† la fin, vous √©cririez ‚Äú%gmail%‚Äù.
:::

### Ordonnez les objets r√©cup√©r√©s pour chaque requ√™te

Reprenons l‚Äôexemple de notre utilisateur qui cherche √† afficher les aliments peu caloriques dans Foodly.

Gr√¢ce √† ce que vous avez appris, vous pouvez d√©sormais afficher les aliments dont les calories ne d√©passent pas un certain seuil.

:::note ?
Ne serait-il pas encore plus utile pour notre utilisateur d‚Äôafficher les aliments par **ordre croissant** de calories ?
:::

C‚Äôest possible en SQL. Et ce, gr√¢ce au mot cl√© **`ORDER BY`**.

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/1610961499497_P3_ORDER-BY_static_V3.png"
         alt="R√©capitulatif visuel du paragraphe r√©dig√© ci-dessous" />
    <figcaption>Le mot cl√© ODER BY</figcaption>
</figure>

Ce mot cl√© vous permet d‚Äôordonner une colonne par ordre croissant (_ascending_ en anglais, d‚Äôo√π le mot cl√© SQL **`ASC`**), ou d√©croissant
(_descending_ en anglais, soit le mot cl√©**`DESC`**).

Voici donc la commande √† effectuer pour afficher les aliments par ordre croissant de calories :

```sql
SELECT * FROM aliment ORDER BY calories ASC;
```

Bien s√ªr, vous pouvez mixer les commandes entre elles ! Voici la commande pour n‚Äôafficher que les aliments dont les calories ne d√©passent pas
90 kcal, mais de mani√®re d√©croissante :

```sql
SELECT * FROM aliment WHERE calories < 90 ORDER BY calories DESC;
```

:::info
Cette commande fonctionne aussi avec le texte ! Si vous effectuez un `ORDER BY` sur une colonne de texte, celle-ci sera ordonn√©e :
- soit dans l‚Äôordre alphab√©tique (`ASC`).

Par exemple, `SELECT * FROM utilisateurs ORDER BY prenom ASC;` affiche les utilisateurs avec les pr√©noms affich√©s par ordre alphab√©tique ;

- soit dans l‚Äôordre oppos√© ( `DESC` ).

Par exemple : `SELECT * FROM utilisateurs ORDER BY prenom DESC;` affiche les utilisateurs avec les pr√©noms affich√©s par ordre anti-alphab√©tique.
:::

### √Ä vous de jouer !

Imaginons que je vous demande tous les aliments qui ne sont pas bio dans la base, class√©s par ordre d√©croissant de contenance en prot√©ines.

Comment allez-vous faire cela ?

Prenez un peu de temps pour y r√©fl√©chir, tentez d‚Äôeffectuer la commande vous-m√™me, et on se retrouve pour la correction dans le screencast
ci-dessous. üëá

```sql
mysql > SELECT * FROM aliment WHERE bio = false ORDER BY proteines DESC;
```

<Vimeo vimeoId="497578203" />

<br />

### En r√©sum√©

- Vous avez appris comment **filtrer** la donn√©e que vous souhaitez r√©cup√©rer avec la commande **`WHERE`** (et les op√©rateurs comme **`=`** ou
**`LIKE`**).
- Vous savez d√©sormais **ordonner** les r√©sultats d‚Äôune requ√™te SQL avec la commande **`ORDER BY`**.

_Et si nous allions encore un peu plus loin dans les requ√™tes SQL ? Voyons au chapitre suivant comment effectuer des op√©ration math√©matiques.
Rien que √ßa !_

-----

## Effectuez des op√©rations et sauvegardez vos requ√™tes

[Effectuez des op√©rations et sauvegardez vos requ√™tes - Impl√©mentez vos bases de donn√©es relationnelles avec SQL - OpenClassrooms](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7152961-effectuez-des-operations-et-sauvegardez-vos-requetes)

![](https://user.oc-static.com/upload/2021/01/26/16116830811436_BANNERS_%20P3C2.png)

### Comptez le nombre d‚Äôobjets r√©cup√©r√©s via une requ√™te

Combien d‚Äôobjets r√©pondent √† un crit√®re (ou une requ√™te SQL) donn√© ?

Par exemple, admettons qu‚Äôun utilisateur de Foodly souhaite savoir combien il existe d‚Äôaliments bio, ou que vous souhaitiez compter le nombre
d‚Äôutilisateurs dans l‚Äôapplication.

:::note ?
Comment pourrait-on retranscrire cela en SQL ?
:::

Il existe le mot cl√© **`COUNT`**, qui permet justement cela. Appliqu√© √† n‚Äôimporte quelle commande SQL de type `SELECT`, il vous donnera le
**nombre d‚Äôobjets** r√©cup√©r√©s plut√¥t que leur valeur.

:::info
En plus de ne faire ‚Äúque compter‚Äù, `COUNT` est bien plus rapide √† effectuer qu‚Äôun `SELECT` ‚Äúclassique‚Äù pour votre base de donn√©es. Le SGBD et
la BDD arriveront √† retrouver le r√©sultat de votre commande bien plus rapidement (parfois, la diff√©rence se compte en minutes !). Privil√©giez-le
avant d‚Äôeffectuer des requ√™tes sur un large groupe de donn√©es !
:::

Vous souvenez-vous de la commande que nous avions effectu√©e pour r√©cup√©rer uniquement les utilisateurs dont l‚Äôe-mail √©tait un Gmail ? Comment
l‚Äôadapter pour conna√Ætre le nombre d‚Äôutilisateurs avec une adresse Gmail dans la base ?

C‚Äôest simple, voici la commande :

```sql
SELECT COUNT(*) FROM utilisateur WHERE email LIKE "%gmail.com";
```

Copiez et collez cette commande dans votre terminal. Que voyez-vous ?

MySQL vous affiche le nombre d‚Äôobjets plut√¥t que leur contenu. Vous voyez donc combien d‚Äôutilisateurs r√©pondent √† ce crit√®re.

:::info
En appliquant un `COUNT(*)`, vous comptez le nombre d‚Äôobjets. Mais vous pouvez aussi restreindre le comptage √† une colonne sp√©cifique en
√©crivant `COUNT(colonne)`. Enfin, vous pouvez aussi compter le nombre d‚Äô√©l√©ments uniques d‚Äôune colonne avec `COUNT(DISTINCT colonne)`.
:::

> Par exemple, `SELECT COUNT(*) FROM utilisateur;` compte tous les utilisateurs, tandis que `SELECT COUNT(nom) FROM utilisateur;` compte tous
les noms de famille.

Ok, vous allez me dire qu‚Äôon trouve exactement le m√™me nombre. Et c‚Äôest vrai. Compter dans une colonne prend vraiment son sens en comptant le
nombre de **valeurs distinctes**.

> Par exemple, `SELECT COUNT(DISTINCT nom) FROM utilisateur;` comptera uniquement les noms de familles diff√©rents, vous permettant de voir si
certains utilisateurs ont le m√™me nom !

### Effectuez des op√©rations sur des donn√©es chiffr√©es

:::note ?
Si l‚Äôon peut compter, pourquoi ne pas directement effectuer des op√©rations ?
:::

Admettons que l‚Äôon souhaite conna√Ætre le total calorique d‚Äôun groupe d‚Äôarticles, ou bien la contenance moyenne en sucre d‚Äôun groupe d‚Äôaliments :
au lieu de tout noter √† la main depuis la base de donn√©es, laissez MySQL effectuer ces op√©rations pour vous !

Pour cela, il existe plusieurs mots cl√©s que vous pouvez appliquer √† une colonne lors d‚Äôune requ√™te pour en modifier le r√©sultat :
- `AVG` : nous donne la moyenne de la colonne sur la s√©lection ;
- `SUM` : nous donne la somme de la colonne sur la s√©lection ;
- `MAX` : nous donne le maximum de la colonne sur la s√©lection ;
- `MIN` : nous donne le minimum de la colonne sur la s√©lection.

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109617725758_P3_operations_static.png"
         alt="R√©capitulatif visuel du paragraphe r√©dig√© ci-dessus" />
    <figcaption>Les r√®gles d'op√©ration</figcaption>
</figure>

Envie de conna√Ætre le maximum de teneur en sucre des aliments dans notre base ? Rien de plus simple :

```sql
SELECT MAX(sucre) FROM aliment;
```

Plus compliqu√© : quelle est la teneur moyenne en calories des aliments de 30 kcal ou plus :

```sql
SELECT AVG(calories) FROM aliment WHERE calories >= 30;
```

#### √Ä vous de jouer !

Je vous laisse tester ces op√©rations avec `MIN` et `SUM` !

Pour voir √† quoi cela ressemble dans le terminal, voici un screencast explicatif o√π je reprends une √† une toutes ces commandes sur la liste
des aliments qui ne sont pas bio :

Compter le nombre d'aliments non bio :

```sql
SELECT COUNT(*) FROM aliment WHERE bio = false; /* 14 */
```

Combien de proteines a l'aliment non bio qui en a le plus :

```sql
SELECT MAX(proteines) FROM aliment WHERE bio = false; /* 26.2 */
```

Combien de proteines a l'aliment non bio qui en a le moins :

```sql
SELECT MIN(proteines) FROM aliment WHERE bio = false; /* 0 */
```

Quelle moyenne en proteines ont les aliments non bio :

```sql
SELECT AVG(proteines) FROM aliment WHERE bio = false; /* 7.128571520958628 */
```

<Vimeo vimeoId="497578223" />

<br />

:::info
Gr√¢ce √† ces fonctions simples, vous pouvez commencer √† analyser les donn√©es de votre BDD. Vous devenez ainsi un vrai data analyste !
:::

### Sauvegardez vos requ√™tes avec CREATE VIEW

Je ne sais pas vous, mais personnellement, je d√©teste faire deux fois la m√™me chose.

Vous imaginez devoir retaper la m√™me commande SQL √† chaque fois que vous souhaitez extraire le m√™me type de donn√©es ? Un enfer. üò®

Heureusement pour nous, MySQL peut nous aider !

:::info
MySQL a un syst√®me de ‚Äúvues‚Äù qui permet de cr√©er des **tables temporaires** √† partir d‚Äôune commande SQL. Entendez par l√† que vous allez
‚Äúsauvegarder‚Äù une commande SQL pour ne plus avoir √† la r√©effectuer √† chaque fois !
:::

Admettons que vous souhaitiez sauvegarder dans une vue la commande suivante : les utilisateurs dont l‚Äôadresse mail est une adresse Gmail.
Comment faites-vous ?

Eh bien, vous utilisez la commande **`CREATE VIEW`** !

Voici la commande :

```sql
CREATE VIEW utilisateurs_gmail_vw AS SELECT * FROM utilisateur WHERE email LIKE "%gmail.com";
```

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109618304011_P3_CREATE%20VIEW-creer-une-vue_static.png"
         alt="R√©capitulatif visuel de la commande. utilisateurs_gmail_vw = nom de la vue √† cr√©er. AS SELECT*FROM utilisateur = depuis la table" />
    <figcaption>La commande CREATE VIEW</figcaption>
</figure>

Je viens de cr√©er la vue ‚Äúutilisateurs_gmail_vw‚Äù. Cette derni√®re s‚Äôutilise d√©sormais comme une table.

Ainsi, pour r√©cup√©rer les utilisateurs avec une adresse Gmail, plus besoin d‚Äô√©crire ma requ√™te compliqu√©e !

Je n‚Äôai plus qu‚Äô√† √©crire :

```sql
SELECT * FROM utilisateurs_gmail_vw;
```

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109619652866_P3_CREATE%20VIEW-faire-appel-vue_static.png"
         alt="R√©capitulatif visuel de la commande.  SELECT*FROM = r√©cup√©er la donn√©e. utilisateurs_gmail_vw =depuis la vue utilisateurs_gmail_vw" />
    <figcaption>Utilisation de la commande CREATION VIEW avec SELECT * FROM</figcaption>
</figure>

:::info
La convention chez les utilisateurs de SQL est de toujours pr√©fixer le nom d‚Äôune vue avec ‚Äú_vw‚Äù, pour la distinguer des ‚Äúvraies‚Äù tables.
:::

Le plus utile avec cela, c‚Äôest que la vue se comporte comme une vraie table. Vous pouvez ainsi r√©appliquer d‚Äôautres commandes SQL sur cette
derni√®re.

> Par exemple : afficher les utilisateurs dont l‚Äôadresse e-mail est une adresse Gmail ET dont le pr√©nom contient la lettre ‚Äúm‚Äù :

```sql
SELECT * FROM utilisateurs_gmail_vw WHERE prenom LIKE "%m%";
```

:::info
Gr√¢ce aux vues, vous pouvez ‚Äúraccourcir‚Äù des requ√™tes SQL complexes et r√©barbatives, vous permettant d‚Äôaller encore plus loin dans vos analyses !
:::

#### √Ä vous de jouer !

Essayez √† pr√©sent par vous-m√™me la cr√©ation d'une vue. Cr√©ez une vue reprenant notre liste des aliments non bio, class√©s par contenance en
prot√©ines (de mani√®re d√©croissante).

```sql
SELECT * FROM aliment WHERE bio = false ORDER BY proteines DESC;
```

```sql
CREATE VIEW aliments_non_bio_vw AS SELECT * FROM aliment WHERE bio = false ORDER BY proteines DESC;
```

```sql
SELECT * FROM aliments_non_bio_vw;
```

```sql
SELECT * FROM aliments_non_bio_vw WHERE proteines > 10;
```

Si vous √™tes coinc√©, la solution est disponible ci-dessous. üëá

<Vimeo vimeoId="497578240" />

<br />

### En r√©sum√©

- Vous avez appris √† effectuer des op√©rations math√©matiques simples avec des mots cl√©s comme **`COUNT`** ou **`AVG`**.
- Vous savez sauvegarder des requ√™tes avec `CREATE VIEW`.

_Avec ce que vous avez appris dans le chapitre pr√©c√©dent et celui-ci, vous √™tes devenu un champion des requ√™tes SQL avanc√©es ! Mais il manque
encore une corde √† votre arc : √©crire des requ√™tes permettant de r√©cup√©rer des relations entre diff√©rents objets. Voyons ensemble comment faire,
dans le chapitre suivant !_

-----

## Impl√©mentez des relations entre vos donn√©es gr√¢ce √† JOIN

[Impl√©mentez des relations entre vos donn√©es gr√¢ce √† JOIN - Impl√©mentez vos bases de donn√©es relationnelles avec SQL - OpenClassrooms](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142285-implementez-des-relations-entre-vos-donnees-grace-a-join)

<Vimeo vimeoId="497953070" />

<br />

Les bases de donn√©es SQL sont dites de type ‚Äú**relationnel**‚Äù. Cela sous-entend que leur force r√©side sur leur capacit√© √† **relier plusieurs
types de donn√©es entre elles**.

Pour l‚Äôinstant, vous avez utilis√© de la donn√©e sans relations. Par exemple, pour r√©cup√©rer ou mettre √† jour un utilisateur ou un aliment.

Or, si vous reprenez l‚Äôexemple de Foodly, l‚Äôapplication doit stocker les aliments qu‚Äôun utilisateur a scann√©s. Pour ce faire, il faut **stocker
les relations entre ces m√™mes utilisateurs et certains aliments**.

Nous verrons comment mettre en place de telles relations dans la partie 4. Mais en attendant, voyons comment r√©cup√©rer des objets selon les
relations qu‚Äôils ont entre eux.

### Extrayez des informations via une relation 1 √† plusieurs

Beaucoup d‚Äôutilisateurs vont utiliser Foodly, et ce, dans plusieurs pays.

Afin de pouvoir s‚Äôadapter √† chacun, l‚Äôapplication va devoir **stocker la langue pr√©f√©r√©e** de chaque utilisateur. Pour ce faire, la table
‚Äúlangue‚Äù a √©t√© rajout√©e √† la base de donn√©es Foodly [que vous avez t√©l√©charg√©e](https://github.com/OpenClassrooms-Student-Center/Course-implementez-BDD-SQL/blob/master/partie_3/foodly.sql)
au d√©but de cette partie.

Chaque utilisateur est reli√© √† une langue. Et chaque langue peut √™tre reli√©e √† plusieurs utilisateurs.

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109621275269_3c2_one-to-many.png"
         alt="Sch√©ma repr√©sentant 2 utilisateurs reli√©s √† une langue 1 et un utilisateurs reli√© √† une langue 2" />
    <figcaption>La relation un √† plusieurs entre les utilisateurs et les langues</figcaption>
</figure>

:::info
On parle alors d‚Äôune _relation 1 √† plusieurs_ entre utilisateur et langue (_one-to-many_, en anglais).
:::

Pour mat√©rialiser une telle relation dans une base SQL telle que MySQL, on suit un principe assez simple :

1. Dans ce cas sp√©cifique, une langue est reli√©e √† plusieurs utilisateurs. On cr√©e donc cet objet normalement, comme vous avez pu le faire
pr√©c√©demment.

```sql
INSERT INTO `langue` VALUES ('fran√ßais');
```

2. Chaque utilisateur se voyant reli√© √† une langue, c‚Äôest l‚Äôutilisateur qui va devoir stocker l‚Äôid unique de la langue associ√©e.<br />
Par convention, on utilise comme nom de ce champ `{nom de l‚Äôobjet associ√©}_id` (donc ici, `langue_id`).

Les utilisateurs de la base de donn√©es mise √† jour dans la partie 2 ont ainsi un champ `langue_id`, o√π est stock√© l‚Äôid de la langue qu‚Äôils
souhaitent utiliser.

> Par exemple, le premier utilisateur a comme langue_id 1, soit l‚Äôid du fran√ßais dans la table des langues.

Imaginez d√©sormais qu‚Äôon vous demande de ressortir toutes les langues utilis√©es par les 10 premiers utilisateurs, ou tous les utilisateurs
ayant configur√© Foodly en anglais.

Ce serait fastidieux de tout v√©rifier √† la main, non ? üò®

:::info
Eh bien, ne vous inqui√©tez pas. Il existe une commande qui est justement l√† pour r√©gler ce genre de probl√®me. La commande **`JOIN`**. üôå
:::

Gr√¢ce √† cette commande, vous allez pouvoir **expliquer √† MySQL comment joindre deux tables selon un identifiant qu‚Äôelles ont en commun**.

Partons du principe que :
- la langue_id du premier utilisateur est le fran√ßais ;
- l‚Äôid du fran√ßais est 1.

Vous allez sp√©cifier √† MySQL de **joindre** les tables ‚Äúutilisateur‚Äù et ‚Äúlangue‚Äù **en lui pr√©cisant que l‚Äôid de langue et langue_id de
l‚Äôutilisateur doivent √™tres √©gaux** !

Prenons un exemple. Regardons tous les utilisateurs avec les langues qui leur sont associ√©es. Tapez cette commande dans votre terminal :

```sql
SELECT * FROM `utilisateur`
JOIN `langue`
ON `utilisateur`.`langue_id` = `langue`.`id`;
```

Vous devriez obtenir [ce tableau](https://s3-eu-west-1.amazonaws.com/course.oc-static.com/courses/6971126/P3-C2-Tableau+resultats-relation+un+%C3%A0+plusieurs.xlsx),
o√π sont visibles les langues utilis√©es par chaque utilisateur.

| id | prenom | email | langue_id | id | nom | code_pays |
|----|--------|-------|-----------|----|-----|-----------|
| 1	 | quentin	| qentin@gmail.com	    | 1 | 1	| fran√ßais | fr-fr |
| 2	 | marie	| marie@hotmail.fr	    | 1 | 1	| fran√ßais | fr-fr |
| 5	 | pierre	| pp@orange.fr	        | 1 | 1	| fran√ßais | fr-fr |
| 6	 | lisa	    | lisadv@gmail.com	    | 1 | 1	| fran√ßais | fr-fr |
| 7	 | √©l√©onore	| glunt@sfr.com	        | 1 | 1	| fran√ßais | fr-fr |
| 10 | fabienne	| fabienne@yopmail.com	| 1 | 1	| fran√ßais | fr-fr |
| 3	 | vincent	| vm@yahoo.com	        | 2 | 2	| anglais | en-uk |
| 4	 | marc	    | marc@gmail.com	    | 2 | 2	| anglais | en-uk |
| 8	 | henry	| henry@outlook.fr	    | 2 | 2	| anglais | en-uk |
| 9	 | lionel	| hpp@gmail.com	        | 2 | 2	| anglais | en-uk |

Que s‚Äôest-il pass√© dans cette commande ?
- Nous avons demand√© √† MySQL de s√©lectionner tous les utilisateurs.
    - ``SELECT * FROM `utilisateur``
- Auxquels nous voulons joindre les langues.
    - ``JOIN `langue``
- En pr√©cisant √† MySQL de les relier, en consid√©rant que l‚Äôid de la langue est stock√©e dans chaque utilisateur dans le champ langue_id.
    - ``ON `utilisateur`.`langue_id` = `langue`.`id``

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109622117939_P3_LANGUE_static.png"
         alt="R√©capitulatif visuel du paragraphe r√©dig√© ci-dessus" />
    <figcaption>L'utilisation de la commande JOIN</figcaption>
</figure>

:::info
Ici, vous avez utilis√© la commande SQL pour lier **la totalit√©** d‚Äôune table (utilisateur) avec une autre (langue). Mais on peut tout √† fait
**limiter cette jointure** √† seulement **quelques objets** en particulier.
:::

### √Ä vous de jouer !

Admettons que je vous demande de me donner tous les noms de famille des utilisateurs ayant s√©lectionn√© le fran√ßais. Comment feriez-vous cela ?

```sql
SELECT * FROM utilisateur JOIN langue ON utilisateur.langue_id = langue.id WHERE langue.nom = 'fran√ßais';
```

Testez la commande et v√©rifiez la solution ci-dessous :

<Vimeo vimeoId="497578310" />

<br />

Voil√†, vous pouvez d√©sormais relier entre elles deux tables unies par une relation 1 √† plusieurs. Vous pouvez √™tre fier de vous ! üëè

Maintenant, passons √† la prochaine √©tape : les relations plusieurs √† plusieurs.

### Obtenez des informations complexes via une relation plusieurs √† plusieurs

Reprenons ensemble l‚Äôid√©e premi√®re de l‚Äôapplication Foodly. Cette derni√®re sert √† des utilisateurs (comme vous et moi) √† scanner des aliments.

Une fois ces aliments scann√©s, il serait plus qu‚Äôutile que la base de donn√©es les garde en m√©moire, afin que les utilisateurs puissent les
retrouver par la suite (pour par exemple faire leur prochaine liste de courses).

Pour ce faire, il faudrait un moyen de stocker dans la BDD tous les aliments qui ont √©t√© scann√©s par un utilisateur pr√©cis. Sachant que :
- un m√™me utilisateur peut stocker plusieurs aliments scann√©s ;
- un aliment peut lui-m√™me √™tre scann√© par plusieurs utilisateurs.

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109643615497_3c2_Many-to-many.png"
         alt="Sch√©ma repr√©sentant des utilisateurs reli√©s √† plusieurs aliments" />
    <figcaption>La relation un √† plusieurs entre les utilisateurs et les aliments</figcaption>
</figure>

On parle ici de _relation plusieurs √† plusieurs_. **Chaque objet d‚Äôune table pouvant √™tre reli√© √† plusieurs objets de l‚Äôautre table, et vice
versa.**

Or, tout ce que sait faire MySQL (et les bases de donn√©es SQL en g√©n√©ral), c‚Äôest de stocker une valeur unique par champ. **Il n‚Äôest pas
possible par exemple de stocker plusieurs id d‚Äôaliments au sein d‚Äôun m√™me utilisateur.**

:::info
Par d√©faut, le SQL ne sait mod√©liser que des relations 1 √† plusieurs.
:::

:::note ?
Comment faire dans ce cas ? ü§î
:::

Vous allez ‚Äútricher‚Äù. Une relation plusieurs √† plusieurs, c‚Äôest une multitude de relations 1 √† plusieurs.

:::note ?
Hum, oui mais encore ?
:::

Regardez les tables pr√©sentes dans la BDD que vous avez t√©l√©charg√©es pour cette partie. Voyez-vous une table appel√©e `utilisateur_aliment` ?

Celle-ci contient des `utilisateur_id` et des `aliment_id`. Vous l‚Äôavez peut-√™tre devin√© : elle sert √† **stocker des relations entre un
utilisateur et un aliment pr√©cis**.

:::info
On appelle **_table de liaison_** ce genre de table.<br />
Par convention, elle prend le nom `{table1}_{table2}`, et sert √† relier les tables 1 et 2 qui y sont stock√©es, en sauvegardant l‚Äôid d‚Äôun objet
de la table 1, √† l‚Äôid de l‚Äôobjet de la table 2 correspondant.
:::

En r√©cup√©rant tous les objets pr√©sents dans cette base, qui ne sont autres que des relations 1 √† plusieurs vers utilisateur et aliment, on peut
reconstituer les relations plusieurs √† plusieurs entre ces m√™mes utilisateurs et aliments !

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/21/16112243601326_3c2_table-liaison%20copie.png"
         alt="sch√©ma repr√©sentant √† gauche des utilisateurs et √† droites des aliments. Tous sont reli√©s gr√¢ce √† la table de liaison, au centre." />
    <figcaption>La table de liaison relie les utilisateurs aux aliments</figcaption>
</figure>

:::note ?
Comment cela se passe-t-il c√¥t√© SQL ? üòâ
:::

Eh bien, il s‚Äôagit toujours d‚Äôun bon vieux `JOIN` !

Voici la commande pour relier tous les utilisateurs aux aliments qu‚Äôils ont scann√©s :

```sql
SELECT * FROM utilisateur
JOIN utilisateur_aliment ON (utilisateur.id = utilisateur_aliment.utilisateur_id)
JOIN aliment ON (aliment.id = utilisateur_aliment.aliment_id);
```

:::info
D√©composons cette commande ensemble :
- Nous avons demand√© √† MySQL de s√©lectionner tous les utilisateurs.
   - ``SELECT * FROM `utilisateur``
- Auxquels nous voulons joindre la table utilisateur_aliment.
   - ``JOIN `utilisateur_aliment``
- En pr√©cisant √† MySQL de les relier en consid√©rant que l‚Äôid de l‚Äôutilisateur est stock√© en tant que utilisateur_id dans la table
utilisateur_aliment.
   - `ON (utilisateur.id = utilisateur_aliment.utilisateur_id)`
- √Ä ce `JOIN`, on veut √† nouveau lier de la donn√©e de la table aliment, soit un nouveau `JOIN`.
   - ``JOIN `aliment``
- Pour ce faire, on pr√©cise √† MySQL que l‚Äôid de l‚Äôaliment est stock√© dans utilisateur_aliment en tant que aliment_id.
   - `ON (aliment.id = utilisateur_aliment.utilisateur_id)`
:::

On obtient ce [magnifique tableau](https://s3-eu-west-1.amazonaws.com/course.oc-static.com/courses/6971126/P3-C2-Tableau+resultats-relation+plusieurs+%C3%A0+plusieurs.xlsx) o√π sont li√©s tous les utilisateurs aux aliments qu‚Äôils ont scann√©s.

| id | prenom | email | langue_id | utilisateur_id | aliment_id | id | nom | marque | sucre | calories | graisses | proteines | bio | reduction_id |
|----|--------|-------|-----------|----------------|------------|----|-----|--------|-------|----------|----------|-----------|-----|--------------|
| 1	 | quentin	| qentin@gmail.com	    | 1	| 1	 | 7	| 7	 | saumon	       | guyader	 | 0	| 206	| 12.3	| 22.1	| 0	|   |
| 1	 | quentin	| qentin@gmail.com	    | 1	| 1	 | 3	| 3	 | banane	       | chiquita	 | 24	| 101	| 0.3	| 1.1	| 0	|   |
| 1	 | quentin	| qentin@gmail.com	    | 1	| 1	 | 5	| 5	 | compote	       | andros	     | 11	| 51	| 0	    | 0.5	| 0	|   |
| 1	 | quentin	| qentin@gmail.com	    | 1	| 1	 | 17	| 17 | pomme de terre  | dor√©ac	     | 21.1	| 104	| 0.2	| 2.8	| 0	|   |
| 2	 | marie	| marie@hotmail.fr	    | 1	| 2	 | 2	| 2	 | poire	       | sans marque | 27.5	| 134	| 0.2	| 1.1	| 1	|   |
| 2	 | marie	| marie@hotmail.fr	    | 1	| 2	 | 19	| 19 | baguette	       | sans marque | 36.1	| 185	| 1.2	| 7.5	| 0	|   |
| 2	 | marie	| marie@hotmail.fr	    | 1	| 2	 | 14	| 14 | caf√©	           | carte noire | 0	| 0	    | 0	    | 0	    | 0	|   |
| 3	 | vincent	| vm@yahoo.com	        | 2	| 3	 | 4	| 4	 | jambon	       | herta	     | 0.2	| 34	| 0.8	| 6.6	| 0	|   |
| 3	 | vincent	| vm@yahoo.com	        | 2	| 3	 | 15	| 15 | jus d'orange	   | innocent	 | 16	| 74	| 0	    | 1.6	| 0	|   |
| 3	 | vincent	| vm@yahoo.com	        | 2	| 3	 | 12	| 12 | filet de poulet | le gaulois	 | 0	| 121	| 1.8	| 26.2	| 0	|   |
| 4	 | marc	    | marc@gmail.com	    | 2	| 4	 | 5	| 5	 | compote	       | andros	     | 11	| 51	| 0	    | 0.5	| 0	|   |
| 4	 | marc	    | marc@gmail.com	    | 2	| 4	 | 4	| 4	 | jambon	       | herta	     | 0.2	| 34	| 0.8	| 6.6	| 0	|   |
| 4	 | marc	    | marc@gmail.com	    | 2	| 4	 | 7	| 7	 | saumon	       | guyader     | 0	| 206	| 12.3	| 22.1	| 0	|   |
| 5	 | pierre	| pp@orange.fr	        | 1	| 5	 | 1	| 1	 | pomme	       | sans marque | 19.1	| 72	| 0.2	| 0.4	| 0	| 1 |
| 5	 | pierre	| pp@orange.fr	        | 1	| 5	 | 18	| 18 | oeuf	           | naturalia	 | 0.4	| 74	| 5.1	| 6.5	| 1	|   |
| 5	 | pierre	| pp@orange.fr	        | 1	| 5	 | 3	| 3	 | banane	       | chiquita	 | 24	| 101	| 0.3	| 1.1	| 0	|   |
| 6	 | lisa	    | lisadv@gmail.com	    | 1	| 6	 | 2	| 2	 | poire	       | sans marque | 27.5	| 134	| 0.2	| 1.1	| 1	|   |
| 6	 | lisa	    | lisadv@gmail.com	    | 1	| 6	 | 12	| 12 | filet de poulet | le gaulois	 | 0	| 121	| 1.8	| 26.2	| 0	|   |
| 6	 | lisa	    | lisadv@gmail.com	    | 1	| 6	 | 6	| 6	 | steak hach√©	   | charal	     | 0.8	| 68	| 4.8	| 4.8	| 0	|   |
| 7	 | √©l√©onore	| glunt@sfr.com	        | 1	| 7	 | 16	| 16 | jus de pomme	   | andros	     | 24	| 100	| 0.2	| 0.2	| 1	|   |
| 7	 | √©l√©onore	| glunt@sfr.com	        | 1	| 7	 | 19	| 19 | baguette	       | sans marque | 36.1	| 185	| 1.2	| 7.5	| 0	|   |
| 7	 | √©l√©onore	| glunt@sfr.com	        | 1	| 7	 | 1	| 1	 | pomme	       | sans marque | 19.1	| 72	| 0.2	| 0.4	| 0	| 1 |
| 8	 | henry	| henry@outlook.fr	    | 2	| 8	 | 3	| 3	 | banane	       | chiquita	 | 24	| 101	| 0.3	| 1.1	| 0	|   |
| 8	 | henry	| henry@outlook.fr	    | 2	| 8	 | 5	| 5	 | compote	       | andros	     | 11	| 51	| 0	    | 0.5	| 0	|   |
| 9	 | lionel	| hpp@gmail.com	        | 2	| 9	 | 18	| 18 | oeuf	           | naturalia	 | 0.4	| 74	| 5.1	| 6.5	| 1	|   |
| 9	 | lionel	| hpp@gmail.com	        | 2	| 9	 | 9	| 9	 | riz	           | oncle benz	 | 28.2	| 130	| 0.3	| 2.7	| 0	|   |
| 9	 | lionel	| hpp@gmail.com	        | 2	| 9	 | 14	| 14 | caf√©	           | carte noire | 0	| 0	    | 0	    | 0	    | 0	|   |
| 10 | fabienne	| fabienne@yopmail.com	| 1	| 10 | 16	| 16 | jus de pomme    | andros	     | 24	| 100	| 0.2	| 0.2	| 1	|   |
| 10 | fabienne	| fabienne@yopmail.com	| 1	| 10 | 3	| 3	 | banane	       | chiquita	 | 24	| 101	| 0.3	| 1.1	| 0	|   |


### √Ä vous de jouer !

Admettons que vous souhaitiez voir tous les aliments s√©lectionn√©s par les utilisateurs dont l‚Äôadresse e-mail et une adresse Gmail. Comment
feriez-vous ?

```sql
SELECT * FROM utilisateurs_gmail_vw
JOIN utilisateur_aliment ON (utilisateurs_gmail_vw.id = utilisateur_aliment.utilisateur.id)
JOIN aliment ON (aliment.id = utilisateur_aliment.aliment_id)
```

Faites le test et v√©rifiez votre commande avec ce screencast :

<Vimeo vimeoId="497578331" />

<br />

Vous voil√† capable de relier entre elles deux tables ayant une relation plusieurs √† plusieurs, via leur table de liaison. Vous √™tes tr√®s fort. üí™

### En r√©sum√©

- Vous savez d√©sormais **joindre** plusieurs objets entre eux gr√¢ce au mot cl√© **JOIN**.
- Et ce, que ce soit pour une relation **un √† plusieurs** ou pour une relation **plusieurs √† plusieurs** gr√¢ce √† une **table de liaison**.

_Maintenant que vous savez donner du sens √† la donn√©e pr√©sente dans votre BDD, il vous reste une ultime partie !_

_Vous allez y apprendre comment modifier la structure d‚Äôune base de donn√©es, afin de la faire √©voluer selon les besoins de votre application._

-----

```sql
mysql> SHOW tables;
+---------------------+
| Tables_in_foodly    |
+---------------------+
| aliment             |
| langue              |
| utilisateur         |
| utilisateur_aliment |
+---------------------+
4 rows in set (0,00 sec)
```

```sql
mysql> SHOW COLUMNS FROM aliment;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| id        | int          | NO   | PRI | NULL    | auto_increment |
| nom       | varchar(100) | NO   |     | NULL    |                |
| marque    | varchar(100) | YES  |     | NULL    |                |
| sucre     | float        | YES  |     | NULL    |                |
| calories  | int          | NO   |     | NULL    |                |
| graisses  | float        | YES  |     | NULL    |                |
| proteines | float        | YES  |     | NULL    |                |
| bio       | tinyint(1)   | YES  |     | 0       |                |
+-----------+--------------+------+-----+---------+----------------+
8 rows in set (0,01 sec)
```

```sql
mysql> SELECT * FROM aliment;
+----+------------------+-------------+-------+----------+----------+-----------+------+
| id | nom              | marque      | sucre | calories | graisses | proteines | bio  |
+----+------------------+-------------+-------+----------+----------+-----------+------+
|  1 | pomme            | sans marque |  19.1 |       72 |      0.2 |       0.4 |    0 |
|  2 | poire            | sans marque |  27.5 |      134 |      0.2 |       1.1 |    1 |
|  3 | banane           | chiquita    |    24 |      101 |      0.3 |       1.1 |    0 |
|  4 | jambon           | herta       |   0.2 |       34 |      0.8 |       6.6 |    0 |
|  5 | compote          | andros      |    11 |       51 |        0 |       0.5 |    0 |
|  6 | steak hach√©      | charal      |   0.8 |       68 |      4.8 |       4.8 |    0 |
|  7 | saumon           | guyader     |     0 |      206 |     12.3 |      22.1 |    0 |
|  8 | haricots verts   | bonduelle   |   5.8 |       25 |      0.1 |       1.5 |    0 |
|  9 | riz              | oncle benz  |  28.2 |      130 |      0.3 |       2.7 |    0 |
| 10 | p√¢tes completes  | barilla     |    64 |      353 |      2.7 |        14 |    1 |
| 11 | blanc de dinde   | p√®re dodu   |   0.6 |       98 |      0.9 |        22 |    0 |
| 12 | filet de poulet  | le gaulois  |     0 |      121 |      1.8 |      26.2 |    0 |
| 13 | muesli           | bjorg       |  26.5 |      170 |        5 |       3.5 |    1 |
| 14 | caf√©             | carte noire |     0 |        0 |        0 |         0 |    0 |
| 15 | jus d‚Äòorange     | innocent    |    16 |       74 |        0 |       1.6 |    0 |
| 16 | jus de pomme     | andros      |    24 |      100 |      0.2 |       0.2 |    1 |
| 17 | pomme de terre   | dor√©ac      |  21.1 |      104 |      0.2 |       2.8 |    0 |
| 18 | oeuf             | naturalia   |   0.4 |       74 |      5.1 |       6.5 |    1 |
| 19 | baguette         | sans marque |  36.1 |      185 |      1.2 |       7.5 |    0 |
| 20 | lait d‚Äòamande    | bjorg       |   6.1 |       80 |      5.3 |       1.5 |    1 |
+----+------------------+-------------+-------+----------+----------+-----------+------+
20 rows in set (0,00 sec)
```

```sql
mysql> SHOW COLUMNS FROM langue;
+--------+--------------+------+-----+---------+----------------+
| Field  | Type         | Null | Key | Default | Extra          |
+--------+--------------+------+-----+---------+----------------+
| id     | int          | NO   | PRI | NULL    | auto_increment |
| nom    | varchar(100) | NO   |     | NULL    |                |
+--------+--------------+------+-----+---------+----------------+
2 rows in set (0.01 sec)
```

```sql
mysql> SELECT * FROM langue;

+----+----------+
| id | nom      |
+----+----------+
|  1 | fran√ßais |
|  2 | anglais  |
+----+----------+
2 rows in set (0.01 sec)
```

```sql
mysql> SHOW COLUMNS FROM utilisateur;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| id        | int          | NO   | PRI | NULL    | auto_increment |
| nom       | varchar(100) | YES  |     | NULL    |                |
| prenom    | varchar(100) | YES  |     | NULL    |                |
| email     | varchar(255) | NO   | UNI | NULL    |                |
| langue_id | int          | NO   | MUL | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
4 rows in set (0.01 sec)
```

```sql
mysql> SELECT * FROM utilisateur;
+----+-------------+------------+----------------------+-----------+
| id | nom         | prenom     | email                | langue_id |
+----+-------------+------------+----------------------+-----------+
|  1 | durantay    | quentin    | qentin@gmail.com     |         1 |
|  2 | dupont      | marie      | marie@hotmail.fr     |         1 |
|  3 | miller      | vincent    | vm@yahoo.com         |         2 |
|  4 | zuckerberg  | marc       | marc@gmail.com       |         2 |
|  5 | paul        | pierre     | pp@orange.fr         |         1 |
|  6 | de vauclerc | lisa       | lisadv@gmail.com     |         1 |
|  7 | gluntig     | √©l√©onore   | glunt@sfr.com        |         1 |
|  8 | cavill      | henry      | henry@outlook.fr     |         2 |
|  9 | hopper      | lionel     | hpp@gmail.com        |         2 |
| 10 | tember      | fabienne   | fabienne@yopmail.com |         1 |
+----+-------------+------------+----------------------+-----------+
10 rows in set (0,00 sec)
```

```sql
mysql> SHOW COLUMNS FROM utilisateur_aliment;
+----------------+------+------+-----+---------+-------+
| Field          | Type | Null | Key | Default | Extra |
+----------------+------+------+-----+---------+-------+
| utilisateur_id | int  | NO   | MUL | NULL    |       |
| aliment_id     | int  | NO   | MUL | NULL    |       |
+----------------+------+------+-----+---------+-------+
2 rows in set (0,00 sec)
```

```sql
mysql> SELECT * FROM utilisateur_aliment;
+----------------+------------+
| utilisateur_id | aliment_id |
+----------------+------------+
|              1 |          7 |
|              1 |          3 |
|              1 |          5 |
|              2 |          2 |
|              2 |         19 |
|              2 |         14 |
|              3 |          4 |
|              3 |         15 |
|              3 |         12 |
|              1 |         17 |
|              4 |          5 |
|              4 |          4 |
|              4 |          7 |
|              5 |          1 |
|              5 |         18 |
|              5 |          3 |
|              6 |          2 |
|              6 |         12 |
|              6 |          6 |
|              7 |         16 |
|              7 |         19 |
|              7 |          1 |
|              8 |          3 |
|              8 |          5 |
|              9 |         18 |
|              9 |          9 |
|              9 |         14 |
|             10 |         16 |
|             10 |          3 |
+----------------+------------+
29 rows in set (0,00 sec)
```

------

## Quiz : Effectuez des requ√™tes SQL avanc√©es

[Effectuez des requ√™tes SQL avanc√©es - OpenClassrooms](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/exercises/4009)

#### Comp√©tences √©valu√©es

<i class="bi bi-check2-circle"></i> Effectuer des requ√™tes SQL avanc√©es

-----

#### Description

Reprenons notre BDD Moviz du pr√©c√©dent quiz. J‚Äôai un peu adapt√© cette base. Vous pouvez la t√©l√©charger ici : [https://github.com/OpenClassrooms-Student-Center/Course-implementez-BDD-SQL/blob/master/partie\_3/moviz.sql](https://github.com/OpenClassrooms-Student-Center/Course-implementez-BDD-SQL/blob/master/partie_3/moviz.sql)

En plus de la table ‚Äúfilm‚Äù qui a √©volu√© pour inclure la note_id, j‚Äôai rajout√© les tables ‚Äúnote‚Äù et ‚Äúpays_de_sortie‚Äù ainsi que la table de
liaison ‚Äúfilm_pays_de_sortie‚Äù.

Il existe donc une relation un √† plusieurs entre ‚Äúfilm‚Äù et ‚Äúnote‚Äù, et une relation plusieurs √† plusieurs entre ‚Äúfilm‚Äù et ‚Äúpays_de_sortie‚Äù.

Voici le sch√©ma mis √† jour de la table ‚Äúfilm‚Äù :

| **Nom du champ** | **Type du champ** | **Description du champ** |
|------------------|-------------------|--------------------------|
| _nom_ | VARCHAR(255) | le nom du film |
| _date_de_sortie_ | DATE | la date de sortie du film |
| _synopsis_ | TEXT | la description du sc√©nario du film |
| _langue_ | VARCHAR(255) | la langue principale du film |
| _budget_ | INTEGER | le budget de production du film |
| note_id | INTEGER | l'id de l'objet note associ√© au film |

Le sch√©ma de la table ‚Äúnote‚Äù est disponible ici :

| **Nom du champ** | **Type du champ** | **Description du champ** |
|------------------|-------------------|--------------------------|
| _note_ | INTEGER | la note sur 5 |

Et enfin, voici le sch√©ma de ‚Äúpays_de_sortie‚Äù :

| **Nom du champ** | **Type du champ** | **Description du champ** |
|------------------|-------------------|--------------------------|
| _nom_ | VARCHAR(255) | le nom du pays |

-----

#### Question 1 : Quelle est la commande qui permet de r√©cup√©rer uniquement le film Skyfall ?

<i class="bi bi-record-circle"></i> <code>SELECT * FROM film WHERE nom LIKE "Skyfall";</code><br />
<i class="bi bi-circle"></i> <code>SELECT * FROM film WHERE id = 1;</code><br />
<i class="bi bi-circle"></i> <code>SELECT * FROM film ORDER BY nom = "Skyfall";</code><br />
<br />

_Ici, on souhaite r√©cup√©rer le film dont le nom est ‚ÄúSkyfall‚Äù. Filtrer se fait avec le mot cl√© WHERE auquel on ajoute la r√®gle de comparaison.
Ici, on cherche √† matcher exactement le mot ‚ÄúSkyfall‚Äù sur la colonne ‚Äúnom‚Äù, d‚Äôo√π l‚Äôutilisation de l‚Äôop√©rateur d‚Äô√©galit√©._

> `SELECT * FROM film WHERE nom = "Skyfall";`

```sql
mysql> SELECT * FROM film WHERE nom = "Skyfall";
+----+----------------+-----------------------------------------------------------------------------------+---------+-----------+---------+---------+
| id | date_de_sortie | synopsis                                                                          | langue  | budget    | nom     | note_id |
+----+----------------+-----------------------------------------------------------------------------------+---------+-----------+---------+---------+
|  2 | 2012-10-26     | Dans cet √©pisode le plus sombre de la saga, James Bond retourne √† ses origines.   | anglais | 200000000 | Skyfall |       5 |
+----+----------------+-----------------------------------------------------------------------------------+---------+-----------+---------+---------+
1 row in set (0,00 sec)
```

-----

#### Question 2 : Quels sont les films dont le budget est sup√©rieur ou √©gal √† 100 000 000 $ ?

<i class="bi bi-record-circle"></i> Titanic et Skyfall<br />
<i class="bi bi-circle"></i> Titanic, Skyfall et La La Land<br />
<i class="bi bi-circle"></i> Titanic uniquement<br />
<br />

_Ici, on souhaite r√©cup√©rer plusieurs films selon un op√©rateur de comparaison sur la colonne ‚Äúbudget‚Äù. Il s‚Äôagit de l‚Äôop√©rateur sup√©rieur ou
√©gal (>=) qui se place lui aussi apr√®s un WHERE. La commande est donc :_<br />
`SELECT * FROM film WHERE budget >= 100000000;`

```sql
mysql> SELECT * FROM film WHERE budget >= 100000000;
+----+----------------+-----------------------------------------------------------------------------------+---------+-----------+---------+---------+
| id | date_de_sortie | synopsis                                                                          | langue  | budget    | nom     | note_id |
+----+----------------+-----------------------------------------------------------------------------------+---------+-----------+---------+---------+
|  1 | 1998-04-04     | L‚Äòhistoire du plus grand paquebot de son √©poque, et de sa funeste fin.            | anglais | 200000000 | Titanic |       4 |
|  2 | 2012-10-26     | Dans cet √©pisode le plus sombre de la saga, James Bond retourne √† ses origines.   | anglais | 200000000 | Skyfall |       5 |
+----+----------------+-----------------------------------------------------------------------------------+---------+-----------+---------+---------+
2 rows in set (0,00 sec)
```

-----

#### Question 3 : Quels sont les films dont le synopsis contient le mot ‚Äúhistoire‚Äù ?

<i class="bi bi-circle"></i> Skyfall uniquement<br />
<i class="bi bi-circle"></i> Skyfall et La La Land<br />
<i class="bi bi-record-circle"></i> Titanic et La La Land<br />
<br />

_Ici, ou souhaite r√©cup√©rer plusieurs films dont la colonne ‚Äúsynopsis‚Äù contient le mot "histoire". Pour ce faire, on utilise toujours un
filtre apr√®s WHERE. Il s‚Äôagit du filtre LIKE, auquel on ajoute le texte √† comparer, et on indique √† MySQL que ce texte se situe au milieu
d‚Äôune phrase gr√¢ce aux pourcentages avant et apr√®s le mot, soit ‚Äú%histoire%‚Äù. La commande √† taper est donc :_<br />
`SELECT * FROM film WHERE synopsis LIKE "%histoire%";`

```sql
mysql> SELECT * FROM film WHERE synopsis LIKE "%histoire%";
+----+----------------+-------------------------------------------------------------------------+---------+-----------+------------+---------+
| id | date_de_sortie | synopsis                                                                | langue  | budget    | nom        | note_id |
+----+----------------+-------------------------------------------------------------------------+---------+-----------+------------+---------+
|  1 | 1998-04-04     | L‚Äòhistoire du plus grand paquebot de son √©poque, et de sa funeste fin.  | anglais | 200000000 | Titanic    |       4 |
|  3 | 2017-01-25     | Une histoire d‚Äòamour √† Los Angeles sous forme de com√©die musicale.      | anglais |  30000000 | La La Land |       3 |
+----+----------------+-------------------------------------------------------------------------+---------+-----------+------------+---------+
2 rows in set (0,00 sec)
```

-----

#### Question 4 : Combien y-a-t-il de films ?

<i class="bi bi-circle"></i> 1<br />
<i class="bi bi-circle"></i> 2<br />
<i class="bi bi-record-circle"></i> 3<br />
<br />

_Ici, on souhaite compter le nombre de films. Cela est possible gr√¢ce au mot cl√© COUNT qui, adoss√© √† une commande SELECT, permet de retourner
le nombre d‚Äôobjets match√©s. La commande √† taper est :_<br />
`SELECT COUNT(*) FROM film;`

```sql
mysql> SELECT COUNT(*) FROM film;
+----------+
| COUNT(*) |
+----------+
|        3 |
+----------+
1 row in set (0,01 sec)
```

-----

#### Question 5 : Quels sont les mots cl√©s permettant d‚Äôeffectuer des op√©rations arithm√©tiques sur des requ√™tes SQL ?

<i class="bi bi-record-circle"></i> SUM, AVG, MAX, MIN<br />
<i class="bi bi-circle"></i> SOMME, MOYENNE, MAXIMUM, MINIMUM<br />
<i class="bi bi-circle"></i> SUM, AVE, MAXI, MINI<br />
<br />

_Les mots cl√©s disponibles sont SUM pour faire une somme, AVG pour faire une moyenne, MAX pour retrouver un maximum, et MIN pour retrouver un
minimum._

-----

#### Question 6 : Combien de films ont une note inf√©rieure √† 4 ?

<i class="bi bi-record-circle"></i> 1<br />
<i class="bi bi-circle"></i> 2<br />
<i class="bi bi-circle"></i> 3<br />
<br />

_Ici, il faut relier les tables ‚Äúfilm‚Äù et ‚Äúnote‚Äù gr√¢ce au mot cl√© JOIN, en pr√©cisant √† MySQL (gr√¢ce au mot cl√© ON) quelles sont les colonnes
qui permettent de relier les deux tables (ici, l‚Äôid de chaque note, et la ‚Äúnote_id‚Äù de chaque film). La commande est donc :_

```sql
mysql> SELECT * FROM film JOIN note
    -> ON (film.note_id = note.id)
    -> WHERE note.note < 4;
```

-----

#### Question 7 : Qu‚Äôest-ce qu‚Äôune table de liaison ?

<i class="bi bi-circle"></i> C‚Äôest une table qui permet de lier deux tables ayant une relation un √† plusieurs entre elles.<br />
<i class="bi bi-record-circle"></i> C‚Äôest une table qui permet de relier deux tables ayant une relation plusieurs √† plusieurs entre elles.<br />
<i class="bi bi-circle"></i> C‚Äôest une table qui regroupe toutes les vues pr√©sentes dans une BDD.<br />
<br />

_La table de liaison est une table qui permet de lier deux tables entre elles, en stockant des objets avec l‚Äôid de chaque table, afin d‚Äôen
mat√©rialiser les relations plusieurs √† plusieurs sous forme de relations un √† plusieurs._

-----

#### Question 8 : S√©lectionnez les bonnes associations de films avec leurs pays de sortie.

<i class="bi bi-circle"></i> Skyfall en France, Angleterre et USA.<br />
<i class="bi bi-record-circle"></i> Titanic en France, USA et Allemagne.<br />
<i class="bi bi-circle"></i> La La Land aux USA uniquement.<br />
<br />

_Ici, nous sommes face √† une relation plusieurs √† plusieurs. Il faut donc passer par la table de liaison ‚Äúfilm_pays_de_sortie‚Äù, qu‚Äôon JOIN √†
la fois √† ‚Äúfilm‚Äù et √† ‚Äúpays_de_sortie‚Äù. La commande qui permet de v√©rifier la solution est donc :_

```sql
mysql> SELECT * FROM film
    -> JOIN film_pays_de_sortie
    -> ON (film.id = film_pays_de_sortie.film_id)
    -> JOIN pays_de_sortie
    -> ON (pays_de_sortie.id = film_pays_de_sortie.pays_de_sortie_id);
+----+----------------+-----------------------------------------------------------------------------------+---------+-----------+------------+---------+---------+-------------------+----+------------+
| id | date_de_sortie | synopsis                                                                          | langue  | budget    | nom        | note_id | film_id | pays_de_sortie_id | id | nom        |
+----+----------------+-----------------------------------------------------------------------------------+---------+-----------+------------+---------+---------+-------------------+----+------------+
|  1 | 1998-04-04     | L‚Äòhistoire du plus grand paquebot de son √©poque, et de sa funeste fin.            | anglais | 200000000 | Titanic    |       4 |       1 |                 1 |  1 | france     |
|  1 | 1998-04-04     | L‚Äòhistoire du plus grand paquebot de son √©poque, et de sa funeste fin.            | anglais | 200000000 | Titanic    |       4 |       1 |                 2 |  2 | usa        |
|  1 | 1998-04-04     | L‚Äòhistoire du plus grand paquebot de son √©poque, et de sa funeste fin.            | anglais | 200000000 | Titanic    |       4 |       1 |                 4 |  4 | allemagne  |
|  2 | 2012-10-26     | Dans cet √©pisode le plus sombre de la saga, James Bond retourne √† ses origines.   | anglais | 200000000 | Skyfall    |       5 |       2 |                 1 |  1 | france     |
|  2 | 2012-10-26     | Dans cet √©pisode le plus sombre de la saga, James Bond retourne √† ses origines.   | anglais | 200000000 | Skyfall    |       5 |       2 |                 3 |  3 | angleterre |
|  3 | 2017-01-25     | Une histoire d‚Äòamour √† Los Angeles sous forme de com√©die musicale.                | anglais |  30000000 | La La Land |       3 |       3 |                 1 |  1 | france     |
|  3 | 2017-01-25     | Une histoire d‚Äòamour √† Los Angeles sous forme de com√©die musicale.                | anglais |  30000000 | La La Land |       3 |       3 |                 3 |  3 | angleterre |
|  3 | 2017-01-25     | Une histoire d‚Äòamour √† Los Angeles sous forme de com√©die musicale.                | anglais |  30000000 | La La Land |       3 |       3 |                 5 |  5 | italie     |
|  3 | 2017-01-25     | Une histoire d‚Äòamour √† Los Angeles sous forme de com√©die musicale.                | anglais |  30000000 | La La Land |       3 |       3 |                 6 |  6 | espagne    |
+----+----------------+-----------------------------------------------------------------------------------+---------+-----------+------------+---------+---------+-------------------+----+------------+
9 rows in set (0,00 sec)
```

-----

```sql title="Tables"
mysql> SHOW TABLES
+---------------------+
| Tables_in_moviz     |
+---------------------+
| film                |
| film_pays_de_sortie |
| note                |
| pays_de_sortie      |
+---------------------+
4 rows in set (0,00 sec)
```

```sql title="Table 'film'"
mysql> SELECT * FROM film
+----+----------------+-----------------------------------------------------------------------------------+---------+-----------+------------+---------+
| id | date_de_sortie | synopsis                                                                          | langue  | budget    | nom        | note_id |
+----+----------------+-----------------------------------------------------------------------------------+---------+-----------+------------+---------+
|  1 | 1998-04-04     | L‚Äòhistoire du plus grand paquebot de son √©poque, et de sa funeste fin.            | anglais | 200000000 | Titanic    |       4 |
|  2 | 2012-10-26     | Dans cet √©pisode le plus sombre de la saga, James Bond retourne √† ses origines.   | anglais | 200000000 | Skyfall    |       5 |
|  3 | 2017-01-25     | Une histoire d‚Äòamour √† Los Angeles sous forme de com√©die musicale.                | anglais |  30000000 | La La Land |       3 |
+----+----------------+-----------------------------------------------------------------------------------+---------+-----------+------------+---------+
3 rows in set (0,00 sec)
```

```sql title="Table de liaison 'film_pays_de_sortie'"
mysql> SELECT * FROM film_pays_de_sortie;
+---------+-------------------+
| film_id | pays_de_sortie_id |
+---------+-------------------+
|       1 |                 1 |
|       2 |                 1 |
|       3 |                 1 |
|       1 |                 2 |
|       2 |                 3 |
|       3 |                 3 |
|       1 |                 4 |
|       3 |                 5 |
|       3 |                 6 |
+---------+-------------------+
9 rows in set (0,00 sec)
```

```sql title="Table 'note'"
mysql> SELECT * FROM note;
+----+------+
| id | note |
+----+------+
|  1 |    1 |
|  2 |    2 |
|  3 |    3 |
|  4 |    4 |
|  5 |    5 |
+----+------+
5 rows in set (0,00 sec)
```

```sql title="Table 'pays_de_sortie'"
mysql> SELECT * FROM pays_de_sortie;
+----+------------+
| id | nom        |
+----+------------+
|  1 | france     |
|  2 | usa        |
|  3 | angleterre |
|  4 | allemagne  |
|  5 | italie     |
|  6 | espagne    |
+----+------------+
6 rows in set (0,00 sec)
```

