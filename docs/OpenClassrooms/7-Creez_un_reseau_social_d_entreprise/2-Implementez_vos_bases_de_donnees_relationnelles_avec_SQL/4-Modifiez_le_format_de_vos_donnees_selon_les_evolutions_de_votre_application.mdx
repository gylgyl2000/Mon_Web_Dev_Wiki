---
sidebar_position: 5
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import { Vimeo } from 'mdx-embed';

# Modifiez le format de vos donn√©es selon les √©volutions de votre application

## Modifiez la structure d‚Äôun objet avec ALTER TABLE

[Modifiez la structure d‚Äôun objet avec ALTER TABLE - Impl√©mentez vos bases de donn√©es relationnelles avec SQL - OpenClassrooms](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142288-modifiez-la-structure-d-un-objet-avec-alter-table)

<Vimeo vimeoId="497953098" />

<br />

Ins√©rer de la donn√©e, la modifier, la supprimer, ou bien en tirer des informations utiles est d√©sormais √† votre port√©e. Bien jou√© !

Mais il reste une chose √† voir, une chose importante dont vous aurez toujours besoin si vous souhaitez adapter votre BDD aux √©volutions de
votre application.

Vous voyez laquelle c‚Äôest ? ü§î

Il s‚Äôagit de la **modification de la structure** de la BDD en elle-m√™me. Commen√ßons simplement par l‚Äôajout et la suppression de champs.

### Ajoutez un champ

#### Ajoutez un champ aux aliments

Le dernier rapport sur l‚Äôutilisation de Foodly vient de tomber. Dans celui-ci, les utilisateurs ont pu voter pour les am√©liorations qu‚Äôils
souhaiteraient voir appara√Ætre dans l‚Äôapplication.

La plus demand√©e √©tait celle de voir la contenance en vitamines de chaque aliment.

Sachant cela, l‚Äô√©quipe de Foodly organise une r√©union concernant l‚Äôimpl√©mentation d‚Äôune telle fonctionnalit√©. Le design est pr√™t, les
d√©veloppeurs ont cod√© l‚Äôinterface, mais il manque une chose cruciale pour r√©cup√©rer la contenance en vitamines dans l‚Äôapplication : l‚Äôajout de
cette donn√©e dans la BDD.

Prenons l‚Äôexemple de la vitamine C.

Cette colonne n‚Äôappara√Æt nulle part dans le sch√©ma de la table aliment. Il nous faut la cr√©er.

De la m√™me mani√®re que vous l‚Äôavez fait lors de la premi√®re partie, il faudra sp√©cifier son type √† MySQL. Pour ce faire, utilisez la commande
**`ALTER TABLE`**.

Voyons √† quoi ressemble la commande SQL pour rajouter cette colonne, puis d√©cortiquons-la ensemble :

```sql
ALTER TABLE aliment ADD vitamines_c FLOAT;
```

Ici, on signale √† MySQL :
- de modifier la structure d‚Äôune table avec **`ALTER TABLE`** ;
- quelle table modifier (ici ‚Äúaliment‚Äù) ;
- que la modification va faire ajouter une colonne avec **`ADD`**;
- le nom de cette nouvelle colonne (ici ‚Äúvitamines_c‚Äù) ;
- enfin, le type de la colonne (ici, **`FLOAT`**, car les vitamines sont stock√©es usuellement en mg/100g, valeur d√©cimale).

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109647551199_P4_ALTER-TABLE.png"
         alt="R√©capitulatif visuel du paragraphe r√©dig√© ci-dessus" />
    <figcaption>La commande ALTER TABLE</figcaption>
</figure>

:::info
√Ä noter que le type n‚Äôest parfois pas seul. On peut aussi (comme dans la partie 1), mentionner √† MySQL qu‚Äôon rajoute une colonne qui est :
- une cl√© primaire (**PRIMARY KEY**) ;
- avec une valeur par d√©faut (**DEFAULT valeur_par_d√©faut**) ;
- non nulle (**NOT NULL**). Auquel cas il faudra pr√©ciser une valeur par d√©faut, MySQL cr√©ant la colonne avec la valeur ‚ÄúNULL‚Äù pour tous les
objets existants dans cette table ;
- etc.
:::

### √Ä vous de jouer !

Faisons un petit exercice :

> Admettons que l‚Äôon souhaite rajouter une colonne √† la table ‚Äúlangue‚Äù. Cette colonne, c‚Äôest [le code ISO des langues](http://www.lingoes.net/en/translator/langcode.htm)
(par exemple : ‚Äúfr-fr‚Äù pour le Fran√ßais de m√©tropole).

Comment feriez-vous cela ?

```sql
ALTER TABLE langue ADD code VARCHAR(100);
```

```sql
mysql> SELECT * FROM langue;
+----+----------+------+
| id | nom      | code |
+----+----------+------+
|  1 | fran√ßais | NULL |
|  2 | anglais  | NULL |
+----+----------+------+
2 rows in set (0.00 sec)
```

```sql
mysql> UPDATE langue SET code = 'fr-fr' WHERE id = 1;

mysql> UPDATE langue SET code = 'en-uk' WHERE id = 2;

mysql> SELECT * FROM langue;
+----+----------+-------+
| id | nom      | code  |
+----+----------+-------+
|  1 | fran√ßais | fr-fr |
|  2 | anglais  | en-uk |
+----+----------+-------+
2 rows in set (0.00 sec)
```

Tentez de cr√©er la colonne et de la remplir par vous-m√™me pour le Fran√ßais et l‚ÄôAnglais. Voici la correction :

<Vimeo vimeoId="497578353" />

<br />

:::info
Vous savez d√©sormais ajouter un champ √† une table. üôå
:::

### Supprimez un champ

#### Supprimez un champ aux aliments

Le management de chez Foodly nous mentionne d‚Äôautres changements √† effectuer sur l‚Äôapplication, qui impliquent la BDD. C‚Äôest une nouvelle
surprenante !

Les utilisateurs de Foodly n‚Äôutilisent que tr√®s rarement la fonctionnalit√© pour savoir si un aliment est bio ou non. üò¢

Les d√©veloppeurs, dans leur volont√© de toujours diminuer la dette technique (√† savoir, le code √† maintenir), souhaitent retirer l‚Äôaffichage bio
de la fiche des aliments sur Foodly.

En tant que gestionnaire de la BDD, vous pensez qu‚Äôil serait pratique de faire de m√™me de votre c√¥t√©, pour √©viter de maintenir un champ qui ne
sera plus mis √† jour.

Pour ce faire, rien de plus simple : supprimons la colonne ‚Äúbio‚Äù de la table ‚Äúaliment‚Äù avec `DROP`.

Voici la commande SQL pour le faire :

```sql
ALTER TABLE aliment DROP bio;
```

D√©composons cette commande ensemble :
- On modifie toujours la structure d‚Äôune table avec **`ALTER TABLE`**.
- On lui signale √† nouveau quelle table modifier (ici, ‚Äúaliment‚Äù).
- On lui indique que la modification va supprimer une colonne avec **`DROP`**.
- On mentionne le nom de la colonne √† supprimer (ici, ‚Äúbio‚Äù).

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109647839763_P4_DROP.png"
         alt="R√©capitulatif visuel du paragraphe r√©dig√© ci-dessus" />
    <figcaption>Utilisation de DROP</figcaption>
</figure>

Vous voyez, c‚Äôest vraiment tr√®s simple. üòâ

:::caution
Il faut n√©anmoins faire attention lorsqu‚Äôon utilise cette commande. Une fois la colonne supprim√©e, celle-ci est **d√©finitivement d√©truite** et
ne peut plus √™tre r√©cup√©r√©e. Vous perdez l‚Äôinformation pour tous les objets pr√©sents en base. **√Ä utiliser avec parcimonie !**
:::

### √Ä vous de jouer !

Maintenant, admettons que le service l√©gal de Foodly vous dise que stocker des noms de famille va √† l‚Äôencontre des conditions de protection des
donn√©es des utilisateurs.

Comment feriez-vous pour supprimer les noms de famille ?

```sql
mysql> SELECT * FROM utilisateur;
+----+-------------+------------+----------------------+-----------+
| id | nom         | prenom     | email                | langue_id |
+----+-------------+------------+----------------------+-----------+
|  1 | durantay    | quentin    | qentin@gmail.com     |         1 |
|  2 | dupont      | marie      | marie@hotmail.fr     |         1 |
|  3 | miller      | vincent    | vm@yahoo.com         |         2 |
|  4 | zuckerberg  | marc       | marc@gmail.com       |         2 |
|  5 | paul        | pierre     | pp@orange.fr         |         1 |
|  6 | de vauclerc | lisa       | lisadv@gmail.com     |         1 |
|  7 | gluntig     | √©l√©onore   | glunt@sfr.com        |         1 |
|  8 | cavill      | henry      | henry@outlook.fr     |         2 |
|  9 | hopper      | lionel     | hpp@gmail.com        |         2 |
| 10 | tember      | fabienne   | fabienne@yopmail.com |         1 |
+----+-------------+------------+----------------------+-----------+
10 rows in set (0,00 sec)
```

```sql
mysql> ALTER TABLE utilisateur DROP nom;
```

```sql
mysql> SELECT * FROM utilisateur;
+----+------------+----------------------+-----------+
| id | prenom     | email                | langue_id |
+----+------------+----------------------+-----------+
|  1 | quentin    | qentin@gmail.com     |         1 |
|  2 | marie      | marie@hotmail.fr     |         1 |
|  3 | vincent    | vm@yahoo.com         |         2 |
|  4 | marc       | marc@gmail.com       |         2 |
|  5 | pierre     | pp@orange.fr         |         1 |
|  6 | lisa       | lisadv@gmail.com     |         1 |
|  7 | √©l√©onore   | glunt@sfr.com        |         1 |
|  8 | henry      | henry@outlook.fr     |         2 |
|  9 | lionel     | hpp@gmail.com        |         2 |
| 10 | fabienne   | fabienne@yopmail.com |         1 |
+----+------------+----------------------+-----------+
10 rows in set (0,00 sec)
```

Essayez de la faire. Si vous √™tes coinc√©, l√† correction est juste ici üëá

<Vimeo vimeoId="497578371" />

<br />

:::info
Ajouter, supprimer, vous voil√† ma√Ætre en mati√®re de modification de sch√©ma de table ! Enfin‚Ä¶ pas trop vite ! Que se passerait-il si vous deviez
modifier une colonne existante ?
:::

C‚Äôest ce que vous allez voir par la suite.

### Modifiez un champ existant

#### Modifiez un champ des aliments

Le management de Foodly revient encore une fois vers vous !

Apr√®s avoir regard√© des utilisateurs se servir de Foodly, ils se sont rendu compte que les utilisateurs souhaiteraient pouvoir filtrer les
aliments selon leurs apports calorifiques avec plus de pr√©cision.

Pour ce faire, les d√©veloppeurs vous indiquent qu‚Äôils vont devoir comparer les calories de deux aliments entre eux, et ce, √† la virgule pr√®s.

Or, les calories sont actuellement stock√©es sous forme d‚Äôentiers (sans d√©cimales, du coup). Comment les modifier ?

Voici la commande pour effectuer cette op√©ration :

```sql
ALTER TABLE aliment MODIFY calories FLOAT;
```

:::info
Analysons cette commande :
- On modifie toujours la structure d‚Äôune table avec **`ALTER TABLE`**.
- On lui signale √† nouveau quelle table modifier (ici, ‚Äúaliment‚Äù).
- On lui indique que la modification va modifier le type d‚Äôune colonne avec **`MODIFY`**.
- On mentionne le nom de la colonne √† modifier (ici, ‚Äúcalories‚Äù).
- On indique le nouveau type de la colonne (ici, **`FLOAT`**).
:::

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109648446119_P4_MODIFY-FLOAT.png"
         alt="R√©capitulatif visuel du paragraphe r√©dig√© ci-dessus" />
    <figcaption>L'utilisation de FLOAT</figcaption>
</figure>

### √Ä vous de jouer !

Les d√©veloppeurs viennent vous voir affol√©s ! Certains utilisateurs ne peuvent pas s‚Äôinscrire car leur email d√©passe les 255 caract√®res.

Pourriez-vous augmenter la limite √† 500 ?

```sql
mysql> SHOW COLUMNS FROM utilisateur;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| id        | int          | NO   | PRI | NULL    | auto_increment |
| nom       | varchar(100) | YES  |     | NULL    |                |
| prenom    | varchar(100) | YES  |     | NULL    |                |
| email     | varchar(255) | NO   | UNI | NULL    |                |
| langue_id | int          | NO   | MUL | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
4 rows in set (0.01 sec)
```

```sql
mysql> ALTER TABLE utilisateur MODIFY email VARCHAR(500) NOT NULL;

mysql> SHOW COLUMNS FROM utilisateur;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| id        | int          | NO   | PRI | NULL    | auto_increment |
| nom       | varchar(100) | YES  |     | NULL    |                |
| prenom    | varchar(100) | YES  |     | NULL    |                |
| email     | varchar(500) | NO   | UNI | NULL    |                |
| langue_id | int          | NO   | MUL | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
4 rows in set (0.01 sec)
```

Tentez par vous-m√™me. Une fois fait, voici la correction :

<Vimeo vimeoId="497578391" />

<br />

:::info
Plut√¥t pratique de savoir modifier le type d‚Äôune colonne, non ? Mais que se passerait-il si vous souhaitiez changer le nom de cette derni√®re ?

D√©couvrons-le !
:::

### Renommez un champ des aliments

Ce coup-ci, c‚Äôest la designer de Foodly qui revient vers vous : les utilisateurs sont perturb√©s‚Ä¶ üò® Pour chaque aliment, la valeur en prot√©ines,
vitamines, mati√®res grasses est mentionn√©e au pluriel. Alors que les sucres, eux, sont mentionn√©s au singulier. Ce qui perturbe la compr√©hension
des aliments par les utilisateurs.

Comment renommer cette colonne dans la BDD ?

Voici la commande √† effectuer :

```sql
ALTER TABLE aliment CHANGE sucre sucres FLOAT;
```

:::info
Voici les explications de cette commande :
- On modifie toujours la structure d‚Äôune table avec **`ALTER TABLE`**.
- On lui signale √† nouveau quelle table modifier (ici, ‚Äúaliment‚Äù).
- On lui indique que la modification va modifier le nom d‚Äôune colonne avec **`CHANGE`**.
- On mentionne le nom de la colonne √† renommer, **ainsi que** son nouveau nom (ici, ‚Äúsucre‚Äù devient ‚Äúsucres‚Äù).
- On indique le nouveau type de la colonne (ici, **`FLOAT`**).
:::

C‚Äôest une sp√©cificit√© propre √† MySQL : pour renommer une colonne, il faut aussi indiquer son type. Ce qui n‚Äôest pas n√©cessaire si vous utilisez
un autre SGBD. Cela permet de modifier √† la fois le nom et le type d‚Äôune colonne dans une seule commande. Et ce, m√™me si vous ne souhaitez pas
le modifier (r√©utilisez alors le m√™me type üòâ).

### √Ä vous de jouer !

A pr√©sent, les d√©veloppeurs trouvent que le nom ‚Äúcode‚Äù dans la table des langues est peu explicite. Ils aimeraient qu‚Äôelle s‚Äôappelle
‚Äúcode_pays‚Äù.

Pouvez-vous impl√©menter ce changement ?

```sql
mysql> SELECT * FROM langue;
+----+----------+-------+
| id | nom      | code  |
+----+----------+-------+
|  1 | fran√ßais | fr-fr |
|  2 | anglais  | en-uk |
+----+----------+-------+
2 rows in set (0.00 sec)
```

```sql
mysql> ALTER TABLE langue CHANGE code code_pays VARCHAR(100);

mysql> SELECT * FROM langue;
+----+----------+-----------+
| id | nom      | code_pays |
+----+----------+-----------+
|  1 | fran√ßais | fr-fr     |
|  2 | anglais  | en-uk     |
+----+----------+-----------+
2 rows in set (0.00 sec)
```

Une fois que vous aurez essay√©, retrouvez ci-dessous la correction üëá

[T√©l√©charger la vid√©o](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142288-modifiez-la-structure-d-un-objet-avec-alter-table#popin-download-video)

### En r√©sum√©

- Vous savez que toute modification de la structure d‚Äôun objet s‚Äôeffectue avec une commande **`ALTER TABLE`**.
- Pour ajouter un champ √† un objet, il vous faut utiliser le mot cl√© **`ADD`**.
- Pour supprimer un champ, le mot cl√© est **`DROP`**.
- Pour modifier un champ, le mot cl√© est **`MODIFY`** pour en modifier la structure, **`CHANGE`** pour le renommer.

_Vous voil√† capable de totalement modifier le sch√©ma d‚Äôune table d‚Äôune BDD MySQL. Vous √™tes presque ma√Ætre en BDD MySQL. üëå_

_Presque ? Il vous reste encore √† apprendre √† modifier des relations dans une table ! Ne vous inqui√©tez pas, vous allez tout comprendre dans le
chapitre suivant._

-----

## Ajoutez une relation un √† plusieurs

[Ajoutez une relation un √† plusieurs - Impl√©mentez vos bases de donn√©es relationnelles avec SQL - OpenClassrooms](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142296-ajoutez-une-relation-un-a-plusieurs)

<Vimeo vimeoId="497953128" />

<br />

Voyons dans ce chapitre comment ajouter une relation un √† plusieurs, en cr√©ant notre table "famille". Puis retrouvez dans le chapitre suivant
comment ajouter une relation plusieurs √† plusieurs avec la cr√©ation de la table "lieu".

### Ajoutez une nouvelle table ‚Äúfamille‚Äù

Nous avons obtenu une nouvelle demande d‚Äôam√©lioration de l‚Äôapplication de la part des utilisateurs !

Ces derniers aimeraient pouvoir trier les aliments selon leur ‚Äúfamille‚Äù. Par exemple, regrouper ensemble les fruits, les l√©gumes, les viandes,
etc.

Les d√©veloppeurs pensent qu‚Äôil serait utile de s√©parer ces familles des aliments. En effet, ils pensent que les familles d‚Äôaliments pourront
√™tre utilis√©es de mani√®re ind√©pendante, pas forc√©ment uniquement sur les fiches des aliments.

Par exemple, pour effectuer un r√©sum√© de la consommation en fruits ou l√©gumes d‚Äôune personne sur un mois, ou la r√©partition au sein de ses
courses.

:::info
Pour cela, il faudrait que les familles d‚Äôaliments soient sur une table distincte de celle des aliments !
:::

Maintenant que vous savez **joindre** plusieurs tables entre elles, il est temps de construire une telle relation entre tables. Qu‚Äôen
dites-vous ?

Avant de pouvoir relier les aliments √† leur famille, il faut d‚Äôabord‚Ä¶ eh bien, cr√©er la table famille !

Pour l‚Äôinstant, un objet de type famille ne devra contenir que le nom de cette famille (‚Äúfruit‚Äù, ‚Äúviande‚Äù, etc.).

Vous avez d√©j√† vu comment cr√©er une table. Je vous fais confiance pour cr√©er celle-ci. üòâ

C‚Äôest fait ? Voici la correction :

```sql
CREATE TABLE famille (
id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
nom VARCHAR(100) NOT NULL
);
```

:::info
Vous ne comprenez pas cette commande ou vous ne vous souvenez plus des types ? Je vous invite √† relire le [troisi√®me chapitre de la premi√®re partie](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142232-creez-votre-base-de-donnees-bdd). üòâ
:::

Maintenant que cette table est cr√©√©e, ins√©rons un objet dans celle-ci. Disons, l‚Äôobjet qui va repr√©senter les l√©gumes.

Vous vous souvenez de la commande ? La voici :

```sql
INSERT INTO famille (`nom`) VALUES ('l√©gumes');
```

:::info
Vous √™tes perdu face √† cette commande ? Relisez le [premier chapitre de la deuxi√®me partie](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142248-inserez-des-donnees-dans-votre-bdd). üòâ
:::

Et voil√†, vous voici en possession d‚Äôune nouvelle table ‚Äúfamille‚Äù qui dispose d‚Äôun objet ‚Äúl√©gumes‚Äù.

Passons √† la suite et adaptons notre BDD pour stocker la relation entre les aliments et leur famille.

### Ajoutez la relation entre famille et aliment

Une des choses √† d√©terminer lors de l‚Äôajout d‚Äôune relation, c‚Äôest de savoir si :
- c‚Äôest une relation **un √† plusieurs** ;
- ou une relation **plusieurs √† plusieurs**.

Ici, un aliment peut avoir une seule famille, mais une famille peut √™tre pr√©sente sur plusieurs aliments. Par exemple, une poire et une pomme
font partie de la famille ‚Äúfruits‚Äù.

:::info
Il s‚Äôagit donc d‚Äôune relation un √† plusieurs.
:::

Dans le cadre d‚Äôune telle relation, **c‚Äôest l‚Äôobjet qui se trouve du c√¥t√© ‚Äúplusieurs‚Äù de la relation qui va √™tre modifi√©**, ici les aliments.
On va devoir y stocker l‚Äôid de l‚Äôobjet ‚Äúun‚Äù associ√©, par exemple ‚Äúfruits‚Äù.

Ici, les aliments vont donc devoir √™tre mis √† jour pour y stocker une r√©f√©rence √† leur famille. Cette r√©f√©rence, par convention, sera l‚Äôid de
la famille.

Voici les √©tapes que l‚Äôon va suivre :
1. Ajout du champ famille_id sur les aliments.
2. Modification de ce champ pour signaler √† MySQL que c‚Äôest une **r√©f√©rence** √† la table famille.
3. Modification d‚Äôun objet pour y stocker une relation.

Concernant l‚Äôajout du champ famille_id aux aliments, vous devriez vous en sortir seul. üòâ

C‚Äôest une cl√© primaire (un id), vous commencez √† bien les conna√Ætre. Et pour ajouter un champ √† un sch√©ma, vous venez juste de le voir dans le
chapitre pr√©c√©dent !

Au cas o√π, voici la commande :

```sql
ALTER TABLE aliment
ADD famille_id INT NOT NULL;
```

Ensuite, √ßa se complique. Il faut qu‚Äôon indique √† MySQL que ce champ est une **r√©f√©rence** √† une autre table, en lui pr√©cisant quel champ de
cette autre table on r√©f√©rence.

Pour modifier le champ famille_id, on utilise la commande :

```sql
ALTER TABLE aliment
ADD FOREIGN KEY (famille_id) REFERENCES famille (id)
ON DELETE CASCADE;
```

:::note ?
Houl√†, √ßa fait peur üò®
:::

Voyons ensemble ce que cette commande signifie :
- La premi√®re partie, vous la connaissez. üòâ On signale √† MySQL qu‚Äôon souhaite modifier la table ‚Äúaliment‚Äù, pour y ajouter une colonne (enfin,
plut√¥t y ajouter une contrainte, dans ce cas pr√©cis).
- On dit √† MySQL que la colonne ‚Äúfamille_id‚Äù est **une cl√© √©trang√®re** (***foreign key*** en anglais), soit une r√©f√©rence √† une colonne d‚Äôune
autre table (ici, avec la partie `FOREIGN KEY (famille_id)`).
- On indique ensuite **ce √† quoi cette cl√© fait r√©f√©rence**. Soit, dans notre cas, la colonne ‚Äúid‚Äù de la table ‚Äúfamille‚Äù (soit la commande
`REFERENCES famille(id)`).
- Enfin, s√ªrement la partie la plus obscure pour vous, on indique √† MySQL **le comportement √† adopter en cas de suppression** de l‚Äôobjet
‚Äúunique‚Äù (ici, la ‚Äúfamille‚Äù).

:::note ?
H√©, mais je n‚Äôai rien compris au dernier point !
:::

Laissez-moi vous expliquer. ü§î

Admettons que je vienne de cr√©er ma famille ‚Äúfruits‚Äù, et qu‚Äôelle soit reli√©e √† mes objets ‚Äúpomme‚Äù et ‚Äúpoire‚Äù.

Que se passe-t-il si je supprime la famille ‚Äúfruits‚Äù ?

Eh bien, MySQL a besoin de le savoir. Pour cela, on lui indique via la commande **`ON DELETE`**.

Cette derni√®re peut prendre une option parmi celles-ci :
- **`RESTRICT`** ou **`NO ACTION`** : MySQL va emp√™cher la suppression tant que ‚Äúfruits‚Äù est r√©f√©renc√© sur au moins un objet ‚Äúaliment‚Äù.
- **`SET NULL`** : MySQL va autoriser la suppression de ‚Äúfruits‚Äù, et remplacer ‚Äúfamille_id‚Äù sur ‚Äúpomme‚Äù et ‚Äúpoire‚Äù par la valeur NULL.
- **`CASCADE`** : l‚Äôoption la plus courante, mais la plus dangereuse. üò® Ici, MySQL va supprimer ‚Äúpoire‚Äù et ‚Äúpomme‚Äù en m√™me temps que ‚Äúfruits‚Äù
(il va donc supprimer tous les objets reli√©s).

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/1610964972865_P4_ON-DELETE.png"
         alt="R√©capitulatif visuel du paragraphe r√©dig√© ci-dessus" />
    <figcaption>Actions de la commande ON DELETE</figcaption>
</figure>

Voil√†, MySQL sait que ‚Äúfamille_id‚Äù est une r√©f√©rence √† l‚Äôid de la table famille !

Reste maintenant √† mettre √† jour vos aliments !

Pareil ici, vous avez toutes les comp√©tences en main pour le faire. Sauriez-vous par exemple ajouter la relation de l‚Äôobjet ‚Äúharicots verts‚Äù
vers la famille ‚Äúl√©gumes‚Äù ?

Voici la commande :

```sql
UPDATE `aliment` SET `famille_id` = '1' WHERE `nom` = 'haricots verts';
```

:::info
N‚Äôoubliez pas, ‚Äúl√©gumes‚Äù ayant √©t√© ajout√© en premier √† la table ‚Äúfamille‚Äù, il a l‚Äôid num√©ro 1. Si vous √™tes perdu, [relisez la partie 2](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142248-inserez-des-donnees-dans-votre-bdd) !
:::

Pour v√©rifier que cela a bien fonctionn√©, vous pouvez s√©lectionner les haricots verts avec leur famille gr√¢ce √† un **JOIN**.

```sql
SELECT * FROM aliment
JOIN famille ON aliment.famille_id = famille.id
WHERE aliment.nom = "haricots verts";
```

Gr√¢ce √† cette commande, vous verrez appara√Ætre un tableau r√©capitulatif, o√π la famille de ‚Äúharicots verts‚Äù est bien ‚Äúl√©gumes‚Äù.

:::info
Perdu √† nouveau ? Ne vous inqui√©tez pas, [relisez le chapitre 3 de la partie pr√©c√©dente](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142285-implementez-des-relations-entre-vos-donnees-grace-a-join),
sur la commande `JOIN`.
:::

Il ne vous reste plus qu‚Äô√† ajouter les autres familles vous-m√™me, rajouter sa famille √† chaque aliment, et le tour est jou√© !

Pour ce faire, vous n‚Äôavez qu‚Äô√† r√©effectuer les commandes pr√©c√©dentes en les adaptant. C‚Äôest un super moyen de revoir tout ce que vous avez pu
apprendre lors de ce cours !

### √Ä vous de jouer !

Faisons un petit exercice :

On souhaite rajouter les r√©ductions disponibles sur les aliments. Une r√©duction pouvant √™tre la m√™me pour plusieurs aliments mais chaque
aliment pouvant n‚Äôavoir qu‚Äôune seule r√©duction, il s‚Äôagit d‚Äôune relation un √† plusieurs.

Les r√©ductions sont uniquement constitu√©es d‚Äôun champ ‚Äúvaleur‚Äù, qui va contenir la r√©duction au format texte.

Comment feriez-vous pour cr√©er cette table et la lier aux aliments ?

```sql
mysql> CREATE TABLE reduction (
    -> id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> valeur VARCHAR(100) NOT NULL
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> INSERT INTO reduction (valeur) VALUES ('-30%');
Query OK, 1 row affected (0.00 sec)

mysql> INSERT INTO reduction (valeur) VALUES ('-50%');
Query OK, 1 row affected (0.00 sec)

mysql> SELECT * FROM reduction;
+----+--------+
| id | valeur |
+----+--------+
|  1 | -30%   |
|  2 | -50%   |
+----+--------+
2 rows in set (0.00 sec)

mysql> ALTER TABLE aliment ADD reduction_id INT;
Query OK, 0 rows affected (0.01 sec)
Records: 0 Duplicates: 0 Warnings: 0

mysql> ALTER TABLE aliment ADD FOREIGN KEY (reduction_id) REFERENCES reduction (id) ON DELETE SET NULL;
Query OK, 20 rows affected (0.02 sec)
Records: 20 Duplicates: 0 Warnings: 0

mysql> SELECT * FROM aliment WHERE id=1;
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+
| id | nom   | marque      | sucre | calories | graisses | proteines | bio  | reduction_id |
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+
|  1 | pomme | sans marque |  19.1 |       72 |      0.2 |       0.4 |    0 |         NULL |
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+
1 row in set (0.00 sec)

mysql> UPDATE aliment SET reduction_id = 1 WHERE id = 1;
Query OK, 1 rows affected (0.01 sec)
Rows matched: 1 Changed: 1 Warnings: 0

mysql> SELECT * FROM aliment WHERE id=1;
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+
| id | nom   | marque      | sucre | calories | graisses | proteines | bio  | reduction_id |
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+
|  1 | pomme | sans marque |  19.1 |       72 |      0.2 |       0.4 |    0 |            1 |
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+
1 row in set (0.00 sec)

mysql> SELECT * from aliment
    -> JOIN reduction
    -> ON aliment.reduction_id = reduction.id
    -> WHERE aliment.id = 1;
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+----+--------+
| id | nom   | marque      | sucre | calories | graisses | proteines | bio  | reduction_id | id | valeur |
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+----+--------+
|  1 | pomme | sans marque |  19.1 |       72 |      0.2 |       0.4 |    0 |            1 |  1 | -30%   |
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+----+--------+
1 row in set (0.00 sec)
```

Je vous laisse faire, vous en √™tes capable. üí™ Une fois essay√©, voici la correction :

<Vimeo vimeoId="497578418" />

<br />

### En r√©sum√©

- Vous savez ajouter une relation un √† plusieurs entre deux objets en **ajoutant** √† l‚Äôobjet A **un champ qui contiendra l‚Äôid** (ou cl√© primaire)
de l‚Äôobjet B.

_Voyons au chapitre suivant comment ajouter un relation plusieurs √† plusieurs entre deux objets._

-----

## Ajoutez une relation plusieurs √† plusieurs

[Ajoutez une relation plusieurs √† plusieurs - Impl√©mentez vos bases de donn√©es relationnelles avec SQL - OpenClassrooms](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7153111-ajoutez-une-relation-plusieurs-a-plusieurs)

![](https://user.oc-static.com/upload/2021/01/26/16116831263516_BANNERS_%20P4C3.png)

Vous avez cr√©√© votre nouvelle table "famille" ? Souvenez-vous on aimerait ensuite ajouter le type de magasin o√π sont pr√©sents les aliments. Un
m√™me aliment pouvant √™tre pr√©sent dans plusieurs lieux, nous allons cr√©er une relation plusieurs √† plusieurs. Voyons comment faire !

### Ajoutez une nouvelle table ‚Äúlieu‚Äù

La derni√®re demande de mise √† jour des utilisateurs est arriv√©e !

Ces derniers r√©clament une chose en th√©orie simple : pouvoir visualiser dans l‚Äôapplication de Foodly dans quel magasin sont disponibles leurs
aliments pr√©f√©r√©s. Par exemple, savoir si leur jambon de pr√©dilection est disponible aussi bien √† Carrefour que chez Leclerc.

Les d√©veloppeurs se sont de nouveau regroup√©s : il va falloir stocker les **lieux de vente** dans la BDD.

Un lieu pouvant vendre plusieurs aliments, et ces m√™mes aliments pouvant √™tre vendus dans plusieurs lieux, vous allez devoir cr√©er une
**relation plusieurs √† plusieurs**.

Mais avant toute chose, il vous faut cr√©er la nouvelle table des lieux de vente (que nous allons sobrement appeler ‚Äúlieu‚Äù).

Un lieu de vente, c‚Äôest :
- un nom (exemple : Carrefour City) ;
- un type (exemple : supermarch√©).

Je vous laisse cr√©er la table vous-m√™me ? Apr√®s tout, vous avez toutes les cartes en main pour le faire !

Allez-y, je vous attends. üòâ

Bon, allez, au cas o√π, voici la correction :

```sql
CREATE TABLE lieu (
id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
nom VARCHAR(100) NOT NULL,
type VARCHAR(100) NOT NULL
);
```

:::info
Vous √™tes perdu face √† cette commande ? Revoyez la [partie 1 du cours](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7139618-installez-votre-systeme-de-gestion-de-base-de-donnees-sgbd) !
:::

OK, une fois la table cr√©√©e, ins√©rons un lieu dans cette derni√®re, partons sur un simple Carrefour City (oui, √ßa se sent que je suis citadin ? üòÜ).

Pareil ici, vous devriez pouvoir √©crire cette commande vous-m√™me, j‚Äôen suis s√ªr. üôå

Au cas o√π, voici la correction :

```sql
INSERT INTO `lieu` (`nom`, `type`) VALUES ('Carrefour City', 'supermarch√©');
```

:::info
Vous n‚Äô√™tes pas s√ªr de ce que cette commande signifie ? Relisez la partie 2 du cours !
:::

√áa y est, la nouvelle table est cr√©√©e, et un objet y a √©t√© ins√©r√©. Passons maintenant aux choses s√©rieuses en cr√©ant la relation plusieurs √†
plusieurs avec les aliments.

### Ajoutez la table de liaison

Si vous vous souvenez de la partie 3, vous savez que MySQL (et les bases de donn√©es SQL en g√©n√©ral) ne savent techniquement pas stocker autre
chose que des relations un √† plusieurs.

Pour les relations plusieurs √† plusieurs, on ‚Äútriche‚Äù, via une **table de liaison** o√π on va stocker chaque relation, comme si c‚Äô√©tait une
double relation un √† plusieurs.

En fait, les aliments vont avoir des relations un √† plusieurs avec la table de liaison. Les lieux, eux aussi, vont disposer de telles relations
avec cette table. Et c‚Äôest en **reliant ces deux tables via cette table de liaison** que vous allez pouvoir ressortir les relations entre lieux
et aliments.

Pour ce faire, une table de liaison doit √™tre cr√©√©e. Par convention, elle doit toujours avoir cette forme :
- Son nom doit regrouper les deux tables qu‚Äôelle relie, sous la forme : ‚Äútable1_table2‚Äù.
- Elle n‚Äôa que deux champs √† stocker : ‚Äútable1_id‚Äù et ‚Äútable2_id‚Äù. Soit les id de chaque objet qu‚Äôelle relie.
    - Ces id sont donc des **r√©f√©rences** aux id des autres tables.
- Sa cl√© primaire n‚Äôest autre que l‚Äôassociation de ces deux id (association qui doit toujours √™tre unique).

Dans notre cas, cela donne ceci en commande SQL :

```sql
CREATE TABLE aliment_lieu (
aliment_id INT NOT NULL,
lieu_id INT NOT NULL,
FOREIGN KEY (aliment_id) REFERENCES aliment (id) ON DELETE RESTRICT ON UPDATE CASCADE,
FOREIGN KEY (lieu_id) REFERENCES lieu (id) ON DELETE RESTRICT ON UPDATE CASCADE,
PRIMARY KEY (aliment_id, lieu_id)
);
```

D√©cortiquons cette commande ensemble :
- On **cr√©e une nouvelle table** avec le nom des deux tables qu‚Äôelle relie (ici la table ‚Äúaliment‚Äù, ainsi que la table ‚Äúlieu‚Äù).
- On **ajoute les r√©f√©rences** aux id de ces deux tables :
    - ‚Äúaliment_id‚Äù, qui est une r√©f√©rence aux id de la table ‚Äúaliment‚Äù ;
    - ‚Äúlieu_id‚Äù, qui est une r√©f√©rence aux id de la table ‚Äúlieu‚Äù ;
    - on signale √† MySQL **comment mettre √† jour** la BDD en cas de suppression ou de mise √† jour d‚Äôun objet de ‚Äúaliment_lieu‚Äù.
- On explique √† MySQL que l‚Äôid de cette table sera l‚Äôassociation entre les deux id pr√©c√©dents.

:::info
Vous vous demandez ce que signifie **`ON UPDATE`** ? Eh bien, c‚Äôest le comportement que doit adopter MySQL en cas de **mise √† jour** d‚Äôun champ.
Il peut avoir les m√™mes options que **`ON DELETE`**, que vous avez vu dans le chapitre pr√©c√©dent. üòâ
:::

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109652325493_P4_ON-UPDATE.png"
         alt="R√©capitulatif visuel de la commande. RESTRICT ou NO ACTION : emp√™che la mise √† jour sous conditions. SET NULL : met √† jour la famille et remplace les object par NULL. CASCADE : met √† jour tous les objets reli√©s" />
    <figcaption>Actions de la commande ON UPDATE</figcaption>
</figure>

:::note ?
C‚Äôest bien beau tout √ßa, mais comment ajoute-t-on une relation entre les lieux et les aliments ?
:::

Pas de panique, √ßa arrive !

Admettons que le ‚Äúblanc de dinde‚Äù pr√©sent dans notre BDD soit vendu chez ‚ÄúCarrefour City‚Äù. Il vous faudrait alors cr√©er un objet dans
‚Äúaliment_lieu‚Äù, avec l‚Äôid de ‚Äúblanc de dinde‚Äù ainsi que l‚Äôid de ‚ÄúCarrefour City‚Äù.

Retrouvez ces id dans votre BDD et √©crivez la commande SQL pour cr√©er cette relation.

Sachant que 11 est l‚Äôid du ‚Äúblanc de dinde‚Äù, 1 celui du ‚ÄúCarrefour City‚Äù, cela donne √ßa :

```sql
INSERT INTO `aliment_lieu` (`aliment_id`, `lieu_id`) VALUES ('11', '1');
```

Et voil√†, le fait que le blanc de dinde soit vendu √† Carrefour est stock√© en base de donn√©es. Bravo √† vous. üëè

Enfin, pour retrouver cette relation, il vous faudra faire un **double JOIN**. Rappelez-vous, nous avions vu √ßa ensemble dans
[la partie 2](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142248-inserez-des-donnees-dans-votre-bdd).

Cela ressemble √† √ßa :

```sql
SELECT * FROM aliment
JOIN aliment_lieu ON aliment.id = aliment_lieu.aliment_id
JOIN lieu ON lieu.id = aliment_lieu.lieu_id
WHERE aliment.id = 11;
```

:::info
Ici, on joint la table aliment √† la table lieu **via** la table de liaison, comme si c‚Äô√©tait une simple relation un √† plusieurs r√©p√©t√©e.
:::

En sortie, MySQL vous affichera bien le ‚Äúblanc de dinde‚Äù avec son lieu de vente associ√© : ‚ÄúCarrefour City‚Äù !

### √Ä vous de jouer !

On souhaite savoir quels sont les appareils sur lesquels les utilisateurs ont install√© Foodly (par exemple : mac, pc, android, etc.).

Un utilisateur peut utiliser Foodly sur plusieurs appareils, et un m√™me appareil peut √™tre commun √† plusieurs utilisateurs. Il s‚Äôagit d‚Äôune
relation plusieurs √† plusieurs.

Un appareil est uniquement constitu√© de son type au format texte.

```sql
mysql> CREATE TABLE appareil (
    -> id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> type VARCHAR(100) NOT NULL
    -> );
Query OK, 0 rows affeected (0.01 sec)

mysql> INSERT INTO appareil (type) VALUES ('iphone');
Query OK, 1 rows affeected (0.00 sec)

mysql> INSERT INTO appareil (type) VALUES ('android');
Query OK, 1 rows affeected (0.00 sec)

mysql> INSERT INTO appareil (type) VALUES ('pc');
Query OK, 1 rows affeected (0.00 sec)

mysql> INSERT INTO appareil (type) VALUES ('mac');
Query OK, 1 rows affeected (0.00 sec)

mysql> SELECT * FROM appareil;
+----+---------+
| id | type    |
+----+---------+
|  1 | iphone  |
|  2 | android |
|  3 | pc      |
|  4 | mac     |
+----+---------+
4 rows in set (0.00 sec)

mysql> CREATE TABLE utilisateur_appareil (
    -> utilisateur_id INT NOT NULL,
    -> appareil_id INT NOT NULL,
    -> FOREIGN KEY (utilisateur_id) REFERENCES utilisateur (id) ON DELETE RESTRICT ON UPDATE CASCADE,
    -> FOREIGN KEY (appareil_id) REFERENCES appareil (id) ON DELETE RESTRICT ON UPDATE CASCADE,
    -> PRIMARY KEY (utilisateur_id, appareil_id)
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> SELECT * FROM utilisateur_appareil;
Empty set (0.00 sec)

mysql> SELECT * FROM utilisateur WHERE id = 1;
+----+---------+------------------+-----------+
| id | prenom  | email            | langue_id |
+----+---------+------------------+-----------+
|  1 | quentin | qentin@gmail.com |         1 |
+----+---------+------------------+-----------+
1 row in set (0.00 sec)

mysql> INSERT INTO utilisateur_appareil (utilisateur_id, appareil_id) VALUES (1, 2);
Query OK, 1 rows affected (0.01 sec)

mysql> INSERT INTO utilisateur_appareil (utilisateur_id, appareil_id) VALUES (1, 4);
Query OK, 1 rows affected (0.01 sec)

mysql> SELECT * FROM utilisateur_appareil;
+----------------+-------------+
| utilisateur_id | appareil_id |
+----------------+-------------+
|              1 |           2 |
|              1 |           4 |
+----------------+-------------+
2 row in set (0.00 sec)

mysql> SELECT * FROM utilisateur
    -> JOIN utilisateur_appareil
    -> ON utilisateur.id = utilisateur_appareil.utilisateur_id
    -> JOIN appareil
    -> ON appareil.id = utilisateur_appareil.appareil_id
    -> WHERE utilisateur.id = 1;
+----+---------+------------------+-----------+----------------+-------------+----+---------+
| id | prenom  | email            | langue_id | utilisateur_id | appareil_id | id | type    |
+----+---------+------------------+-----------+----------------+-------------+----+---------+
|  1 | quentin | qentin@gmail.com |         1 |              1 |           2 |  2 | android |
|  1 | quentin | qentin@gmail.com |         1 |              1 |           4 |  4 | mac     |
+----+---------+------------------+-----------+----------------+-------------+----+---------+
2 row in set (0.00 sec)
```

:::note ?
Comment feriez-vous pour cr√©er cette table et la lier aux utilisateurs ?
:::

Je crois en vous pour effectuer cette op√©ration seul üôå Si vous √™tes bloqu√©, la correction est disponible ici :

<Vimeo vimeoId="497578465" />

<br />

### En r√©sum√©

- Vous savez ajouter une relation plusieurs √† plusieurs entre deux objets **en cr√©ant une table de liaison** qui **contiendra les id de chaque
objet**.

_Vous voil√† arriv√© √† la fin de ce cours. Retrouvez-moi au chapitre suivant pour la conclusion !_

-----

## Terminez votre apprentissage

[Terminez votre apprentissage - Impl√©mentez vos bases de donn√©es relationnelles avec SQL - OpenClassrooms](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142305-terminez-votre-apprentissage)

<Vimeo vimeoId="497953156" />

<br />

Vous voici √† la conclusion de ce cours, bravo ! üëè Il ne vous reste plus qu'un dernier effort avec la r√©alisation du dernier quiz.

Vous avez normalement toutes les bases en main pour impl√©menter votre propre BDD. Que ce soit pour un projet personnel, le travail, ou par
simple curiosit√©, j‚Äôesp√®re de tout c≈ìur que ce cours vous aura √©t√© utile.

J‚Äôai personnellement ador√© √©crire ce cours, qui m‚Äôa moi-m√™me √©t√© d‚Äôune grande aide pour me remettre dans le bain des BDD relationnelles !

Je vous souhaite tout le meilleur pour la suite, et n‚Äôoubliez pas, continuez d‚Äôapprendre de nouvelles choses sur OpenClassrooms !

-----

## Quiz : Transformez la structure d‚Äôune base de donn√©es

[Transformez la structure d‚Äôune base de donn√©es - OpenClassrooms](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/exercises/4010)

#### Comp√©tences √©valu√©es

<i class="bi bi-check2-circle"></i> Transformer la structure d‚Äôune base de donn√©es

-----

#### Description

Reprenons notre BDD Moviz du pr√©c√©dent quiz. Vous pouvez la t√©l√©charger ici : [https://github.com/OpenClassrooms-Student-Center/Course-implementez-BDD-SQL/blob/master/partie\_4/moviz.sql](https://github.com/OpenClassrooms-Student-Center/Course-implementez-BDD-SQL/blob/master/partie_4/moviz.sql).

Souvenez-vous, j‚Äôai modifi√© le sch√©ma de la BDD entre la partie 2 et la partie 3 pour y ajouter la relation un √† plusieurs entre ‚Äúfilm‚Äù et
‚Äúnote‚Äù, ainsi que la relation plusieurs √† plusieurs entre ‚Äúfilm‚Äù et ‚Äúpays_de_sortie‚Äù.

Dans ce quiz, nous allons faire comme si vous impl√©mentiez vous-m√™me ces changements.

Pour rappel, voici le sch√©ma mis √† jour de la table ‚Äúfilm‚Äù :

| **Nom du champ** | **Type du champ** | **Description du champ** |
|------------------|-------------------|--------------------------|
| _nom_ | VARCHAR(255) | le nom du film |
| _date_de_sortie_ | DATE | la date de sortie du film |
| _synopsis_ | TEXT | la description du sc√©nario du film |
| _langue_ | VARCHAR(255) | la langue principale du film |
| _budget_ | INTEGER | le budget de production du film |
| note_id | INTEGER | l'id de l'objet note associ√© au film |

Le sch√©ma de la table ‚Äúnote‚Äù est disponible ici :

| **Nom du champ** | **Type du champ** | **Description du champ** |
|------------------|-------------------|--------------------------|
| _note_ | INTEGER | la note sur 5 |

Et enfin, voici le sch√©ma de ‚Äúpays_de_sortie‚Äù :

| **Nom du champ** | **Type du champ** | **Description du champ** |
|------------------|-------------------|--------------------------|
| _nom_ | VARCHAR(255) | le nom du pays |

-----

#### Question 1 : Quels sont les mots cl√©s disponibles dans une commande de type ALTER TABLE ?

<i class="bi bi-record-circle"></i> ADD, DROP, CHANGE, MODIFY<br />
<i class="bi bi-circle"></i> AJOUTER, SUPPRIMER, MODIFIER<br />
<i class="bi bi-circle"></i> ADD, DROP, CHANGE<br />
<br />

_ALTER TABLE sert √† modifier la structure d‚Äôun objet, et de la table associ√©e. ADD permet d‚Äôajouter un champ, DROP de le supprimer, CHANGE de
le renommer, MODIFY de modifier son type._

-----

#### Question 2 : Comment fait-on pour ajouter une relation un √† plusieurs entre deux objets existants d√©j√† en base ?

<i class="bi bi-record-circle"></i> On rajoute l‚Äôid de l‚Äôobjet ‚Äúun‚Äù comme colonne dans l‚Äôobjet ‚Äúplusieurs‚Äù avec comme nom ‚Äúobjet_id‚Äù.<br />
<i class="bi bi-circle"></i> On utilise une commande SQL avec le mot cl√© JOIN.<br />
<i class="bi bi-circle"></i> On supprime et recr√©e les deux objets.<br />
<br />

_Pour effectuer une relation un √† plusieurs, l‚Äôobjet ‚Äúun‚Äù de la relation doit √™tre mentionn√© dans l‚Äôobjet ‚Äúplusieurs‚Äù. La convention en SQL
est de reprendre son id (sa cl√© primaire) comme cl√© √©trang√®re dans l‚Äôobjet plusieurs._

-----

#### Question 3 : Dans la BDD Moviz, quelle est la commande qui permet de rajouter le champ ‚Äúnote_id‚Äù √† la table ‚Äúfilm‚Äù ?

<i class="bi bi-circle"></i> <code>ALTER TABLE film ADD note_id;</code><br />
<i class="bi bi-record-circle"></i> <code>ALTER TABLE film ADD note_id INTEGER NOT NULL;</code><br />
<i class="bi bi-circle"></i> <code>ALTER TABLE film ADD note_id VARCHAR(100);</code><br />
<br />

_Pour ajouter un champ √† un objet (et donc, √† sa table), on utilise une commande de type ALTER TABLE avec le mot cl√© ADD. Comme on souhaite
ajouter un champ qui sera une cl√© √©trang√®re, il est du m√™me type qu‚Äôune cl√© primaire, soit un entier (INTEGER) non nul (NOT NULL)._

-----

#### Question 4 : Quelle est la commande qui permet de supprimer le budget sur les films ?

<i class="bi bi-circle"></i> <code>ALTER TABLE film REMOVE budget;</code><br />
<i class="bi bi-record-circle"></i> <code>ALTER TABLE film DROP budget;</code><br />
<i class="bi bi-circle"></i> <code>ALTER TABLE film DELETE budget;</code><br />
<br />

_Pour supprimer un champ √† un objet (et donc, √† sa table), on utilise une commande de type ALTER TABLE avec le mot cl√© DROP suivi du nom du
champ √† supprimer._

-----

#### Question 5 : Quelle est la commande qui permet de modifier le type du champ ‚Äúbudget‚Äù d‚Äôentier vers d√©cimal ?

<i class="bi bi-record-circle"></i> <code>ALTER TABLE film MODIFY budget FLOAT;</code><br />
<i class="bi bi-circle"></i> <code>ALTER TABLE film MODIFY budget VARCHAR(100);</code><br />
<i class="bi bi-circle"></i> <code>ALTER TABLE film CHANGE budget FLOAT;</code><br />
<br />

_Pour modifier le type d‚Äôun champ, on utilise une commande de type ALTER TABLE avec le mot cl√© MODIFY suivi du nom du champ et de son nouveau
type (ici, d√©cimal, soit FLOAT)._

-----

#### Question 6 : Quelle est la commande qui permet de renommer le budget sur les films en ‚Äúcout_de_production‚Äù ?

<i class="bi bi-circle"></i> <code>ALTER TABLE film CHANGE budget cout_de_production;</code><br />
<i class="bi bi-record-circle"></i> <code>ALTER TABLE film CHANGE budget cout_de_production FLOAT;</code><br />
<i class="bi bi-circle"></i> <code>ALTER TABLE film MODIFY budget cout_de_production;</code><br />
<br />

_Pour renommer un champ, on utilise une commande de type ALTER TABLE avec le mot cl√© CHANGE suivi du nom du champ et de son nouveau nom. MySQL
oblige, on doit aussi repr√©ciser son type (ici FLOAT, car on l‚Äôa modifi√© √† la question pr√©c√©dente)._

-----

#### Question 7 : Comment cr√©e-t-on une relation plusieurs √† plusieurs entre deux objets existants d√©j√† en base ?

<i class="bi bi-circle"></i> On supprime et recr√©e les deux tables.<br />
<i class="bi bi-record-circle"></i> On cr√©e une table de liaison qui va stocker les relations entre ces deux objets.<br />
<i class="bi bi-circle"></i> On joint les tables avec un JOIN.<br />
<br />

_Rappelez-vous, la table de liaison regroupe les relations plusieurs √† plusieurs comme s‚Äôil s‚Äôagissait de relations un √† plusieurs. Pour ce
faire, elle contient 2 colonnes, chacune √©tant une cl√© √©trang√®re vers chaque objet de la relation plusieurs √† plusieurs._

-----

#### Question 8 : Quelle est la commande qui permet de cr√©er la table de liaison entre ‚Äúfilm‚Äù et ‚Äúpays_de_sortie‚Äù ?

<i class="bi bi-record-circle"></i>

```sql
CREATE TABLE film_pays_de_sortie (
film_id INT NOT NULL,
pays_de_sortie_id INT NOT NULL,
FOREIGN KEY (film_id) REFERENCES film (id) ON DELETE RESTRICT ON UPDATE CASCADE,
FOREIGN KEY (pays_de_sortie_id) REFERENCES pays_de_sortie (id) ON DELETE RESTRICT ON UPDATE CASCADE,
PRIMARY KEY (film_id, pays_de_sortie_id)
);
```

<i class="bi bi-circle"></i>

```sql
CREATE TABLE film_pays_de_sortie;
```

<i class="bi bi-circle"></i>

```sql
CREATE TABLE film_pays_de_sortie (
film_id INT NOT NULL,
pays_de_sortie_id INT NOT NULL
);
```

*La table de liaison doit avoir pour nom ‚Äúnom_objet_1_nom_objet_2‚Äù, soit ici ‚Äúfilm_pays_de_sortie‚Äù et stocker deux champs, qui sont les cl√©s
√©trang√®res de chaque autre table, soit ici ‚Äúfilm_id‚Äù (cl√© √©trang√®re vers l‚Äôid de ‚Äúfilm‚Äù) et ‚Äúpays_de_sortie_id‚Äù (cl√© √©trang√®re vers l‚Äôid de
‚Äúpays_de_sortie‚Äù).*
