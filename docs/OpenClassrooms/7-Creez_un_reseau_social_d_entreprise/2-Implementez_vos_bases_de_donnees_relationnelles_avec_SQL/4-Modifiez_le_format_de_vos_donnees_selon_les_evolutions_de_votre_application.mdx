---
sidebar_position: 5
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import { Vimeo } from 'mdx-embed';

# Modifiez le format de vos donnÃ©es selon les Ã©volutions de votre application

## Modifiez la structure dâ€™un objet avec ALTER TABLE

[Modifiez la structure dâ€™un objet avec ALTER TABLE - ImplÃ©mentez vos bases de donnÃ©es relationnelles avec SQL - OpenClassrooms](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142288-modifiez-la-structure-d-un-objet-avec-alter-table)

<Vimeo vimeoId="497953098" />

<br />

InsÃ©rer de la donnÃ©e, la modifier, la supprimer, ou bien en tirer des informations utiles est dÃ©sormais Ã  votre portÃ©e. Bien jouÃ© !

Mais il reste une chose Ã  voir, une chose importante dont vous aurez toujours besoin si vous souhaitez adapter votre BDD aux Ã©volutions de
votre application.

Vous voyez laquelle câ€™est ? ğŸ¤”

Il sâ€™agit de la **modification de la structure** de la BDD en elle-mÃªme. CommenÃ§ons simplement par lâ€™ajout et la suppression de champs.

### Ajoutez un champ

#### Ajoutez un champ aux aliments

Le dernier rapport sur lâ€™utilisation de Foodly vient de tomber. Dans celui-ci, les utilisateurs ont pu voter pour les amÃ©liorations quâ€™ils
souhaiteraient voir apparaÃ®tre dans lâ€™application.

La plus demandÃ©e Ã©tait celle de voir la contenance en vitamines de chaque aliment.

Sachant cela, lâ€™Ã©quipe de Foodly organise une rÃ©union concernant lâ€™implÃ©mentation dâ€™une telle fonctionnalitÃ©. Le design est prÃªt, les
dÃ©veloppeurs ont codÃ© lâ€™interface, mais il manque une chose cruciale pour rÃ©cupÃ©rer la contenance en vitamines dans lâ€™application : lâ€™ajout de
cette donnÃ©e dans la BDD.

Prenons lâ€™exemple de la vitamine C.

Cette colonne nâ€™apparaÃ®t nulle part dans le schÃ©ma de la table aliment. Il nous faut la crÃ©er.

De la mÃªme maniÃ¨re que vous lâ€™avez fait lors de la premiÃ¨re partie, il faudra spÃ©cifier son type Ã  MySQL. Pour ce faire, utilisez la commande
**`ALTER TABLE`**.

Voyons Ã  quoi ressemble la commande SQL pour rajouter cette colonne, puis dÃ©cortiquons-la ensemble :

```sql
ALTER TABLE aliment ADD vitamines_c FLOAT;
```

Ici, on signale Ã  MySQL :
- de modifier la structure dâ€™une table avec **`ALTER TABLE`** ;
- quelle table modifier (ici â€œalimentâ€) ;
- que la modification va faire ajouter une colonne avec **`ADD`**;
- le nom de cette nouvelle colonne (ici â€œvitamines_câ€) ;
- enfin, le type de la colonne (ici, **`FLOAT`**, car les vitamines sont stockÃ©es usuellement en mg/100g, valeur dÃ©cimale).

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109647551199_P4_ALTER-TABLE.png"
         alt="RÃ©capitulatif visuel du paragraphe rÃ©digÃ© ci-dessus" />
    <figcaption>La commande ALTER TABLE</figcaption>
</figure>

:::info
Ã€ noter que le type nâ€™est parfois pas seul. On peut aussi (comme dans la partie 1), mentionner Ã  MySQL quâ€™on rajoute une colonne qui est :
- une clÃ© primaire (**PRIMARY KEY**) ;
- avec une valeur par dÃ©faut (**DEFAULT valeur_par_dÃ©faut**) ;
- non nulle (**NOT NULL**). Auquel cas il faudra prÃ©ciser une valeur par dÃ©faut, MySQL crÃ©ant la colonne avec la valeur â€œNULLâ€ pour tous les
objets existants dans cette table ;
- etc.
:::

### Ã€ vous de jouer !

Faisons un petit exercice :

> Admettons que lâ€™on souhaite rajouter une colonne Ã  la table â€œlangueâ€. Cette colonne, câ€™est [le code ISO des langues](http://www.lingoes.net/en/translator/langcode.htm)
(par exemple : â€œfr-frâ€ pour le FranÃ§ais de mÃ©tropole).

Comment feriez-vous cela ?

```sql
ALTER TABLE langue ADD code VARCHAR(100);
```

```sql
mysql> SELECT * FROM langue;
+----+----------+------+
| id | nom      | code |
+----+----------+------+
|  1 | franÃ§ais | NULL |
|  2 | anglais  | NULL |
+----+----------+------+
2 rows in set (0.00 sec)
```

```sql
mysql> UPDATE langue SET code = 'fr-fr' WHERE id = 1;

mysql> UPDATE langue SET code = 'en-uk' WHERE id = 2;

mysql> SELECT * FROM langue;
+----+----------+-------+
| id | nom      | code  |
+----+----------+-------+
|  1 | franÃ§ais | fr-fr |
|  2 | anglais  | en-uk |
+----+----------+-------+
2 rows in set (0.00 sec)
```

Tentez de crÃ©er la colonne et de la remplir par vous-mÃªme pour le FranÃ§ais et lâ€™Anglais. Voici la correction :

<Vimeo vimeoId="497578353" />

<br />

:::info
Vous savez dÃ©sormais ajouter un champ Ã  une table. ğŸ™Œ
:::

### Supprimez un champ

#### Supprimez un champ aux aliments

Le management de chez Foodly nous mentionne dâ€™autres changements Ã  effectuer sur lâ€™application, qui impliquent la BDD. Câ€™est une nouvelle
surprenante !

Les utilisateurs de Foodly nâ€™utilisent que trÃ¨s rarement la fonctionnalitÃ© pour savoir si un aliment est bio ou non. ğŸ˜¢

Les dÃ©veloppeurs, dans leur volontÃ© de toujours diminuer la dette technique (Ã  savoir, le code Ã  maintenir), souhaitent retirer lâ€™affichage bio
de la fiche des aliments sur Foodly.

En tant que gestionnaire de la BDD, vous pensez quâ€™il serait pratique de faire de mÃªme de votre cÃ´tÃ©, pour Ã©viter de maintenir un champ qui ne
sera plus mis Ã  jour.

Pour ce faire, rien de plus simple : supprimons la colonne â€œbioâ€ de la table â€œalimentâ€ avec `DROP`.

Voici la commande SQL pour le faire :

```sql
ALTER TABLE aliment DROP bio;
```

DÃ©composons cette commande ensemble :
- On modifie toujours la structure dâ€™une table avec **`ALTER TABLE`**.
- On lui signale Ã  nouveau quelle table modifier (ici, â€œalimentâ€).
- On lui indique que la modification va supprimer une colonne avec **`DROP`**.
- On mentionne le nom de la colonne Ã  supprimer (ici, â€œbioâ€).

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109647839763_P4_DROP.png"
         alt="RÃ©capitulatif visuel du paragraphe rÃ©digÃ© ci-dessus" />
    <figcaption>Utilisation de DROP</figcaption>
</figure>

Vous voyez, câ€™est vraiment trÃ¨s simple. ğŸ˜‰

:::caution
Il faut nÃ©anmoins faire attention lorsquâ€™on utilise cette commande. Une fois la colonne supprimÃ©e, celle-ci est **dÃ©finitivement dÃ©truite** et
ne peut plus Ãªtre rÃ©cupÃ©rÃ©e. Vous perdez lâ€™information pour tous les objets prÃ©sents en base. **Ã€ utiliser avec parcimonie !**
:::

### Ã€ vous de jouer !

Maintenant, admettons que le service lÃ©gal de Foodly vous dise que stocker des noms de famille va Ã  lâ€™encontre des conditions de protection des
donnÃ©es des utilisateurs.

Comment feriez-vous pour supprimer les noms de famille ?

```sql
mysql> SELECT * FROM utilisateur;
+----+-------------+------------+----------------------+-----------+
| id | nom         | prenom     | email                | langue_id |
+----+-------------+------------+----------------------+-----------+
|  1 | durantay    | quentin    | qentin@gmail.com     |         1 |
|  2 | dupont      | marie      | marie@hotmail.fr     |         1 |
|  3 | miller      | vincent    | vm@yahoo.com         |         2 |
|  4 | zuckerberg  | marc       | marc@gmail.com       |         2 |
|  5 | paul        | pierre     | pp@orange.fr         |         1 |
|  6 | de vauclerc | lisa       | lisadv@gmail.com     |         1 |
|  7 | gluntig     | Ã©lÃ©onore   | glunt@sfr.com        |         1 |
|  8 | cavill      | henry      | henry@outlook.fr     |         2 |
|  9 | hopper      | lionel     | hpp@gmail.com        |         2 |
| 10 | tember      | fabienne   | fabienne@yopmail.com |         1 |
+----+-------------+------------+----------------------+-----------+
10 rows in set (0,00 sec)
```

```sql
mysql> ALTER TABLE utilisateur DROP nom;
```

```sql
mysql> SELECT * FROM utilisateur;
+----+------------+----------------------+-----------+
| id | prenom     | email                | langue_id |
+----+------------+----------------------+-----------+
|  1 | quentin    | qentin@gmail.com     |         1 |
|  2 | marie      | marie@hotmail.fr     |         1 |
|  3 | vincent    | vm@yahoo.com         |         2 |
|  4 | marc       | marc@gmail.com       |         2 |
|  5 | pierre     | pp@orange.fr         |         1 |
|  6 | lisa       | lisadv@gmail.com     |         1 |
|  7 | Ã©lÃ©onore   | glunt@sfr.com        |         1 |
|  8 | henry      | henry@outlook.fr     |         2 |
|  9 | lionel     | hpp@gmail.com        |         2 |
| 10 | fabienne   | fabienne@yopmail.com |         1 |
+----+------------+----------------------+-----------+
10 rows in set (0,00 sec)
```

Essayez de la faire. Si vous Ãªtes coincÃ©, lÃ  correction est juste ici ğŸ‘‡

<Vimeo vimeoId="497578371" />

<br />

:::info
Ajouter, supprimer, vous voilÃ  maÃ®tre en matiÃ¨re de modification de schÃ©ma de table ! Enfinâ€¦ pas trop vite ! Que se passerait-il si vous deviez
modifier une colonne existante ?
:::

Câ€™est ce que vous allez voir par la suite.

### Modifiez un champ existant

#### Modifiez un champ des aliments

Le management de Foodly revient encore une fois vers vous !

AprÃ¨s avoir regardÃ© des utilisateurs se servir de Foodly, ils se sont rendu compte que les utilisateurs souhaiteraient pouvoir filtrer les
aliments selon leurs apports calorifiques avec plus de prÃ©cision.

Pour ce faire, les dÃ©veloppeurs vous indiquent quâ€™ils vont devoir comparer les calories de deux aliments entre eux, et ce, Ã  la virgule prÃ¨s.

Or, les calories sont actuellement stockÃ©es sous forme dâ€™entiers (sans dÃ©cimales, du coup). Comment les modifier ?

Voici la commande pour effectuer cette opÃ©ration :

```sql
ALTER TABLE aliment MODIFY calories FLOAT;
```

:::info
Analysons cette commande :
- On modifie toujours la structure dâ€™une table avec **`ALTER TABLE`**.
- On lui signale Ã  nouveau quelle table modifier (ici, â€œalimentâ€).
- On lui indique que la modification va modifier le type dâ€™une colonne avec **`MODIFY`**.
- On mentionne le nom de la colonne Ã  modifier (ici, â€œcaloriesâ€).
- On indique le nouveau type de la colonne (ici, **`FLOAT`**).
:::

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109648446119_P4_MODIFY-FLOAT.png"
         alt="RÃ©capitulatif visuel du paragraphe rÃ©digÃ© ci-dessus" />
    <figcaption>L'utilisation de FLOAT</figcaption>
</figure>

### Ã€ vous de jouer !

Les dÃ©veloppeurs viennent vous voir affolÃ©s ! Certains utilisateurs ne peuvent pas sâ€™inscrire car leur email dÃ©passe les 255 caractÃ¨res.

Pourriez-vous augmenter la limite Ã  500 ?

```sql
mysql> SHOW COLUMNS FROM utilisateur;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| id        | int          | NO   | PRI | NULL    | auto_increment |
| nom       | varchar(100) | YES  |     | NULL    |                |
| prenom    | varchar(100) | YES  |     | NULL    |                |
| email     | varchar(255) | NO   | UNI | NULL    |                |
| langue_id | int          | NO   | MUL | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
4 rows in set (0.01 sec)
```

```sql
mysql> ALTER TABLE utilisateur MODIFY email VARCHAR(500) NOT NULL;

mysql> SHOW COLUMNS FROM utilisateur;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| id        | int          | NO   | PRI | NULL    | auto_increment |
| nom       | varchar(100) | YES  |     | NULL    |                |
| prenom    | varchar(100) | YES  |     | NULL    |                |
| email     | varchar(500) | NO   | UNI | NULL    |                |
| langue_id | int          | NO   | MUL | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
4 rows in set (0.01 sec)
```

Tentez par vous-mÃªme. Une fois fait, voici la correction :

<Vimeo vimeoId="497578391" />

<br />

:::info
PlutÃ´t pratique de savoir modifier le type dâ€™une colonne, non ? Mais que se passerait-il si vous souhaitiez changer le nom de cette derniÃ¨re ?

DÃ©couvrons-le !
:::

### Renommez un champ des aliments

Ce coup-ci, câ€™est la designer de Foodly qui revient vers vous : les utilisateurs sont perturbÃ©sâ€¦ ğŸ˜¨ Pour chaque aliment, la valeur en protÃ©ines,
vitamines, matiÃ¨res grasses est mentionnÃ©e au pluriel. Alors que les sucres, eux, sont mentionnÃ©s au singulier. Ce qui perturbe la comprÃ©hension
des aliments par les utilisateurs.

Comment renommer cette colonne dans la BDD ?

Voici la commande Ã  effectuer :

```sql
ALTER TABLE aliment CHANGE sucre sucres FLOAT;
```

:::info
Voici les explications de cette commande :
- On modifie toujours la structure dâ€™une table avec **`ALTER TABLE`**.
- On lui signale Ã  nouveau quelle table modifier (ici, â€œalimentâ€).
- On lui indique que la modification va modifier le nom dâ€™une colonne avec **`CHANGE`**.
- On mentionne le nom de la colonne Ã  renommer, **ainsi que** son nouveau nom (ici, â€œsucreâ€ devient â€œsucresâ€).
- On indique le nouveau type de la colonne (ici, **`FLOAT`**).
:::

Câ€™est une spÃ©cificitÃ© propre Ã  MySQL : pour renommer une colonne, il faut aussi indiquer son type. Ce qui nâ€™est pas nÃ©cessaire si vous utilisez
un autre SGBD. Cela permet de modifier Ã  la fois le nom et le type dâ€™une colonne dans une seule commande. Et ce, mÃªme si vous ne souhaitez pas
le modifier (rÃ©utilisez alors le mÃªme type ğŸ˜‰).

### Ã€ vous de jouer !

A prÃ©sent, les dÃ©veloppeurs trouvent que le nom â€œcodeâ€ dans la table des langues est peu explicite. Ils aimeraient quâ€™elle sâ€™appelle
â€œcode_paysâ€.

Pouvez-vous implÃ©menter ce changement ?

```sql
mysql> SELECT * FROM langue;
+----+----------+-------+
| id | nom      | code  |
+----+----------+-------+
|  1 | franÃ§ais | fr-fr |
|  2 | anglais  | en-uk |
+----+----------+-------+
2 rows in set (0.00 sec)
```

```sql
mysql> ALTER TABLE langue CHANGE code code_pays VARCHAR(100);

mysql> SELECT * FROM langue;
+----+----------+-----------+
| id | nom      | code_pays |
+----+----------+-----------+
|  1 | franÃ§ais | fr-fr     |
|  2 | anglais  | en-uk     |
+----+----------+-----------+
2 rows in set (0.00 sec)
```

Une fois que vous aurez essayÃ©, retrouvez ci-dessous la correction ğŸ‘‡

[TÃ©lÃ©charger la vidÃ©o](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142288-modifiez-la-structure-d-un-objet-avec-alter-table#popin-download-video)

### En rÃ©sumÃ©

- Vous savez que toute modification de la structure dâ€™un objet sâ€™effectue avec une commande **`ALTER TABLE`**.
- Pour ajouter un champ Ã  un objet, il vous faut utiliser le mot clÃ© **`ADD`**.
- Pour supprimer un champ, le mot clÃ© est **`DROP`**.
- Pour modifier un champ, le mot clÃ© est **`MODIFY`** pour en modifier la structure, **`CHANGE`** pour le renommer.

_Vous voilÃ  capable de totalement modifier le schÃ©ma dâ€™une table dâ€™une BDD MySQL. Vous Ãªtes presque maÃ®tre en BDD MySQL. ğŸ‘Œ_

_Presque ? Il vous reste encore Ã  apprendre Ã  modifier des relations dans une table ! Ne vous inquiÃ©tez pas, vous allez tout comprendre dans le
chapitre suivant._

-----

## Ajoutez une relation un Ã  plusieurs

[Ajoutez une relation un Ã  plusieurs - ImplÃ©mentez vos bases de donnÃ©es relationnelles avec SQL - OpenClassrooms](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142296-ajoutez-une-relation-un-a-plusieurs)

<Vimeo vimeoId="497953128" />

<br />

Voyons dans ce chapitre comment ajouter une relation un Ã  plusieurs, en crÃ©ant notre table "famille". Puis retrouvez dans le chapitre suivant
comment ajouter une relation plusieurs Ã  plusieurs avec la crÃ©ation de la table "lieu".

### Ajoutez une nouvelle table â€œfamilleâ€

Nous avons obtenu une nouvelle demande dâ€™amÃ©lioration de lâ€™application de la part des utilisateurs !

Ces derniers aimeraient pouvoir trier les aliments selon leur â€œfamilleâ€. Par exemple, regrouper ensemble les fruits, les lÃ©gumes, les viandes,
etc.

Les dÃ©veloppeurs pensent quâ€™il serait utile de sÃ©parer ces familles des aliments. En effet, ils pensent que les familles dâ€™aliments pourront
Ãªtre utilisÃ©es de maniÃ¨re indÃ©pendante, pas forcÃ©ment uniquement sur les fiches des aliments.

Par exemple, pour effectuer un rÃ©sumÃ© de la consommation en fruits ou lÃ©gumes dâ€™une personne sur un mois, ou la rÃ©partition au sein de ses
courses.

:::info
Pour cela, il faudrait que les familles dâ€™aliments soient sur une table distincte de celle des aliments !
:::

Maintenant que vous savez **joindre** plusieurs tables entre elles, il est temps de construire une telle relation entre tables. Quâ€™en
dites-vous ?

Avant de pouvoir relier les aliments Ã  leur famille, il faut dâ€™abordâ€¦ eh bien, crÃ©er la table famille !

Pour lâ€™instant, un objet de type famille ne devra contenir que le nom de cette famille (â€œfruitâ€, â€œviandeâ€, etc.).

Vous avez dÃ©jÃ  vu comment crÃ©er une table. Je vous fais confiance pour crÃ©er celle-ci. ğŸ˜‰

Câ€™est fait ? Voici la correction :

```sql
CREATE TABLE famille (
id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
nom VARCHAR(100) NOT NULL
);
```

:::info
Vous ne comprenez pas cette commande ou vous ne vous souvenez plus des types ? Je vous invite Ã  relire le [troisiÃ¨me chapitre de la premiÃ¨re partie](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142232-creez-votre-base-de-donnees-bdd). ğŸ˜‰
:::

Maintenant que cette table est crÃ©Ã©e, insÃ©rons un objet dans celle-ci. Disons, lâ€™objet qui va reprÃ©senter les lÃ©gumes.

Vous vous souvenez de la commande ? La voici :

```sql
INSERT INTO famille (`nom`) VALUES ('lÃ©gumes');
```

:::info
Vous Ãªtes perdu face Ã  cette commande ? Relisez le [premier chapitre de la deuxiÃ¨me partie](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142248-inserez-des-donnees-dans-votre-bdd). ğŸ˜‰
:::

Et voilÃ , vous voici en possession dâ€™une nouvelle table â€œfamilleâ€ qui dispose dâ€™un objet â€œlÃ©gumesâ€.

Passons Ã  la suite et adaptons notre BDD pour stocker la relation entre les aliments et leur famille.

### Ajoutez la relation entre famille et aliment

Une des choses Ã  dÃ©terminer lors de lâ€™ajout dâ€™une relation, câ€™est de savoir si :
- câ€™est une relation **un Ã  plusieurs** ;
- ou une relation **plusieurs Ã  plusieurs**.

Ici, un aliment peut avoir une seule famille, mais une famille peut Ãªtre prÃ©sente sur plusieurs aliments. Par exemple, une poire et une pomme
font partie de la famille â€œfruitsâ€.

:::info
Il sâ€™agit donc dâ€™une relation un Ã  plusieurs.
:::

Dans le cadre dâ€™une telle relation, **câ€™est lâ€™objet qui se trouve du cÃ´tÃ© â€œplusieursâ€ de la relation qui va Ãªtre modifiÃ©**, ici les aliments.
On va devoir y stocker lâ€™id de lâ€™objet â€œunâ€ associÃ©, par exemple â€œfruitsâ€.

Ici, les aliments vont donc devoir Ãªtre mis Ã  jour pour y stocker une rÃ©fÃ©rence Ã  leur famille. Cette rÃ©fÃ©rence, par convention, sera lâ€™id de
la famille.

Voici les Ã©tapes que lâ€™on va suivre :
1. Ajout du champ famille_id sur les aliments.
2. Modification de ce champ pour signaler Ã  MySQL que câ€™est une **rÃ©fÃ©rence** Ã  la table famille.
3. Modification dâ€™un objet pour y stocker une relation.

Concernant lâ€™ajout du champ famille_id aux aliments, vous devriez vous en sortir seul. ğŸ˜‰

Câ€™est une clÃ© primaire (un id), vous commencez Ã  bien les connaÃ®tre. Et pour ajouter un champ Ã  un schÃ©ma, vous venez juste de le voir dans le
chapitre prÃ©cÃ©dent !

Au cas oÃ¹, voici la commande :

```sql
ALTER TABLE aliment
ADD famille_id INT NOT NULL;
```

Ensuite, Ã§a se complique. Il faut quâ€™on indique Ã  MySQL que ce champ est une **rÃ©fÃ©rence** Ã  une autre table, en lui prÃ©cisant quel champ de
cette autre table on rÃ©fÃ©rence.

Pour modifier le champ famille_id, on utilise la commande :

```sql
ALTER TABLE aliment
ADD FOREIGN KEY (famille_id) REFERENCES famille (id)
ON DELETE CASCADE;
```

:::note ?
HoulÃ , Ã§a fait peur ğŸ˜¨
:::

Voyons ensemble ce que cette commande signifie :
- La premiÃ¨re partie, vous la connaissez. ğŸ˜‰ On signale Ã  MySQL quâ€™on souhaite modifier la table â€œalimentâ€, pour y ajouter une colonne (enfin,
plutÃ´t y ajouter une contrainte, dans ce cas prÃ©cis).
- On dit Ã  MySQL que la colonne â€œfamille_idâ€ est **une clÃ© Ã©trangÃ¨re** (***foreign key*** en anglais), soit une rÃ©fÃ©rence Ã  une colonne dâ€™une
autre table (ici, avec la partie `FOREIGN KEY (famille_id)`).
- On indique ensuite **ce Ã  quoi cette clÃ© fait rÃ©fÃ©rence**. Soit, dans notre cas, la colonne â€œidâ€ de la table â€œfamilleâ€ (soit la commande
`REFERENCES famille(id)`).
- Enfin, sÃ»rement la partie la plus obscure pour vous, on indique Ã  MySQL **le comportement Ã  adopter en cas de suppression** de lâ€™objet
â€œuniqueâ€ (ici, la â€œfamilleâ€).

:::note ?
HÃ©, mais je nâ€™ai rien compris au dernier point !
:::

Laissez-moi vous expliquer. ğŸ¤”

Admettons que je vienne de crÃ©er ma famille â€œfruitsâ€, et quâ€™elle soit reliÃ©e Ã  mes objets â€œpommeâ€ et â€œpoireâ€.

Que se passe-t-il si je supprime la famille â€œfruitsâ€ ?

Eh bien, MySQL a besoin de le savoir. Pour cela, on lui indique via la commande **`ON DELETE`**.

Cette derniÃ¨re peut prendre une option parmi celles-ci :
- **`RESTRICT`** ou **`NO ACTION`** : MySQL va empÃªcher la suppression tant que â€œfruitsâ€ est rÃ©fÃ©rencÃ© sur au moins un objet â€œalimentâ€.
- **`SET NULL`** : MySQL va autoriser la suppression de â€œfruitsâ€, et remplacer â€œfamille_idâ€ sur â€œpommeâ€ et â€œpoireâ€ par la valeur NULL.
- **`CASCADE`** : lâ€™option la plus courante, mais la plus dangereuse. ğŸ˜¨ Ici, MySQL va supprimer â€œpoireâ€ et â€œpommeâ€ en mÃªme temps que â€œfruitsâ€
(il va donc supprimer tous les objets reliÃ©s).

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/1610964972865_P4_ON-DELETE.png"
         alt="RÃ©capitulatif visuel du paragraphe rÃ©digÃ© ci-dessus" />
    <figcaption>Actions de la commande ON DELETE</figcaption>
</figure>

VoilÃ , MySQL sait que â€œfamille_idâ€ est une rÃ©fÃ©rence Ã  lâ€™id de la table famille !

Reste maintenant Ã  mettre Ã  jour vos aliments !

Pareil ici, vous avez toutes les compÃ©tences en main pour le faire. Sauriez-vous par exemple ajouter la relation de lâ€™objet â€œharicots vertsâ€
vers la famille â€œlÃ©gumesâ€ ?

Voici la commande :

```sql
UPDATE `aliment` SET `famille_id` = '1' WHERE `nom` = 'haricots verts';
```

:::info
Nâ€™oubliez pas, â€œlÃ©gumesâ€ ayant Ã©tÃ© ajoutÃ© en premier Ã  la table â€œfamilleâ€, il a lâ€™id numÃ©ro 1. Si vous Ãªtes perdu, [relisez la partie 2](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142248-inserez-des-donnees-dans-votre-bdd) !
:::

Pour vÃ©rifier que cela a bien fonctionnÃ©, vous pouvez sÃ©lectionner les haricots verts avec leur famille grÃ¢ce Ã  un **JOIN**.

```sql
SELECT * FROM aliment
JOIN famille ON aliment.famille_id = famille.id
WHERE aliment.nom = "haricots verts";
```

GrÃ¢ce Ã  cette commande, vous verrez apparaÃ®tre un tableau rÃ©capitulatif, oÃ¹ la famille de â€œharicots vertsâ€ est bien â€œlÃ©gumesâ€.

:::info
Perdu Ã  nouveau ? Ne vous inquiÃ©tez pas, [relisez le chapitre 3 de la partie prÃ©cÃ©dente](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142285-implementez-des-relations-entre-vos-donnees-grace-a-join),
sur la commande `JOIN`.
:::

Il ne vous reste plus quâ€™Ã  ajouter les autres familles vous-mÃªme, rajouter sa famille Ã  chaque aliment, et le tour est jouÃ© !

Pour ce faire, vous nâ€™avez quâ€™Ã  rÃ©effectuer les commandes prÃ©cÃ©dentes en les adaptant. Câ€™est un super moyen de revoir tout ce que vous avez pu
apprendre lors de ce cours !

### Ã€ vous de jouer !

Faisons un petit exercice :

On souhaite rajouter les rÃ©ductions disponibles sur les aliments. Une rÃ©duction pouvant Ãªtre la mÃªme pour plusieurs aliments mais chaque
aliment pouvant nâ€™avoir quâ€™une seule rÃ©duction, il sâ€™agit dâ€™une relation un Ã  plusieurs.

Les rÃ©ductions sont uniquement constituÃ©es dâ€™un champ â€œvaleurâ€, qui va contenir la rÃ©duction au format texte.

Comment feriez-vous pour crÃ©er cette table et la lier aux aliments ?

```sql
mysql> CREATE TABLE reduction (
    -> id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> valeur VARCHAR(100) NOT NULL
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> INSERT INTO reduction (valeur) VALUES ('-30%');
Query OK, 1 row affected (0.00 sec)

mysql> INSERT INTO reduction (valeur) VALUES ('-50%');
Query OK, 1 row affected (0.00 sec)

mysql> SELECT * FROM reduction;
+----+--------+
| id | valeur |
+----+--------+
|  1 | -30%   |
|  2 | -50%   |
+----+--------+
2 rows in set (0.00 sec)

mysql> ALTER TABLE aliment ADD reduction_id INT;
Query OK, 0 rows affected (0.01 sec)
Records: 0 Duplicates: 0 Warnings: 0

mysql> ALTER TABLE aliment ADD FOREIGN KEY (reduction_id) REFERENCES reduction (id) ON DELETE SET NULL;
Query OK, 20 rows affected (0.02 sec)
Records: 20 Duplicates: 0 Warnings: 0

mysql> SELECT * FROM aliment WHERE id=1;
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+
| id | nom   | marque      | sucre | calories | graisses | proteines | bio  | reduction_id |
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+
|  1 | pomme | sans marque |  19.1 |       72 |      0.2 |       0.4 |    0 |         NULL |
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+
1 row in set (0.00 sec)

mysql> UPDATE aliment SET reduction_id = 1 WHERE id = 1;
Query OK, 1 rows affected (0.01 sec)
Rows matched: 1 Changed: 1 Warnings: 0

mysql> SELECT * FROM aliment WHERE id=1;
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+
| id | nom   | marque      | sucre | calories | graisses | proteines | bio  | reduction_id |
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+
|  1 | pomme | sans marque |  19.1 |       72 |      0.2 |       0.4 |    0 |            1 |
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+
1 row in set (0.00 sec)

mysql> SELECT * from aliment
    -> JOIN reduction
    -> ON aliment.reduction_id = reduction.id
    -> WHERE aliment.id = 1;
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+----+--------+
| id | nom   | marque      | sucre | calories | graisses | proteines | bio  | reduction_id | id | valeur |
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+----+--------+
|  1 | pomme | sans marque |  19.1 |       72 |      0.2 |       0.4 |    0 |            1 |  1 | -30%   |
+----+-------+-------------+-------+----------+----------+-----------+------+--------------+----+--------+
1 row in set (0.00 sec)
```

Je vous laisse faire, vous en Ãªtes capable. ğŸ’ª Une fois essayÃ©, voici la correction :

<Vimeo vimeoId="497578418" />

<br />

### En rÃ©sumÃ©

- Vous savez ajouter une relation un Ã  plusieurs entre deux objets en **ajoutant** Ã  lâ€™objet A **un champ qui contiendra lâ€™id** (ou clÃ© primaire)
de lâ€™objet B.

_Voyons au chapitre suivant comment ajouter un relation plusieurs Ã  plusieurs entre deux objets._

-----

## Ajoutez une relation plusieurs Ã  plusieurs

[Ajoutez une relation plusieurs Ã  plusieurs - ImplÃ©mentez vos bases de donnÃ©es relationnelles avec SQL - OpenClassrooms](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7153111-ajoutez-une-relation-plusieurs-a-plusieurs)

![](https://user.oc-static.com/upload/2021/01/26/16116831263516_BANNERS_%20P4C3.png)

Vous avez crÃ©Ã© votre nouvelle table "famille" ? Souvenez-vous on aimerait ensuite ajouter le type de magasin oÃ¹ sont prÃ©sents les aliments. Un
mÃªme aliment pouvant Ãªtre prÃ©sent dans plusieurs lieux, nous allons crÃ©er une relation plusieurs Ã  plusieurs. Voyons comment faire !

### Ajoutez une nouvelle table â€œlieuâ€

La derniÃ¨re demande de mise Ã  jour des utilisateurs est arrivÃ©e !

Ces derniers rÃ©clament une chose en thÃ©orie simple : pouvoir visualiser dans lâ€™application de Foodly dans quel magasin sont disponibles leurs
aliments prÃ©fÃ©rÃ©s. Par exemple, savoir si leur jambon de prÃ©dilection est disponible aussi bien Ã  Carrefour que chez Leclerc.

Les dÃ©veloppeurs se sont de nouveau regroupÃ©s : il va falloir stocker les **lieux de vente** dans la BDD.

Un lieu pouvant vendre plusieurs aliments, et ces mÃªmes aliments pouvant Ãªtre vendus dans plusieurs lieux, vous allez devoir crÃ©er une
**relation plusieurs Ã  plusieurs**.

Mais avant toute chose, il vous faut crÃ©er la nouvelle table des lieux de vente (que nous allons sobrement appeler â€œlieuâ€).

Un lieu de vente, câ€™est :
- un nom (exemple : Carrefour City) ;
- un type (exemple : supermarchÃ©).

Je vous laisse crÃ©er la table vous-mÃªme ? AprÃ¨s tout, vous avez toutes les cartes en main pour le faire !

Allez-y, je vous attends. ğŸ˜‰

Bon, allez, au cas oÃ¹, voici la correction :

```sql
CREATE TABLE lieu (
id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
nom VARCHAR(100) NOT NULL,
type VARCHAR(100) NOT NULL
);
```

:::info
Vous Ãªtes perdu face Ã  cette commande ? Revoyez la [partie 1 du cours](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7139618-installez-votre-systeme-de-gestion-de-base-de-donnees-sgbd) !
:::

OK, une fois la table crÃ©Ã©e, insÃ©rons un lieu dans cette derniÃ¨re, partons sur un simple Carrefour City (oui, Ã§a se sent que je suis citadin ? ğŸ˜†).

Pareil ici, vous devriez pouvoir Ã©crire cette commande vous-mÃªme, jâ€™en suis sÃ»r. ğŸ™Œ

Au cas oÃ¹, voici la correction :

```sql
INSERT INTO `lieu` (`nom`, `type`) VALUES ('Carrefour City', 'supermarchÃ©');
```

:::info
Vous nâ€™Ãªtes pas sÃ»r de ce que cette commande signifie ? Relisez la partie 2 du cours !
:::

Ã‡a y est, la nouvelle table est crÃ©Ã©e, et un objet y a Ã©tÃ© insÃ©rÃ©. Passons maintenant aux choses sÃ©rieuses en crÃ©ant la relation plusieurs Ã 
plusieurs avec les aliments.

### Ajoutez la table de liaison

Si vous vous souvenez de la partie 3, vous savez que MySQL (et les bases de donnÃ©es SQL en gÃ©nÃ©ral) ne savent techniquement pas stocker autre
chose que des relations un Ã  plusieurs.

Pour les relations plusieurs Ã  plusieurs, on â€œtricheâ€, via une **table de liaison** oÃ¹ on va stocker chaque relation, comme si câ€™Ã©tait une
double relation un Ã  plusieurs.

En fait, les aliments vont avoir des relations un Ã  plusieurs avec la table de liaison. Les lieux, eux aussi, vont disposer de telles relations
avec cette table. Et câ€™est en **reliant ces deux tables via cette table de liaison** que vous allez pouvoir ressortir les relations entre lieux
et aliments.

Pour ce faire, une table de liaison doit Ãªtre crÃ©Ã©e. Par convention, elle doit toujours avoir cette forme :
- Son nom doit regrouper les deux tables quâ€™elle relie, sous la forme : â€œtable1_table2â€.
- Elle nâ€™a que deux champs Ã  stocker : â€œtable1_idâ€ et â€œtable2_idâ€. Soit les id de chaque objet quâ€™elle relie.
    - Ces id sont donc des **rÃ©fÃ©rences** aux id des autres tables.
- Sa clÃ© primaire nâ€™est autre que lâ€™association de ces deux id (association qui doit toujours Ãªtre unique).

Dans notre cas, cela donne ceci en commande SQL :

```sql
CREATE TABLE aliment_lieu (
aliment_id INT NOT NULL,
lieu_id INT NOT NULL,
FOREIGN KEY (aliment_id) REFERENCES aliment (id) ON DELETE RESTRICT ON UPDATE CASCADE,
FOREIGN KEY (lieu_id) REFERENCES lieu (id) ON DELETE RESTRICT ON UPDATE CASCADE,
PRIMARY KEY (aliment_id, lieu_id)
);
```

DÃ©cortiquons cette commande ensemble :
- On **crÃ©e une nouvelle table** avec le nom des deux tables quâ€™elle relie (ici la table â€œalimentâ€, ainsi que la table â€œlieuâ€).
- On **ajoute les rÃ©fÃ©rences** aux id de ces deux tables :
    - â€œaliment_idâ€, qui est une rÃ©fÃ©rence aux id de la table â€œalimentâ€ ;
    - â€œlieu_idâ€, qui est une rÃ©fÃ©rence aux id de la table â€œlieuâ€ ;
    - on signale Ã  MySQL **comment mettre Ã  jour** la BDD en cas de suppression ou de mise Ã  jour dâ€™un objet de â€œaliment_lieuâ€.
- On explique Ã  MySQL que lâ€™id de cette table sera lâ€™association entre les deux id prÃ©cÃ©dents.

:::info
Vous vous demandez ce que signifie **`ON UPDATE`** ? Eh bien, câ€™est le comportement que doit adopter MySQL en cas de **mise Ã  jour** dâ€™un champ.
Il peut avoir les mÃªmes options que **`ON DELETE`**, que vous avez vu dans le chapitre prÃ©cÃ©dent. ğŸ˜‰
:::

<figure>
    <img src="https://user.oc-static.com/upload/2021/01/18/16109652325493_P4_ON-UPDATE.png"
         alt="RÃ©capitulatif visuel de la commande. RESTRICT ou NO ACTION : empÃªche la mise Ã  jour sous conditions. SET NULL : met Ã  jour la famille et remplace les object par NULL. CASCADE : met Ã  jour tous les objets reliÃ©s" />
    <figcaption>Actions de la commande ON UPDATE</figcaption>
</figure>

:::note ?
Câ€™est bien beau tout Ã§a, mais comment ajoute-t-on une relation entre les lieux et les aliments ?
:::

Pas de panique, Ã§a arrive !

Admettons que le â€œblanc de dindeâ€ prÃ©sent dans notre BDD soit vendu chez â€œCarrefour Cityâ€. Il vous faudrait alors crÃ©er un objet dans
â€œaliment_lieuâ€, avec lâ€™id de â€œblanc de dindeâ€ ainsi que lâ€™id de â€œCarrefour Cityâ€.

Retrouvez ces id dans votre BDD et Ã©crivez la commande SQL pour crÃ©er cette relation.

Sachant que 11 est lâ€™id du â€œblanc de dindeâ€, 1 celui du â€œCarrefour Cityâ€, cela donne Ã§a :

```sql
INSERT INTO `aliment_lieu` (`aliment_id`, `lieu_id`) VALUES ('11', '1');
```

Et voilÃ , le fait que le blanc de dinde soit vendu Ã  Carrefour est stockÃ© en base de donnÃ©es. Bravo Ã  vous. ğŸ‘

Enfin, pour retrouver cette relation, il vous faudra faire un **double JOIN**. Rappelez-vous, nous avions vu Ã§a ensemble dans
[la partie 2](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142248-inserez-des-donnees-dans-votre-bdd).

Cela ressemble Ã  Ã§a :

```sql
SELECT * FROM aliment
JOIN aliment_lieu ON aliment.id = aliment_lieu.aliment_id
JOIN lieu ON lieu.id = aliment_lieu.lieu_id
WHERE aliment.id = 11;
```

:::info
Ici, on joint la table aliment Ã  la table lieu **via** la table de liaison, comme si câ€™Ã©tait une simple relation un Ã  plusieurs rÃ©pÃ©tÃ©e.
:::

En sortie, MySQL vous affichera bien le â€œblanc de dindeâ€ avec son lieu de vente associÃ© : â€œCarrefour Cityâ€ !

### Ã€ vous de jouer !

On souhaite savoir quels sont les appareils sur lesquels les utilisateurs ont installÃ© Foodly (par exemple : mac, pc, android, etc.).

Un utilisateur peut utiliser Foodly sur plusieurs appareils, et un mÃªme appareil peut Ãªtre commun Ã  plusieurs utilisateurs. Il sâ€™agit dâ€™une
relation plusieurs Ã  plusieurs.

Un appareil est uniquement constituÃ© de son type au format texte.

```sql
mysql> CREATE TABLE appareil (
    -> id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> type VARCHAR(100) NOT NULL
    -> );
Query OK, 0 rows affeected (0.01 sec)

mysql> INSERT INTO appareil (type) VALUES ('iphone');
Query OK, 1 rows affeected (0.00 sec)

mysql> INSERT INTO appareil (type) VALUES ('android');
Query OK, 1 rows affeected (0.00 sec)

mysql> INSERT INTO appareil (type) VALUES ('pc');
Query OK, 1 rows affeected (0.00 sec)

mysql> INSERT INTO appareil (type) VALUES ('mac');
Query OK, 1 rows affeected (0.00 sec)

mysql> SELECT * FROM appareil;
+----+---------+
| id | type    |
+----+---------+
|  1 | iphone  |
|  2 | android |
|  3 | pc      |
|  4 | mac     |
+----+---------+
4 rows in set (0.00 sec)

mysql> CREATE TABLE utilisateur_appareil (
    -> utilisateur_id INT NOT NULL,
    -> appareil_id INT NOT NULL,
    -> FOREIGN KEY (utilisateur_id) REFERENCES utilisateur (id) ON DELETE RESTRICT ON UPDATE CASCADE,
    -> FOREIGN KEY (appareil_id) REFERENCES appareil (id) ON DELETE RESTRICT ON UPDATE CASCADE,
    -> PRIMARY KEY (utilisateur_id, appareil_id)
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> SELECT * FROM utilisateur_appareil;
Empty set (0.00 sec)

mysql> SELECT * FROM utilisateur WHERE id = 1;
+----+---------+------------------+-----------+
| id | prenom  | email            | langue_id |
+----+---------+------------------+-----------+
|  1 | quentin | qentin@gmail.com |         1 |
+----+---------+------------------+-----------+
1 row in set (0.00 sec)

mysql> INSERT INTO utilisateur_appareil (utilisateur_id, appareil_id) VALUES (1, 2);
Query OK, 1 rows affected (0.01 sec)

mysql> INSERT INTO utilisateur_appareil (utilisateur_id, appareil_id) VALUES (1, 4);
Query OK, 1 rows affected (0.01 sec)

mysql> SELECT * FROM utilisateur_appareil;
+----------------+-------------+
| utilisateur_id | appareil_id |
+----------------+-------------+
|              1 |           2 |
|              1 |           4 |
+----------------+-------------+
2 row in set (0.00 sec)

mysql> SELECT * FROM utilisateur
    -> JOIN utilisateur_appareil
    -> ON utilisateur.id = utilisateur_appareil.utilisateur_id
    -> JOIN appareil
    -> ON appareil.id = utilisateur_appareil.appareil_id
    -> WHERE utilisateur.id = 1;
+----+---------+------------------+-----------+----------------+-------------+----+---------+
| id | prenom  | email            | langue_id | utilisateur_id | appareil_id | id | type    |
+----+---------+------------------+-----------+----------------+-------------+----+---------+
|  1 | quentin | qentin@gmail.com |         1 |              1 |           2 |  2 | android |
|  1 | quentin | qentin@gmail.com |         1 |              1 |           4 |  4 | mac     |
+----+---------+------------------+-----------+----------------+-------------+----+---------+
2 row in set (0.00 sec)
```

:::note ?
Comment feriez-vous pour crÃ©er cette table et la lier aux utilisateurs ?
:::

Je crois en vous pour effectuer cette opÃ©ration seul ğŸ™Œ Si vous Ãªtes bloquÃ©, la correction est disponible ici :

<Vimeo vimeoId="497578465" />

<br />

### En rÃ©sumÃ©

- Vous savez ajouter une relation plusieurs Ã  plusieurs entre deux objets **en crÃ©ant une table de liaison** qui **contiendra les id de chaque
objet**.

_Vous voilÃ  arrivÃ© Ã  la fin de ce cours. Retrouvez-moi au chapitre suivant pour la conclusion !_

-----

## Terminez votre apprentissage

[Terminez votre apprentissage - ImplÃ©mentez vos bases de donnÃ©es relationnelles avec SQL - OpenClassrooms](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/7142305-terminez-votre-apprentissage)

<Vimeo vimeoId="497953156" />

<br />

Vous voici Ã  la conclusion de ce cours, bravo ! ğŸ‘ Il ne vous reste plus qu'un dernier effort avec la rÃ©alisation du dernier quiz.

Vous avez normalement toutes les bases en main pour implÃ©menter votre propre BDD. Que ce soit pour un projet personnel, le travail, ou par
simple curiositÃ©, jâ€™espÃ¨re de tout cÅ“ur que ce cours vous aura Ã©tÃ© utile.

Jâ€™ai personnellement adorÃ© Ã©crire ce cours, qui mâ€™a moi-mÃªme Ã©tÃ© dâ€™une grande aide pour me remettre dans le bain des BDD relationnelles !

Je vous souhaite tout le meilleur pour la suite, et nâ€™oubliez pas, continuez dâ€™apprendre de nouvelles choses sur OpenClassrooms !

-----

## Quiz : Transformez la structure dâ€™une base de donnÃ©es

[Transformez la structure dâ€™une base de donnÃ©es - OpenClassrooms](https://openclassrooms.com/fr/courses/6971126-implementez-vos-bases-de-donnees-relationnelles-avec-sql/exercises/4010)

#### CompÃ©tences Ã©valuÃ©es

<i class="bi bi-check2-circle"></i> Transformer la structure dâ€™une base de donnÃ©es

-----

#### Description

Reprenons notre BDD Moviz du prÃ©cÃ©dent quiz. Vous pouvez la tÃ©lÃ©charger ici : [https://github.com/OpenClassrooms-Student-Center/Course-implementez-BDD-SQL/blob/master/partie\_4/moviz.sql](https://github.com/OpenClassrooms-Student-Center/Course-implementez-BDD-SQL/blob/master/partie_4/moviz.sql).

Souvenez-vous, jâ€™ai modifiÃ© le schÃ©ma de la BDD entre la partie 2 et la partie 3 pour y ajouter la relation un Ã  plusieurs entre â€œfilmâ€ et
â€œnoteâ€, ainsi que la relation plusieurs Ã  plusieurs entre â€œfilmâ€ et â€œpays_de_sortieâ€.

Dans ce quiz, nous allons faire comme si vous implÃ©mentiez vous-mÃªme ces changements.

Pour rappel, voici le schÃ©ma mis Ã  jour de la table â€œfilmâ€ :

| **Nom du champ** | **Type du champ** | **Description du champ** |
|------------------|-------------------|--------------------------|
| _nom_ | VARCHAR(255) | le nom du film |
| _date_de_sortie_ | DATE | la date de sortie du film |
| _synopsis_ | TEXT | la description du scÃ©nario du film |
| _langue_ | VARCHAR(255) | la langue principale du film |
| _budget_ | INTEGER | le budget de production du film |
| note_id | INTEGER | l'id de l'objet note associÃ© au film |

Le schÃ©ma de la table â€œnoteâ€ est disponible ici :

| **Nom du champ** | **Type du champ** | **Description du champ** |
|------------------|-------------------|--------------------------|
| _note_ | INTEGER | la note sur 5 |

Et enfin, voici le schÃ©ma de â€œpays_de_sortieâ€ :

| **Nom du champ** | **Type du champ** | **Description du champ** |
|------------------|-------------------|--------------------------|
| _nom_ | VARCHAR(255) | le nom du pays |

-----

#### Question 1 : Quels sont les mots clÃ©s disponibles dans une commande de type ALTER TABLE ?

<i class="bi bi-record-circle"></i> ADD, DROP, CHANGE, MODIFY<br />
<i class="bi bi-circle"></i> AJOUTER, SUPPRIMER, MODIFIER<br />
<i class="bi bi-circle"></i> ADD, DROP, CHANGE<br />
<br />

_ALTER TABLE sert Ã  modifier la structure dâ€™un objet, et de la table associÃ©e. ADD permet dâ€™ajouter un champ, DROP de le supprimer, CHANGE de
le renommer, MODIFY de modifier son type._

-----

#### Question 2 : Comment fait-on pour ajouter une relation un Ã  plusieurs entre deux objets existants dÃ©jÃ  en base ?

<i class="bi bi-record-circle"></i> On rajoute lâ€™id de lâ€™objet â€œunâ€ comme colonne dans lâ€™objet â€œplusieursâ€ avec comme nom â€œobjet_idâ€.<br />
<i class="bi bi-circle"></i> On utilise une commande SQL avec le mot clÃ© JOIN.<br />
<i class="bi bi-circle"></i> On supprime et recrÃ©e les deux objets.<br />
<br />

_Pour effectuer une relation un Ã  plusieurs, lâ€™objet â€œunâ€ de la relation doit Ãªtre mentionnÃ© dans lâ€™objet â€œplusieursâ€. La convention en SQL
est de reprendre son id (sa clÃ© primaire) comme clÃ© Ã©trangÃ¨re dans lâ€™objet plusieurs._

-----

#### Question 3 : Dans la BDD Moviz, quelle est la commande qui permet de rajouter le champ â€œnote_idâ€ Ã  la table â€œfilmâ€ ?

<i class="bi bi-circle"></i> <code>ALTER TABLE film ADD note_id;</code><br />
<i class="bi bi-record-circle"></i> <code>ALTER TABLE film ADD note_id INTEGER NOT NULL;</code><br />
<i class="bi bi-circle"></i> <code>ALTER TABLE film ADD note_id VARCHAR(100);</code><br />
<br />

_Pour ajouter un champ Ã  un objet (et donc, Ã  sa table), on utilise une commande de type ALTER TABLE avec le mot clÃ© ADD. Comme on souhaite
ajouter un champ qui sera une clÃ© Ã©trangÃ¨re, il est du mÃªme type quâ€™une clÃ© primaire, soit un entier (INTEGER) non nul (NOT NULL)._

-----

#### Question 4 : Quelle est la commande qui permet de supprimer le budget sur les films ?

<i class="bi bi-circle"></i> <code>ALTER TABLE film REMOVE budget;</code><br />
<i class="bi bi-record-circle"></i> <code>ALTER TABLE film DROP budget;</code><br />
<i class="bi bi-circle"></i> <code>ALTER TABLE film DELETE budget;</code><br />
<br />

_Pour supprimer un champ Ã  un objet (et donc, Ã  sa table), on utilise une commande de type ALTER TABLE avec le mot clÃ© DROP suivi du nom du
champ Ã  supprimer._

-----

#### Question 5 : Quelle est la commande qui permet de modifier le type du champ â€œbudgetâ€ dâ€™entier vers dÃ©cimal ?

<i class="bi bi-record-circle"></i> <code>ALTER TABLE film MODIFY budget FLOAT;</code><br />
<i class="bi bi-circle"></i> <code>ALTER TABLE film MODIFY budget VARCHAR(100);</code><br />
<i class="bi bi-circle"></i> <code>ALTER TABLE film CHANGE budget FLOAT;</code><br />
<br />

_Pour modifier le type dâ€™un champ, on utilise une commande de type ALTER TABLE avec le mot clÃ© MODIFY suivi du nom du champ et de son nouveau
type (ici, dÃ©cimal, soit FLOAT)._

-----

#### Question 6 : Quelle est la commande qui permet de renommer le budget sur les films en â€œcout_de_productionâ€ ?

<i class="bi bi-circle"></i> <code>ALTER TABLE film CHANGE budget cout_de_production;</code><br />
<i class="bi bi-record-circle"></i> <code>ALTER TABLE film CHANGE budget cout_de_production FLOAT;</code><br />
<i class="bi bi-circle"></i> <code>ALTER TABLE film MODIFY budget cout_de_production;</code><br />
<br />

_Pour renommer un champ, on utilise une commande de type ALTER TABLE avec le mot clÃ© CHANGE suivi du nom du champ et de son nouveau nom. MySQL
oblige, on doit aussi reprÃ©ciser son type (ici FLOAT, car on lâ€™a modifiÃ© Ã  la question prÃ©cÃ©dente)._

-----

#### Question 7 : Comment crÃ©e-t-on une relation plusieurs Ã  plusieurs entre deux objets existants dÃ©jÃ  en base ?

<i class="bi bi-circle"></i> On supprime et recrÃ©e les deux tables.<br />
<i class="bi bi-record-circle"></i> On crÃ©e une table de liaison qui va stocker les relations entre ces deux objets.<br />
<i class="bi bi-circle"></i> On joint les tables avec un JOIN.<br />
<br />

_Rappelez-vous, la table de liaison regroupe les relations plusieurs Ã  plusieurs comme sâ€™il sâ€™agissait de relations un Ã  plusieurs. Pour ce
faire, elle contient 2 colonnes, chacune Ã©tant une clÃ© Ã©trangÃ¨re vers chaque objet de la relation plusieurs Ã  plusieurs._

-----

#### Question 8 : Quelle est la commande qui permet de crÃ©er la table de liaison entre â€œfilmâ€ et â€œpays_de_sortieâ€ ?

<i class="bi bi-record-circle"></i>

```sql
CREATE TABLE film_pays_de_sortie (
film_id INT NOT NULL,
pays_de_sortie_id INT NOT NULL,
FOREIGN KEY (film_id) REFERENCES film (id) ON DELETE RESTRICT ON UPDATE CASCADE,
FOREIGN KEY (pays_de_sortie_id) REFERENCES pays_de_sortie (id) ON DELETE RESTRICT ON UPDATE CASCADE,
PRIMARY KEY (film_id, pays_de_sortie_id)
);
```

<i class="bi bi-circle"></i>

```sql
CREATE TABLE film_pays_de_sortie;
```

<i class="bi bi-circle"></i>

```sql
CREATE TABLE film_pays_de_sortie (
film_id INT NOT NULL,
pays_de_sortie_id INT NOT NULL
);
```

*La table de liaison doit avoir pour nom â€œnom_objet_1_nom_objet_2â€, soit ici â€œfilm_pays_de_sortieâ€ et stocker deux champs, qui sont les clÃ©s
Ã©trangÃ¨res de chaque autre table, soit ici â€œfilm_idâ€ (clÃ© Ã©trangÃ¨re vers lâ€™id de â€œfilmâ€) et â€œpays_de_sortie_idâ€ (clÃ© Ã©trangÃ¨re vers lâ€™id de
â€œpays_de_sortieâ€).*
